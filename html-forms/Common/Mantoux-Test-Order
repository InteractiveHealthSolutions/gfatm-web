<htmlform>
	<!-- Autogenerated example form  (template from 01-Nov-2010 -->
	<macros>
		paperFormId = (Fill this in)
		headerColor =#009d8e
		fontOnHeaderColor = white
	</macros>

	<style>
		.section {
			border: 1px solid $headerColor;
			padding: 2px;
			text-align: left;
			margin-bottom: 1em;
		}
		.sectionHeader {
			background-color: $headerColor;
			color: $fontOnHeaderColor;
			display: block;
			padding: 2px;
			font-weight: bold;
		}
		table.baseline-aligned td {
			vertical-align: baseline;
		}
	</style>

	<span style="float:right">Paper Form ID: $paperFormId</span>
	<h2>Mantoux Test Order (v1.0.0)</h2>

	<section headerLabel="1. Encounter Details">
		<table class="baseline-aligned">
			<tr>
				<td>Date:</td>
				<td><encounterDate default="today"  id="encounter_date"/></td>
			</tr>
			<tr>
				<td>Location:</td>
				<td><encounterLocation default="2" /></td>
			</tr>
			<tr>
				<td>Provider:</td>
				<td><encounterProvider default="currentUser" type="autocomplete"/></td>
			</tr>
		</table>
	</section>

	<section headerLabel="2. Mantoux Test Order">
         <div>
			<p>
					Weight Percentile 
					<br/>
					<select id="ddlViewBy">
					  <option value=""></option>
					  <option value="less_than_3_centile">&lt;= 3rd Centile</option>
					  <option value="less_than_5_centile">&lt;= 5th Centile</option>
					  <option value="bw_6_10_centile">Between 6-10th Centile</option>
					  <option value="bw_11_25_centile">Between 11-25th Centile</option>
					  <option value="bw_26_50_centile">Between 26-50th Centile</option>
                                         <option value="bw_51_75_centile">Between 51-75th Centile</option>
                                         <option value="bw_76_90_centile">Between 76-90th Centile</option>
                                         <option value="bw_91_95_centile">Between 91-95th Centile</option>
                                         <option value="bw_96_98_centile">Between 96-98th Centile</option>
                                         <option value="greater_then_98_centile">&gt; 98th Centile</option>
					</select>
					<obs conceptId="164226" id="weight_percentile" /> <b style="color:red;"> * </b>
			</p>
			
            <p>
				Order ID
				<br/>
				<obs conceptId="165715" id="order_id" required="true" maxlength="20" />
			</p>
			
		</div>
	</section>

	<submit/>

<script type="text/javascript">
	var startDate = new Date();
	var weightPercentile= "<lookup expression="fn.latestObs(164226).getValueAsString($!{locale})" />";

	if(weightPercentile.includes("&lt;= 3rd Centile")){
		document.getElementById('ddlViewBy').value = "less_than_3_centile";
	}
	else if(weightPercentile.includes("&lt;= 5th Centile")){
		document.getElementById('ddlViewBy').value = "less_than_5_centile";
		
	}
	else if(weightPercentile.includes("Between 6-10th Centile")){
		document.getElementById('ddlViewBy').value = "bw_6_10_centile";
	}
	else if(weightPercentile.includes("Between 11-25th Centile")){
		document.getElementById('ddlViewBy').value = "bw_11_25_centile";
	}
	else if(weightPercentile.includes("Between 26-50th Centile")){
		document.getElementById('ddlViewBy').value = "bw_26_50_centile";
		
	}
	else if(weightPercentile.includes("Between 51-75th Centile")){
		document.getElementById('ddlViewBy').value = "bw_51_75_centile";
		
	}
       else if(weightPercentile.includes("Between 76-90th Centile")){
		document.getElementById('ddlViewBy').value = "bw_76_90_centile";
		
	}
      else if(weightPercentile.includes("Between 91-95th Centile")){
		document.getElementById('ddlViewBy').value = "bw_91_95_centile";
		
	}
     else if(weightPercentile.includes("Between 96-98th Centile")){
		document.getElementById('ddlViewBy').value = "bw_96_98_centile";
		
	}
         else if(weightPercentile.includes("&gt; 98th Centile")){
		document.getElementById('ddlViewBy').value = "greater_then_98_centile";
		
	}

					  
	
	var orderId = (new Date ((new Date((new Date(new Date())).toISOString() )).getTime() - ((new Date()).getTimezoneOffset()*60000))).toISOString().slice(0, 19).replace('T', ' ');
 jQuery(function() {
	setValue('order_id.value', orderId);
	getField("order_id.value").prop('disabled',true);
	getField("weight_percentile.value").prop('disabled',true);
				
	});

beforeSubmit.push(function() {
		var error=true;
		
		
if(error==false){
            return false;
        }
        else{

var e = document.getElementById("ddlViewBy");
					var strUser = e.options[e.selectedIndex].text;
					setValue('weight_percentile.value',strUser);
			getField("order_id.value").prop('disabled',false);
			getField("weight_percentile.value").prop('disabled',false);
			
			
			var endDate = new Date();
			var timeDiff = Math.abs(endDate.getTime() - startDate.getTime());
			var diffSec = timeDiff/1000;
			alert(diffSec + " seconds to fill form");
            return true;
        }
});

</script>

</htmlform>