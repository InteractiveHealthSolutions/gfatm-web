<htmlform>
	<!-- Autogenerated example form  (template from 01-Nov-2010 -->
	<macros>
		paperFormId = (Fill this in)
		headerColor =#009d8e
		fontOnHeaderColor = white
	</macros>

	<style>
		.section {
			border: 1px solid $headerColor;
			padding: 2px;
			text-align: left;
			margin-bottom: 1em;
		}
		.sectionHeader {
			background-color: $headerColor;
			color: $fontOnHeaderColor;
			display: block;
			padding: 2px;
			font-weight: bold;
		}
		table.baseline-aligned td {
			vertical-align: baseline;
		}
	</style>

	<span style="float:right">Paper Form ID: $paperFormId</span>
	<h2>AFB Smear Test Order</h2>

	<section headerLabel="1. Encounter Details">
		<table class="baseline-aligned">
			<tr>
				<td>Date:</td>
				<td><encounterDate default="today" id="encounter_date" allowFutureDates="false"/></td>
			</tr>
			<tr>
				<td>Location:</td>
				<td><encounterLocation default="1"/></td>
			</tr>
			<tr>
				<td>Provider:</td>
				<td><encounterProvider default="currentUser" type="autocomplete"/></td>
			</tr>
		</table>
	</section>

	<section headerLabel="2. AFB Smear Order">
		<div>

     <p>Order ID
				<br/>
				<obs conceptId="165715" id="order_id" allowTime="false" required="true"  maxLength="20" size="16"  />
		   </p>

                        <p>Date of submission
				<br/>
				<obs conceptId="159951" id="sample_submission_date" required="true"/>
		   </p>

                    <p> At what point is the test being done?
				<br/>
				<obs conceptId="162084" answerConceptIds="162080,162081,162082" id="test_context_status"   answerLabels="Baseline, Baseline repeat, Follow-up" required="true" defaultValue="162080">
			         <controls>
	                                <when value="162082" thenDisplay="#followup_month_div"/>
					 </controls>
				</obs>
			</p>

                     <div id="followup_month_div">
                    <p> Month of treatment
				<br/>
				<obs conceptId="164327"  id="followup_month" > <b style="color:red;"> * </b>
			         <controls>
						
					 </controls>
				</obs>
			</p>
                    </div>
       <p> Specimen Type
				<br/>
				<obs conceptId="162476" answerConceptIds="1004, 5042" id="specimen_type"  answerLabels="Sputum, Extra-Pulmonary" required="true" defaultValue="1004">
			         <controls>
                                           <when value="5042" thenDisplay="#specimen_source_div"/>
					 </controls>
				</obs>
			</p>

<div id="specimen_source_div">
<p> Where did the specimen come from?
				<br/>
				<obs conceptId="159959" answerConceptIds="1021, 114108, 165181, 164601" id="specimen_source"  answerLabels="Lymph, Pleural Fluid, Pus, Other" defaultValue="1021"> <b style="color:red;"> * </b>
			         <controls>
		                  <when value="164601" thenDisplay="#specimen_source_other_div"/>
					 </controls>
				</obs>
			</p>
</div>


<div id="specimen_source_other_div">
 <p>Specify Other
				<br/>
				<obs conceptId="164601" id="specimen_source_other" maxlength="50" /> <b style="color:red;"> * </b>
			</p>
</div>

                </div>
	</section>

	<submit/>

<script type = "text/javascript">

var startDate = new Date();
var orderId = (new Date ((new Date((new Date(new Date())).toISOString() )).getTime() - ((new Date()).getTimezoneOffset()*60000))).toISOString().slice(0, 19).replace('T', ' ');

jQuery( document ).ready(function() {  
		
		<ifMode mode="ENTER">
		setValue('order_id.value', orderId);
		</ifMode>
		
	    getField("order_id.value").prop('disabled',true);
        });


 jQuery(function() {
getField('specimen_type.value').change(function() {
                        if(getValue('specimen_type.value') == 1004){
                              $j('#specimen_source_div').hide();
                              $j('#specimen_source_other_div').hide();
                        }
                });

 });

function convert(str) {
    var mnths = { 
        Jan:"01", Feb:"02", Mar:"03", Apr:"04", May:"05", Jun:"06",
        Jul:"07", Aug:"08", Sep:"09", Oct:"10", Nov:"11", Dec:"12"
    },
    date = str.split(" ");

    return [ date[3], mnths[date[1]], date[2] ].join("-");
}

beforeSubmit.push(function() {
		var error=true;
		setValue('followup_month.error', '');
                setValue('specimen_source.error', '');
                setValue('specimen_source_other.error', '');

 if(getValue('test_context_status.value')==162082&amp;&amp; getValue('followup_month.value')==''){
					getField('followup_month.error').html('This field can not be null').show();
					error=false;
	     }

else if(getValue('followup_month.value') &lt; 0  || getValue('followup_month.value') &gt; 24){                      	
               getField('followup_month.error').html('Value out of range. It should be between 0-24').show();
error=false;
   }

 else{
              getField('followup_month.error').html('').hide();
             
                 }


 if(getValue('specimen_type.value')==5042&amp;&amp; getValue('specimen_source.value')==''){
					getField('specimen_source.error').html('This field can not be null').show();
					error=false;
	     }

 else{
              getField('specimen_source.error').html('').hide();
             
                 }
 if(getValue('specimen_source.value')==164601 &amp;&amp; getValue('specimen_source_other.value')==''){
					getField('specimen_source_other.error').html('This field can not be null').show();
					error=false;
	     }
 else{
              getField('specimen_source_other.error').html('').hide();
             
                 }

		if(error==false){
            return false;
        }
        else{ 
			getField("order_id.value").prop('disabled',false);
			var endDate = new Date();
			var timeDiff = Math.abs(endDate.getTime() - startDate.getTime());
			var diffSec = timeDiff/1000;
			alert(diffSec + " seconds to fill form");
            return true;
        }
});

</script>

</htmlform>