<htmlform>
   <!-- Autogenerated example form  (template from 01-Nov-2010 -->
   <macros>
      paperFormId = (Fill this in)
      headerColor =#009d8e
      fontOnHeaderColor = white
   </macros>
   <style>
      .section {
      border: 1px solid $headerColor;
      padding: 2px;
      text-align: left;
      margin-bottom: 1em;
      }
      .sectionHeader {
      background-color: $headerColor;
      color: $fontOnHeaderColor;
      display: block;
      padding: 2px;
      font-weight: bold;
      }
      table.baseline-aligned td {
      vertical-align: baseline;
      }
   </style>
   <span style="float:right">Paper Form ID: $paperFormId</span>
   <h2>GXP Specimen Collection (v1.0.0)</h2>
   <section headerLabel="1. Encounter Details">
      <table class="baseline-aligned">
         <tr>
            <td>Date:</td>
            <td>
               <encounterDate default="today"/>
            </td>
         </tr>
         <tr>
            <td>Location:</td>
            <td>
               <encounterLocation default="2" />
            </td>
         </tr>
         <tr>
            <td>Provider:</td>
            <td>
               <encounterProvider default="currentUser"/>
            </td>
         </tr>
      </table>
   </section>
   <section headerLabel="2. GXP Specimen Collection">
      <p>
         Where was the sample collected from?
         <br/>
         <obs conceptId="165827"  answerConceptIds="166052,166053" id="sample_collected_from" answerLabels="Within the hospital,Outside the hospital" required="true">
            <controls>
               <when value="166053" thenDisplay="#other_sample_in_hospital"/>
            </controls>
         </obs>
      </p>
      <p id="other_sample_in_hospital">
         If outside the site, specify
         <br/>
         <obs conceptId="166055" id="sample_collected_outside_hospital_other" maxlength="50"/>
      </p>
      <p>
         Which day was the sample submitted?
         <br/>
         <obs conceptId="159951" id="sample_submission_date" required="true"/>
      </p>
      <p>
         At what point is the test being done?
         <br/>
         <obs conceptId="162084" answerConceptIds="162080,162081,160523" id="test_context_status"   answerLabels="Baseline, Baseline repeat, Follow-up" required="true" defaultValue="162080">
            <controls>
               <when value="160523" thenDisplay="#followup_month_div"/>
               <when value="162081" thenDisplay="#baselinerepeat_reason_div"/>
               <when value="162080" thenDisplay="#tb_category_div"/>
            </controls>
         </obs>
      </p>
      <div id="followup_month_div">
         <p>
            which month is the test being done?
            <br/>
            <obs conceptId="164327"  id="followup_month" >
               <controls>
               </controls>
            </obs>
         </p>
      </div>
      <div id="tb_category_div">
         <b> Baseline (New Test) </b>
         <p>
            If baseline test, specify patient category*
            <br/>
            <obs conceptId="164238" answerConceptIds="164230, 164231" id="tb_category"   answerLabels="Category I (New),Category II (Re-treatment)">
               <controls>
               </controls>
            </obs>
         </p>
      </div>
      <div id="baselinerepeat_reason_div">
         <b> Baseline Repeat (Duplicate Test) </b>
         <p>
            Reason for repeating test if Baseline repeat?*
            <br/>
            <obs conceptId="164309" answerConceptIds="164528,1138,163611,165713" id="baselinerepeat_reason"   answerLabels="Rif Resistant +ve,Indeterminate,Error/Invalid/No result,Others">
               <controls>
                  <when value="165713" thenDisplay="#other_reason_repeating_test_div"/>
               </controls>
            </obs>
         </p>
         <div id="other_reason_repeating_test_div">
            <p>
               If others then specify*
               <br/>
               <obs conceptId="165713" id="other_reason_repeating_test" maxlength="50"  />
            </p>
         </div>
      </div>
      <p>
         Specimen Type
         <br/>
         <obs conceptId="162476" answerConceptIds="166058,166087" id="specimen_type"  answerLabels="Pulmonary,Extra Pulmonary" required="true" defaultValue="166058">
            <controls>
               <when value="166058" thenDisplay="#pulmonary_div"/>
               <when value="166087" thenDisplay="#specimen_source_div"/>
            </controls>
         </obs>
      </p>
      <p id="pulmonary_div">
         If pulmonary, specify
         <br/>
         <obs conceptId="166059" answerConceptIds="1004,165350" id="pulmonary_specimen_type"  answerLabels="Sputum,Gastric/Nasogastric Aspirate">
         </obs>
      </p>
      <div id="specimen_source_div">
         <p>
            Where did the specimen come from?*
            <br/>
            <obs conceptId="159959" answerConceptIds="165350, 114108, 165181, 164601" id="specimen_source"  answerLabels="Gastric Aspirate, Pleural Fluid, Pus, Other" defaultValue="165350">
               <controls>
                  <when value="164601" thenDisplay="#specimen_source_other_div"/>
               </controls>
            </obs>
         </p>
         <p id="specimen_source_other_div">
            Specify Other*
            <br/>
            <obs conceptId="164601" id="specimen_source_other"  />
         </p>
      </div>
      <p>
         Order ID
         <br/>
         <obs conceptId="165715" id="order_id" allowTime="false" required="true"  maxLength="20" size="16"  />
      </p>
   </section>
   <submit/>
   <script type = "text/javascript">
      var startDate = new Date();
      
      var orderId = (new Date ((new Date((new Date(new Date())).toISOString() )).getTime() - ((new Date()).getTimezoneOffset()*60000))).toISOString().slice(0, 19).replace('T', ' ');
      
      
      
			<ifMode mode="EDIT" include="false">
				jQuery(function() {
					setValue('order_id.value', orderId);
					
					
				});
			</ifMode>
      
      jQuery(function() {
	  
		getField("order_id.value").prop('disabled',true);
			
			
      
			getField('test_context_status.value').change(function() {
                              if(getValue('test_context_status.value') == 162080 || getValue('test_context_status.value') == 160523){
                                    $j('#other_reason_repeating_test_div').hide();
                              }
                      });
      
      
      getField('specimen_type.value').change(function() {
                              if(getValue('specimen_type.value') != 166087){
                                    $j('#specimen_source_other_div').hide();
                               
                              }
                      });
       });
      
      
      beforeSubmit.push(function() {
	
      		var error=true;
      		setValue('followup_month.error', '');
			setValue('tb_category.error', '');
			setValue('baselinerepeat_reason.error', '');
			setValue('sample_collected_outside_hospital_other.error', '');
			setValue('other_reason_repeating_test.error', '');             
			setValue('specimen_source.error', '');
			setValue('specimen_source_other.error', '');
			setValue('pulmonary_specimen_type.error', '');
                      
		
			if(getValue('sample_collected_from.value')==166053 &amp;&amp; getValue('sample_collected_outside_hospital_other.value')==''){
					getField('sample_collected_outside_hospital_other.error').html('This field can not be null').show();	
					error=false;
      	     }
			 else{
                    getField('sample_collected_outside_hospital_other.error').html('').hide();
            }
		
                  
      
			if(getValue('test_context_status.value')==160523){
				if(getValue('followup_month.value')==''){
						getField('followup_month.error').html('This field can not be null').show();
						error=false;
				}else if(getValue('followup_month.value') &lt; 0  || getValue('followup_month.value') &gt; 24){                  	
					getField('followup_month.error').html('Value out of range. It should be between 0-24').show();
					error=false;
				}
				else if(getValue('followup_month.value').indexOf('.') > -1){                 	
					getField('followup_month.error').html('Follow up month can not be in decimal').show();
					error=false;
				}
				else{
					getField('followup_month.error').html('').hide(); 
				}
			}else{
				getField('followup_month.error').html('').hide();
			}
            
		
			
		
		
		
			if(getValue('test_context_status.value')==162080 &amp;&amp; getValue('tb_category.value')==''){
      					getField('tb_category.error').html('This field can not be null').show();
      					error=false;
      	     }
			else{
                    getField('tb_category.error').html('').hide();
            }
			if(getValue('test_context_status.value')==162081 &amp;&amp; getValue('baselinerepeat_reason.value')==''){
      					getField('baselinerepeat_reason.error').html('This field can not be null').show();
      					error=false;
      	     }
			else{
                    getField('baselinerepeat_reason.error').html('').hide();       
            }
      
			if(getValue('test_context_status.value')==162081 &amp;&amp;  getValue('baselinerepeat_reason.value')==165713 &amp;&amp;  getValue('other_reason_repeating_test.value')==''){
      					getField('other_reason_repeating_test.error').html('This field can not be null').show();
      					error=false;
      	     }
			else{
                    getField('other_reason_repeating_test.error').html('').hide();    
            }
      
       if(getValue('specimen_type.value')==166087 &amp;&amp; getValue('specimen_source.value')==''){
				getField('specimen_source.error').html('This field can not be null').show();
				error=false;
      	}
      
       else{
      			getField('specimen_source.error').html('').hide();     
        }
		
		if(getValue('specimen_type.value')==166058 &amp;&amp; getValue('pulmonary_specimen_type.value')==''){
				getField('pulmonary_specimen_type.error').html('This field can not be null').show();
				error=false;
      	}
       else{
      			getField('pulmonary_specimen_type.error').html('').hide();     
        }
			 
			  
		if(getValue('specimen_type.value')== 166087 &amp;&amp; getValue('specimen_source.value')==164601 &amp;&amp; getValue('specimen_source_other.value')==''){
      			getField('specimen_source_other.error').html('This field can not be null').show();
      			error=false;
      	}else{
      			getField('specimen_source_other.error').html('').hide();     
      	}
		
      	if(error==false){
                  return false;
              }
              else{
      			getField("order_id.value").prop('disabled',false);
      			var endDate = new Date();
      			var timeDiff = Math.abs(endDate.getTime() - startDate.getTime());
      			var diffSec = timeDiff/1000;
      			alert(diffSec + " seconds to fill form");
                  return true;
              }
      	});
      
      
   </script>
   <!-- END OF FORM
      Simple examples to copy-and-paste. Full reference at http://wiki.openmrs.org/x/kg8z
      
      SECTION
      	<section headerLabel="\#. Title">
      		Content
      	</section>
      
      NUMERIC OBSERVATION
      	<obs conceptId="id-of-numeric-concept" labelText="Label before"/>
      
      DATE OBSERVATION
      	<obs conceptId="id-of-date-concept" labelText="Label before"/>
      
      CODED OBSERVATION
      (as a dropdown)
      	<obs conceptId="id-of-coded-concept" labelText="Label before"/>
      (as radio buttons)
      	<obs conceptId="id-of-coded-concept" labelText="Label before" style="radio"/>
      (as an autocomplete)
      	<obs conceptId="id-of-coded-concept" labelText="Label before" style="autocomplete" answerClasses="Diagnosis"/>
      (as a checkbox for a specific answer)
      	<obs conceptId="id-of-coded-concept" labelText="Label before" answerConceptId="id-of-answer-concept" answerLabel="label for answer"/>
      (as a dropdown with specific choices)
      	<obs conceptId="id-of-coded-concept" labelText="Label before" answerConceptIds="concept-id-1,concept-id-2,concept-id-3" answerLabels="Label 1,Label 2, Label 3"/>
      
      
      FREE TEXT OBSERVATION
      (as a normal text field)
      	<obs conceptId="id-of-text-concept" labelText="Label before"/>
      (as a textarea)
      	<obs conceptId="id-of-text-concept" labelText="Label before" rows="4" cols="80"/>
      -->
</htmlform>