<htmlform>
	<!-- Autogenerated example form  (template from 01-Nov-2010 -->
	<macros>
		paperFormId = (Fill this in)
		headerColor =#009d8e
		fontOnHeaderColor = white
	</macros>

	<style>
		.section {
			border: 1px solid $headerColor;
			padding: 2px;
			text-align: left;
			margin-bottom: 1em;
		}
		.sectionHeader {
			background-color: $headerColor;
			color: $fontOnHeaderColor;
			display: block;
			padding: 2px;
			font-weight: bold;
		}
		table.baseline-aligned td {
			vertical-align: baseline;
		}
	</style>

	<span style="float:right">Paper Form ID: $paperFormId</span>
	<h2>End of Followup (v1.0.0)</h2>

	<section headerLabel="1. Encounter Details">
		<table class="baseline-aligned">
			<tr>
				<td>Date:</td>
				<td><encounterDate default="today"/></td>
			</tr>
			<tr>
				<td>Location:</td>
				<td><encounterLocation default="2" /></td>
			</tr>
			<tr>
				<td>Provider:</td>
				<td><encounterProvider default="currentUser" type="autocomplete"/></td>
			</tr>
		</table>
	</section>

	<section headerLabel="2. End of followup">
		
			<p>
				Patient Outcome:
				<br/>
				<select id="patient_outcome_select"></select> <b><font color="red">*</font></b>
			    <div id="patient_outcome_p">
					<obs id="patient_outcome" conceptId="159786"></obs> 
				</div>
           </p>
		   
		  
			<p id="dr_confirmation_div"> 
			    DR Confirmation:
				<br/>
				<obs conceptId="164570" answerConceptIds="1065,1066" id="dr_confirmation"/> <b><font color="red">*</font></b>
			</p>
			
			<p id="enrs_div">
 				ENRS Number:
                <br/>
				<input type="text" name="enrs_id" maxlength="20"/>	<b><font color="red">*</font></b>
			</p>
			
			<p id="reason_for_failure_div">
			    Reason for failure:
				<br/>
				<obs conceptId="165161" answerConceptIds="165149,165150,165154,165155,165668" id="reason_for_failure" 
						answerLabels="Lack of conversion,Bacteriological reversion,Additional acquired resistance to FQ or injectables,Adverse drug reaction,Other"/> <b><font color="red">*</font></b>
			</p>
			
			<p id="reason_for_failure_other_div">
				Specify, Other.
				<br/>
				<obs conceptId="165668" id="reason_for_failure_other" maxlength="100"/> <b><font color="red">*</font></b>
			</p>
			
			<p id="death_date_div">
				Date of Death:
				<br/>
				<obs conceptId="1543" id="death_date" allowFutureDates="false"/>
			</p>
			
			<p id="primary_cause_of_death_div">
			    Suspected primary cause of death:
				<br/>
				<obs conceptId="165144" answerConceptIds="165139,165140,165141,165142,165143,1067" id="primary_cause_of_death" 
						answerLabels="TB immediate cause of death,Cause related to TB treatment,TB contributing to death,Surgery related death,Cause other than TB,Unknown"/> <b><font color="red">*</font></b>
			</p>
			
			<p id="death_cause_other_than_tb_div">
				Specify, Other.
				<br/>
				<obs conceptId="165143" id="death_cause_other_than_tb" maxlength="100"/> <b><font color="red">*</font></b>
			</p>
			
			<p id="transferred_out_div"> 
			    Was the patient transferred out?
				<br/>
				<obs conceptId="160036" answerConceptIds="1065,1066" id="transferred_out"/> <b><font color="red">*</font></b>
			</p>
			
			<p id="not_evaluated_other_div">
				Why does the patient have this outcome?
				<br/>
				<obs conceptId="165166" id="not_evaluated_other" maxlength="100"/> <b><font color="red">*</font></b>
			</p>
			
			<p id="other_outcome_div">
				Other reason/remark
				<br/>
				<obs conceptId="164482" id="other_outcome" maxlength="250"/>
			</p>
			
			<p id="transfer_out_location_div">
				Location of Transfer out
				<br/>
				<select id="facility_list_1">			   
				</select>
				<obs conceptId="164479" id="transfer_out_location" /> <b><font color="red">*</font></b>			
			</p>
			
			<p id="transferred_initiated_div"> 
				Treatment initiated at Referral / Transfer site				
				<br/>
				<obs conceptId="164549" answerConceptIds="1065,1066,1067" id="transferred_initiated"/> <b><font color="red">*</font></b>
			</p>
			
			<p id="reason_treatment_not_initiated_div">
			    Reason treatment not initiated at referral site
				<br/>
				<obs conceptId="164541" answerConceptIds="164496,164497,127750,160034,164538,164438" id="reason_treatment_not_initiated" 
						answerLabels="Patient could be not be contacted,Patient left the city/village,Patient refused treatment,Patient died,DR not confirmed by baseline repeat test,Other"/> <b><font color="red">*</font></b>
			</p>
			
			<p id="other_reason_treatment_not_initiated_div">
				Specify, Other.
				<br/>
				<obs conceptId="164438" id="other_reason_treatment_not_initiated" maxlength="100"/> <b><font color="red">*</font></b>
			</p>
			

<div id ="contact_info">
<b>Provide name and contact number of person at referral / transfer site who provided details about the patient</b>

<p>
		First Name:
		<br/>
		<obs conceptId="164580" id="first_name" maxlength="20"/> <b><font color="red">*</font></b>
</p>

<p>
		Last Name:
		<br/>
		<obs conceptId="164583" id="last_name" maxlength="20"/> <b><font color="red">*</font></b>
</p>

<p>
	Primary Contact Number
	<br/>
	<obs conceptId="164587" id="refcontact_number" maxlength="12" /><b><font color="red">*</font></b>	

</p>

</div>

<p id="followup_loss_div">
				 Why was the patient's treatment interrupted?
				<br/>
				<select id="followup_loss_select"></select> <font color="red"><b>*</b> <label id="loss_error"></label> </font>
			    <div id="followup_loss_p">
					<obs id="followup_loss" conceptId="161206"></obs> 
				</div>
           </p>
		   
		   <p id="other_reason_for_followup_loss_div">
				Specify, Other.
				<br/>
				<obs conceptId="164482" id="other_reason_for_followup_loss" maxlength="100"/> <b><font color="red">*</font></b>
		   </p>
			
			
	</section>

	<submit/>

<script type="text/javascript">
var startDate = new Date();

var flag = false;

<ifMode mode="VIEW">
 $j('#patient_outcome_select').hide();
 $j('#followup_loss_select').hide();
</ifMode>

<ifMode mode="ENTER">

   $j('#patient_outcome_p').hide();
   $j('#followup_loss_p').hide();
   
   $j('#dr_confirmation_div').hide();
   $j('#enrs_div').hide();
   $j('#reason_for_failure_div').hide();
   $j('#reason_for_failure_other_div').hide();
   $j('#death_date_div').hide();
	$j('#primary_cause_of_death_div').hide();
	$j('#death_cause_other_than_tb_div').hide();
	$j('#transferred_out_div').hide();
	$j('#not_evaluated_other_div').hide();
	$j('#other_outcome_div').hide();
	$j('#transfer_out_location_div').hide();
	$j('#transferred_initiated_div').hide();
	$j('#reason_treatment_not_initiated_div').hide();
	$j('#other_reason_treatment_not_initiated_div').hide();
	$j('#contact_info').hide();
	$j('#followup_loss_div').hide();
	$j('#other_reason_for_followup_loss_div').hide();
   
   doRest();
   doRest2();


</ifMode>

function doRest() {
		
			var patientId =  '<lookup expression="patient.getPatientIdentifier(3)"/>';
		
			jQuery.ajax({
					url: "/openmrs/ws/rest/v1/patient?q=" + patientId + "",
					dataType: 'json'
					}).done(function(data ) {

						console.log("patient display : " + data.results[0]['display']);
						console.log("patient uuid : " + data.results[0]['uuid']);
						var patientUuid = data.results[0]['uuid'];
                                                checkIfContactPatient(patientUuid);
				
				});
			
		}

function checkIfContactPatient(patientUuid) {
		
			 jQuery.ajax({
					url: "/openmrs/ws/rest/v1/encounter/?patient=" + patientUuid+ "",
					dataType: 'json'
					}).done(function(data ) {


			for (i in data.results) {

				var obj = data.results[i];
				 if(obj.display.includes("PET-Baseline Screening") || obj.display.includes("PET-Clinician Contact Screening")){
				   flag = true;
				}
			   
			}

			var s= document.getElementById('patient_outcome_select');
			i=0
			s.options[i] = new Option('Cured', 159791);   i++;
			s.options[i] = new Option('Treatment Completed', 160035);  i++;
			s.options[i] = new Option('Treatment Failure', 159874);  i++;
			s.options[i] = new Option('Died', 160034);  i++;
			s.options[i] = new Option('Transfer out', 159492);   i++;
			s.options[i] = new Option('Referral', 1648);  i++;
			s.options[i] = new Option('Lost to Follow-up', 160031);  i++;
			s.options[i] = new Option('Clinically evaluated, No TB', 165836);  i++;
			s.options[i] = new Option('Antibiotic Complete - NO TB', 165837);  i++;
			s.options[i] = new Option('Not evaluated', 164791);  i++;
			s.options[i] = new Option('Treatment adapted', 164792);  i++;
                        if(flag){
			s.options[i] = new Option('Contact Diagnosed with TB', 166221);  i++;
			s.options[i] = new Option('Refused to take treatment', 127750);   i++;
			s.options[i] = new Option('Refused after starting treatment', 166222);  i++;
			s.options[i] = new Option('Refused Screening', 165891);  i++;
                        }
			s.options[i] = new Option('Other', 165657);

            if(getValue('patient_outcome.value') != ''){
		      document.getElementById("patient_outcome_select").value = getValue('patient_outcome.value');
			  showOutcomeQuestion(getValue('patient_outcome.value'));
            }		

			var s= document.getElementById('followup_loss_select');
			i = 0;
			s.options[i] = new Option('', '');   i++;
			s.options[i] = new Option('Patient refused follow-up', 165156);   i++;
			s.options[i] = new Option('Substance abuse', 112603);   i++;
			s.options[i] = new Option('Social problem', 164340);   i++;
			s.options[i] = new Option('Left region/country', 165158);   i++;
			s.options[i] = new Option('Adverse events', 164295);   i++;
			s.options[i] = new Option('No confidence in treatment', 165159);   i++;
			if(flag){
				s.options[i] = new Option('Contact not established', 166220);   i++;
				s.options[i] = new Option('Index patient refused treatment', 165892);   i++;
				s.options[i] = new Option('Index patient is lost to follow up', 166225);   i++; 
			}
			s.options[i] = new Option('Other', 164482);   i++;
			s.options[i] = new Option('Unknown', 1067);  
			
			if(getValue('followup_loss.value') != ''){
		      document.getElementById("followup_loss_select").value = getValue('followup_loss.value');
            }
			
		});
			
	}
	
	function showOutcomeQuestion(outcome){
	
		if(outcome == 159874){
		
		    if(getValue('dr_confirmation.value') == ''){
				setValue('dr_confirmation.value','1066');
				setValue('reason_for_failure.value','165149');
			}
			$j('#dr_confirmation_div').show();
			$j('#reason_for_failure_div').show();
			
			if(getValue('dr_confirmation.value') == 1065){
				  $j('#enrs_div').show();
			}
			
			if(getValue('reason_for_failure.value') == 165668){
				  $j('#reason_for_failure_other_div').show();
			}
			
		}else{
			setValue('dr_confirmation.value','');
			setValue('reason_for_failure.value','');
			setValue('reason_for_failure_other.value','');	
			$j('#dr_confirmation_div').hide();
			$j('#enrs_div').hide();
			$j('#reason_for_failure_div').hide();
			$j('#reason_for_failure_other_div').hide();
		}
		
		if(outcome == 160034){
		
		    $j('#death_date_div').show();
			$j('#primary_cause_of_death_div').show();
			
			if(getValue('primary_cause_of_death.value') == ''){
				setValue('primary_cause_of_death.value','1067');
			}
			
			if(getValue('primary_cause_of_death.value') == 165143){
				  $j('#death_cause_other_than_tb_div').show();
			}
		
		} else {
		    
			setValue('death_date.value','');
			setValue('primary_cause_of_death.value','');
			setValue('death_cause_other_than_tb.value','');
			$j('#death_date_div').hide();
			$j('#primary_cause_of_death_div').hide();
			$j('#death_cause_other_than_tb_div').hide();
		}
		
		if(outcome == 164791){
		
			$j('#transferred_out_div').show();
			
			if(getValue('transferred_out.value') == ''){
				setValue('transferred_out.value','1065');
			}
			
			if(getValue('transferred_out.value') == 1066){
				  $j('#not_evaluated_other_div').show();
			}
		
		} else {
		
			setValue('transferred_out.value','');
			setValue('not_evaluated_other.value','');
			$j('#transferred_out_div').hide();
			$j('#not_evaluated_other_div').hide();
		}
		
		if(outcome == 165657){
		
			$j('#other_outcome_div').show();

		} else  	
			$j('#other_outcome_div').hide();
			
		if(outcome == 159492){
		
			$j('#transfer_out_location_div').show();
			
			if(getValue('transfer_out_location.value') != ''){
		      document.getElementById("facility_list_1").value = getValue('transfer_out_location.value');
            } 
		
		}else{
			$j('#transfer_out_location_div').hide();
			setValue('transfer_out_location.value','');
			document.getElementById("facility_list_1").value = "";

		}
			
		if(outcome == 159492 || outcome == 1648){
		
			$j('#transferred_initiated_div').show();
			$j('#contact_info').show();
			
			if(getValue('transferred_initiated.value') == ''){
				setValue('transferred_initiated.value','1067');
			}
			
			if(getValue('reason_treatment_not_initiated.value') == 164438){
				  $j('#other_reason_treatment_not_initiated').show();
			}
			
			if(getValue('transferred_initiated.value') == 1066){
				  $j('#reason_treatment_not_initiated').show();
			}
		
		}	else {
	
			$j('#contact_info').hide();
			setValue('first_name.value','');
			setValue('last_name.value','');
			setValue('refcontact_number.value','');
			setValue('transferred_initiated.value','');
			setValue('reason_treatment_not_initiated.value','');
			setValue('other_reason_treatment_not_initiated.value','');
			$j('#transferred_initiated_div').hide();
			$j('#reason_treatment_not_initiated_div').hide();
			$j('#other_reason_treatment_not_initiated_div').hide();		
		}
		
		if(outcome == 160031){
		
			$j('#followup_loss_div').show();
			document.getElementById("followup_loss_select").value = 165156;
		
		}
		else {
		
			$j('#followup_loss_div').hide();
			document.getElementById("followup_loss_select").value = '';
			$j('#other_reason_for_followup_loss_div').hide();
			document.getElementById("other_reason_for_followup_loss").value = '';
		}

	
	}
	
	beforeSubmit.push(function() {
            var error=true;
			
			var e = document.getElementById("patient_outcome_select");
			var locationDescription = e.options[e.selectedIndex].text;
			var locationName = e.options[e.selectedIndex].value;
			setValue('patient_outcome.value',locationName);
			
			if(locationName == 159874){
			
			  if(getValue('dr_confirmation.value') == ''){
			  
				error = false;
				getField('dr_confirmation.error').html('Required field').show();
				
			  } else  {
			  
				getField('dr_confirmation.error').html('').hide();
				
				if(getValue('dr_confirmation.value') == 1065){
					var enrs = document.getElementsByName('enrs_id')[0].value;
					if(enrs==null || enrs==''){
						alert('ENRS can not be null');
						error=false;
					}
				}

				
			  }
			  
			
			  if(getValue('reason_for_failure.value') == ''){
			  
				error = false;
				getField('reason_for_failure.error').html('Required field').show();
				
			  } else  {
			  
				getField('reason_for_failure.error').html('').hide();
				if(getValue('reason_for_failure.value') == 165668 &amp;&amp; getValue('reason_for_failure_other.value') == ''){
				
					error = false;
					getField('reason_for_failure_other.error').html('Required field').show();
				
				} else{
				  	getField('reason_for_failure_other.error').html('').hide();

				}
				
			  }
			
			
			} else if(locationName == 160034){
			  
			  if(getValue('primary_cause_of_death.value') == ''){
			  
				error = false;
				getField('primary_cause_of_death.error').html('Required field').show();
				
			  } else {
			    
				getField('primary_cause_of_death.error').html('').hide();
				if(getValue('primary_cause_of_death.value') == 165143 &amp;&amp; getValue('death_cause_other_than_tb.value') == ''){
				
					error = false;
					getField('death_cause_other_than_tb.error').html('Required field').show();
				
				} else{
				  	getField('death_cause_other_than_tb.error').html('').hide();

				}
				

			 }
			
			
			} else if(locationName == 164791){
			
				
			  if(getValue('transferred_out.value') == ''){
			  
				error = false;
				getField('transferred_out.error').html('Required field').show();
				
			  } else {
			    
				getField('transferred_out.error').html('').hide();
				if(getValue('transferred_out.value') == 1066 &amp;&amp; getValue('not_evaluated_other.value') == ''){
				
					error = false;
					getField('not_evaluated_other.error').html('Required field').show();
				
				} else{
				  	getField('not_evaluated_other.error').html('').hide();

				}
				

			 }
				
			
			} else if(locationName == 159492 || locationName == 1648){
			
				if(getValue('first_name.value') == ''){
			  
					error = false;
					getField('first_name.error').html('Required field').show();
				
				} else getField('first_name.error').html('').hide();
				
				if(getValue('last_name.value') == ''){
			  
					error = false;
					getField('last_name.error').html('Required field').show();
				
				} else getField('last_name.error').html('').hide();
				
				if(getValue('refcontact_number.value') == ''){
			  
					error = false;
					getField('refcontact_number.error').html('Required field').show();
				
				}
				
				else{ 
				
					var mobileNumberRegex = new RegExp(/03\d{2}-\d{7}/);
					if(!mobileNumberRegex.test(getValue('refcontact_number.value'))) { 
							getField('refcontact_number.error').html('Invalid Mobile Number. Please enter Mobile Number in following format: 03xx-xxxxxxx').show();
							error=false;
						}
						else{
							getField('refcontact_number.error').html('').hide();
						}
				
				}
			
				if(locationName == 159492 &amp;&amp; getValue('transfer_out_location.value') == ''){
			  
					error = false;
					getField('transfer_out_location.error').html('Required field').show();
				
				} else getField('transfer_out_location.error').html('').hide();
				
				if(getValue('transferred_initiated.value') == ''){
			  
					error = false;
					getField('transferred_initiated.error').html('Required field').show();
				
				} else {
				
					getField('transferred_initiated.error').html('').hide();
					if(getValue('transferred_initiated.value') == 1066 &amp;&amp; getValue('reason_treatment_not_initiated.value') == ''){
				
					error = false;
					getField('reason_treatment_not_initiated.error').html('Required field').show();
				
					} else{
						getField('reason_treatment_not_initiated.error').html('').hide();
						if(getValue('reason_treatment_not_initiated.value') == 164438 &amp;&amp; getValue('other_reason_treatment_not_initiated.value') == ''){
				
							error = false;
							getField('other_reason_treatment_not_initiated.error').html('Required field').show();
				
						} else getField('other_reason_treatment_not_initiated.error').html('').hide();

					}
					
				}
			
			} else if (locationName == 160031){
			
				var e = document.getElementById("followup_loss_select");
				var locationDescription = e.options[e.selectedIndex].text;
				var locationName = e.options[e.selectedIndex].value;
				
				if(locationName == ''){
				error = false;
					  document.getElementById('loss_error').innerHTML = 'Required field';
					  }
				else {
					document.getElementById('loss_error').innerHTML = '';
					setValue('followup_loss.value',locationName);
					
					if(locationName == 164482 &amp;&amp; getValue('other_reason_for_followup_loss.value') == ''){
					error= false;
					getField('other_reason_for_followup_loss.error').html('Required field').show();
					} else {
					getField('other_reason_for_followup_loss.error').html('').hide();
					}
					
					
				}
				
			}
			
            if(error==false){
				return false;
            }
            else{
				var endDate = new Date();
                var timeDiff = Math.abs(endDate.getTime() - startDate.getTime());
				var diffSec = timeDiff/1000;
				alert(diffSec + " seconds to fill form");
				
				getField("transfer_out_location.value").prop('disabled',false);
				
				var enrs = document.getElementsByName('enrs_id')[0].value;
				getPatientAndUpdateENRS(enrs);
				
                return true;
            } 
		});
		
		function getPatientAndUpdateENRS(enrsNumber) {
		
			var patientId =  '<lookup expression="patient.getPatientIdentifier(3)"/>';
		
			jQuery.ajax({
					url: "/openmrs/ws/rest/v1/patient?q=" + patientId + "",
					dataType: 'json'
					}).done(function(data ) {

                                               
						console.log("patient display : " + data.results[0]['display']);
						console.log("patient uuid : " + data.results[0]['uuid']);
						patientUuid = data.results[0]['uuid'];
						savePatientIdentifiers(enrsNumber);		
				});
		}
		
		function savePatientIdentifiers(enrsNumber) {
		
			jQuery.ajax({
					url: "/openmrs/ws/rest/v1/patient/" + patientUuid + "/identifier",
                    processData: false,
                    type: "POST",
					data: JSON.stringify({"identifier": enrsNumber, "identifierType": "0481be90-41be-4aa2-b0dc-0e82ccff6f5c", "preferred": true, "voided": false}),
                    contentType: "application/json"
					}).done(function(data ) {
						console.log(data['display']);
				});
		}

jQuery(function() {

getField("transfer_out_location.value").prop('disabled',true);

var outcome = document.getElementById("patient_outcome_select");
        outcome.onchange = function(){
                var e = document.getElementById("patient_outcome_select");
				var locationDescription = e.options[e.selectedIndex].text;
                var locationName = e.options[e.selectedIndex].value;
				showOutcomeQuestion(locationName);
				
										
		};
		
var loss = document.getElementById("followup_loss_select");
        loss.onchange = function(){
                var f = document.getElementById("followup_loss_select");
				var locationDescription = f.options[f.selectedIndex].text;
                var locationName = f.options[f.selectedIndex].value;
				if(locationName == 164482){
					$j('#other_reason_for_followup_loss_div').show();
				} else {
					$j('#other_reason_for_followup_loss_div').hide();
					setValue('other_reason_for_followup_loss.value','');
				}
							
		};		
		
		getField('dr_confirmation.value').change(function() {
			if(getValue('dr_confirmation.value') == 1065){
				  $j('#enrs_div').show();
			} else {
				$j('#enrs_div').hide();
			}   
		});
		
		
		getField('reason_for_failure.value').change(function() {
			if(getValue('reason_for_failure.value') == 165668){
				  $j('#reason_for_failure_other_div').show();
			} else {
				$j('#reason_for_failure_other_div').hide();
				setValue('reason_for_failure_other.value','');	
			}   
		});
		
		getField('primary_cause_of_death.value').change(function() {
			if(getValue('primary_cause_of_death.value') == 165143){
				  $j('#death_cause_other_than_tb_div').show();
			} else {
				$j('#death_cause_other_than_tb_div').hide();
				setValue('death_cause_other_than_tb.value','');	
			}   
		});
		
		getField('transferred_out.value').change(function() {
			if(getValue('transferred_out.value') == 1066){
				  $j('#not_evaluated_other_div').show();
			} else {
				$j('#not_evaluated_other_div').hide();
				setValue('not_evaluated_other.value','');	
			}   
		});
		
		getField('transferred_initiated.value').change(function() {
			if(getValue('transferred_initiated.value') == 1066){
				  $j('#reason_treatment_not_initiated_div').show();
			} else {
				$j('#reason_treatment_not_initiated_div').hide();
				$j('#other_reason_treatment_not_initiated_div').hide();
				setValue('reason_treatment_not_initiated.value','');
				setValue('other_reason_treatment_not_initiated.value','');
			}   
		});
		
		getField('reason_treatment_not_initiated.value').change(function() {
			if(getValue('reason_treatment_not_initiated.value') == 164438){
				  $j('#other_reason_treatment_not_initiated_div').show();
			} else {
				$j('#other_reason_treatment_not_initiated_div').hide();
				setValue('other_reason_treatment_not_initiated.value','');	
			}   
		});
		
		var facilities1 = document.getElementById("facility_list_1");
        facilities1.onchange = function(){
                var e1 = document.getElementById("facility_list_1");
				var locationDescription1 = e1.options[e1.selectedIndex].text;
                var locationName1 = e1.options[e1.selectedIndex].value;
				setValue('transfer_out_location.value',locationName1 );
										
		};

});


function doRest2(){
			jQuery.ajax({
				url: "/openmrs/ws/rest/v1/location?v=custom:(uuid,display,name,description)&amp;tag=Transfer Location",
				dataType: 'json'
				}).done(function(data ) {
					console.log(data.results[0].name);
					console.log(data.results.length);
					locationData = data;
					populate2(data);
			});
		}
		
		function populate2(data) {
										
			var s1= document.getElementById('facility_list_1');
			
			for (i = 0; i &lt; data.results.length; i++) { 
				s1.options[i+1]= new Option(data.results[i].description, data.results[i].name);
				var resultObject =  JSON.parse(JSON.stringify(data.results[i].description || null));
			}
			
			s1.options[i+1] = new Option('Other', 'Other');		
		
		}


</script>

</htmlform>