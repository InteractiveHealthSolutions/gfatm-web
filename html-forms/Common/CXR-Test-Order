<htmlform>
	<!-- Autogenerated example form  (template from 01-Nov-2010 -->
	<macros>
		paperFormId = (Fill this in)
		headerColor =#009d8e
		fontOnHeaderColor = white
	</macros>

	<style>
		.section {
			border: 1px solid $headerColor;
			padding: 2px;
			text-align: left;
			margin-bottom: 1em;
		}
		.sectionHeader {
			background-color: $headerColor;
			color: $fontOnHeaderColor;
			display: block;
			padding: 2px;
			font-weight: bold;
		}
		table.baseline-aligned td {
			vertical-align: baseline;
		}
	</style>

	<span style="float:right">Paper Form ID: $paperFormId</span>
	<h2>CXR Test Order(v1.0.0)</h2>

	<section headerLabel="1. Encounter Details">
		<table class="baseline-aligned">
			<tr>
				<td>Date:</td>
				<td><encounterDate default="today"  id="encounter_date"/></td>
			</tr>
			<tr>
				<td>Location:</td>
				<td><encounterLocation default="2"   /></td>
			</tr>
			<tr>
				<td>Provider:</td>
				<td><encounterProvider default="currentUser" type="autocomplete"/></td>
			</tr>
		</table>
	</section>

	<section headerLabel="2. CXR Order">
         <div>
			<p> 
				Has the patient had an X-Ray in the past 6 months at an X-Ray Van?
				<br/>
				<obs conceptId="165712" id="past_xray">
					<controls>
						<when value="1066" thenDisplay="#testid_xray"/>
					</controls>
				</obs>
			</p>

		<div id="pregnancy_history_div">
			<p> 
				Is the patient pregnant?
				<br/>
				<obs conceptId="5272" id="pregnancy_history" answerConceptIds="1065,1066">
					
				</obs>
			</p>
		</div>
			
		<div id="testid_xray">
			<p> 
				Reason for X-ray?
					<br/>
					<obs conceptId="165824" id="reason_for_xray" answerConceptIds="164239,166050,166051" answerLabels="Screening,Baseline Diagnostic,Follow up">
						<controls>
						<when value="166051" thenDisplay="#f_month"/>
						</controls>
					</obs>
			</p>
		
			<p id="div1"> 
				What type of X Ray is this?
				<br/>
					
					<obsgroup groupingConceptId="164326" id="close_contact_type">
						<obs conceptId="164326" answerConceptId="12" style="checkbox" answerLabel="Chest X-Ray (CAD4TB)" id="opt_1"/>
						<br/>
						<obs conceptId="164326" answerConceptId="309"  style="checkbox" answerLabel="Chest X Ray (Other)" />							
					</obsgroup>
			</p>
				
			<p id="f_month"> 
				Month of treatment*
				<br/>
				<obs conceptId="164327"  id="followup_month" />
			</p>
		</div>

		<div id="order_div">
			<p>
				Order ID
				<br/>
				<obs conceptId="165715" id="order_id" allowTime="false"  maxLength="20" size="16"  />
			</p>
		</div>
		
			
		</div>
	</section>

	<submit/>

<script type="text/javascript">
	 
	var patientgender='<lookup expression="patient.gender"/>'
    if(patientgender == "famale" || patientgender == "F"){
		$j('#pregnancy_history_div').show();
	}else{
		$j('#pregnancy_history_div').hide();
	}

	var startDate = new Date();
	var orderId = (new Date ((new Date((new Date(new Date())).toISOString() )).getTime() - ((new Date()).getTimezoneOffset()*60000))).toISOString().slice(0, 19).replace('T', ' ');
	
	<ifMode mode="EDIT" include="false">
		
		jQuery(function() {
			setValue('order_id.value', orderId);				
		});
	</ifMode>
	
	
	jQuery(window).bind("load", function() {
			<ifMode mode="EDIT">
					
				getField('past_xray.value').change(function() {
						if(getValue('past_xray.value')==1066 &amp;&amp; getValue('order_id.value')==''){
						var startDate = new Date();
						var orderId = (new Date ((new Date((new Date(new Date())).toISOString() )).getTime() - ((new Date()).getTimezoneOffset()*60000))).toISOString().slice(0, 19).replace('T', ' ');
						setValue('order_id.value', orderId);	
					}
				});
				
				
			</ifMode>
		
		});
			

 jQuery(function() {
		getField("order_id.value").prop('disabled',true);

		getField('followup_month.value').change(function() {
				if(getValue('followup_month.value').length &gt; 2){
						getField('followup_month.error').html('Can not be greater than 2 digits').show();
				}else{
					getField('followup_month.error').html('').hide();
				}
		
		});
		
		getField('past_xray.value').change(function() {
				 if(getValue('past_xray.value')==1066){
					$j('#testid_xray').show();
					document.getElementById("order_div").style.visibility = "visible";
				}else{
					$j('#testid_xray').hide();
					document.getElementById("order_div").style.visibility = "hidden";
				}
		});
		
	});

	
				
	beforeSubmit.push(function() {
		var error=true;
		var cond=true;
		setValue('followup_month.error', '');
		setValue('pregnancy_history.error', '');
                
		if(getValue('reason_for_xray.value') == 166051 &amp;&amp; getValue('followup_month.value')==''){
			getField('followup_month.error').html('This field can not be null').show();
			error=false;
		}else if(getValue('reason_for_xray.value') == 166051 &amp;&amp; getValue('followup_month.value') &lt; 0  || getValue('followup_month.value') &gt; 24){
			getField('followup_month.error').html('Value out of range. It should be between 0-24').show();
			error=false;
		}
		else if(getValue('reason_for_xray.value') == 166051 &amp;&amp; getValue('followup_month.value').indexOf('.') > -1){                 	
				getField('followup_month.error').html('Follow up month can not be in decimal').show();
				error=false;
		}else{
			getField('followup_month.error').html('').hide();
		}

		var len = jQuery('#div1 input[type=checkbox]:checked').length;
        if (len > 0) {
			cond = false;
        } 
		
		
		if(getValue('past_xray.value')==1066){
			if(cond==true){
				getField('opt_1.error').html('This field can not be null').show();
				error=false;
			}else{
				getField('opt_1.error').html('').hide();
			}
		}
		
		

		if(getValue('past_xray.value')==''){
			getField('past_xray.error').html('This field can not be null').show();
			error=false;
        }else{
			getField('past_xray.error').html('').hide();
		}
		
		if(getValue('past_xray.value')==1066 &amp;&amp; getValue('reason_for_xray.value')==''){
			getField('reason_for_xray.error').html('This field can not be null').show();
			error=false;
        }else{
			getField('reason_for_xray.error').html('').hide();
		}
		
		if((patientgender == "famale" || patientgender == "F") &amp;&amp; getValue('pregnancy_history.value')==''){
			getField('pregnancy_history.error').html('This field can not be null').show();
			error=false;
		}
		else{
			getField('pregnancy_history.error').html('').hide();
		}

		
		if(error==false){
			return false;
		}
		else{
			if(getValue('past_xray.value')==1066){
					getField("order_id.value").prop('disabled',false);
			}
			var endDate = new Date();
			var timeDiff = Math.abs(endDate.getTime() - startDate.getTime());
			var diffSec = timeDiff/1000;
			alert(diffSec + " seconds to fill form");
			return true;
		}
	});

</script>

<!-- END OF FORM

Simple examples to copy-and-paste. Full reference at http://wiki.openmrs.org/x/kg8z

SECTION
	<section headerLabel="\#. Title">
		Content
	</section>

NUMERIC OBSERVATION
	<obs conceptId="id-of-numeric-concept" labelText="Label before"/>

DATE OBSERVATION
	<obs conceptId="id-of-date-concept" labelText="Label before"/>

CODED OBSERVATION
(as a dropdown)
	<obs conceptId="id-of-coded-concept" labelText="Label before"/>
(as radio buttons)
	<obs conceptId="id-of-coded-concept" labelText="Label before" style="radio"/>
(as an autocomplete)
	<obs conceptId="id-of-coded-concept" labelText="Label before" style="autocomplete" answerClasses="Diagnosis"/>
(as a checkbox for a specific answer)
	<obs conceptId="id-of-coded-concept" labelText="Label before" answerConceptId="id-of-answer-concept" answerLabel="label for answer"/>
(as a dropdown with specific choices)
	<obs conceptId="id-of-coded-concept" labelText="Label before" answerConceptIds="concept-id-1,concept-id-2,concept-id-3" answerLabels="Label 1,Label 2, Label 3"/>


FREE TEXT OBSERVATION
(as a normal text field)
	<obs conceptId="id-of-text-concept" labelText="Label before"/>
(as a textarea)
	<obs conceptId="id-of-text-concept" labelText="Label before" rows="4" cols="80"/>
-->
</htmlform>