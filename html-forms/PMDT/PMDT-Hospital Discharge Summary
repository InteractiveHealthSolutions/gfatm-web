<htmlform>
	<!-- Autogenerated example form  (template from 01-Nov-2010 -->
	<macros>
		paperFormId = (Fill this in)
		headerColor =#009d8e
		fontOnHeaderColor = white
	</macros>

	<style>
		.section {
			border: 1px solid $headerColor;
			padding: 2px;
			text-align: left;
			margin-bottom: 1em;
		}
		.sectionHeader {
			background-color: $headerColor;
			color: $fontOnHeaderColor;
			display: block;
			padding: 2px;
			font-weight: bold;
		}
		table.baseline-aligned td {
			vertical-align: baseline;
		}
	</style>

	<span style="float:right">Paper Form ID: $paperFormId</span>
	<h2>PMDT-Hospital Discharge Summary (v0.0.1)</h2>

	<section headerLabel="1. Encounter Details">
		<table class="baseline-aligned">
			<tr>
				<td>Date:</td>
				<td><encounterDate default="today"/></td>
			</tr>
			<tr>
				<td>Location:</td>
				<td><encounterLocation default="2"  tags="PMDT" /></td>
			</tr>
			<tr>
				<td>Provider:</td>
				<td><encounterProvider default="currentUser" type="autocomplete"/></td>
			</tr>
		</table>
	</section>

	<section headerLabel="2. Adverse Event Form">
		<div>	
		
			<p>
			Hospital admission date:
			<br/>
			<obs id="date_hospital_admit" conceptId="1640" required="true"/>
			</p>

			<p>
			Hospital name
			<br/>
			<obs id="hospital_admit_facility" conceptId="1589"  required="true"/>
			</p>

			<p>
			Referral facility patient ID
			<br/>
			<obs id="hospital_admit_facility_id" conceptId="165195" />
			</p>

			<p>
			Hospital discharge date:
			<br/>
			<obs id="date_hospital_discharge" conceptId="1641" defaultValue="today" required="true"/>
			</p>

			<p>
			Main reason for hospitalisation
			<br/>
			<obs id="reason_hospitalization" conceptId="165196" answerConceptIds="164295,164459,165186,165035,165180,165187,165188,165189,165669,1067" 
			answerLabels="Adverse event,Comorbidity,Severe clinical condition,Treatment initiation,Infection control,Surgical operation,Patient behavior,Social reason,Other,Unknown" 
			defaultValue="164295" required="true"/>
			</p>

			<div id="display_reason_hospitalization_other">
			<p>
			If main reason 'Other', then specify:
			<br/>
			<obs id="reason_hospitalization_other" conceptId="165669" maxlength="100" />
			</p>
			</div>

			<p>
			Is the patient reporting a NEW Adverse Event?
			<br/>
			<obs id="new_adverse_event" conceptId="165128" answerConceptIds="1065,1066" answerLabels="Yes,No" defaultValue="1066" required="true"/>
			</p>

			<div id="display_adverse_events">
			<p>
			Adverse Event term:
			<br/>
			<obs id="adverse_events" conceptId="164295" 
			answerConceptIds="165202,165203,165204,159570,165205,147241,117399,116214,114257,165206,117460,126656,165228,165229,165230,165231,138281,138264,138253,129113,138111,138086,117356,138061,138056,117341,138039,138031,136162,139075,123588,123188,138176,117321,654,149125,126660,165208,165209,165210,165211,156769,165212,120860,119108,113257,996,142412,111,118789,114382,122983,140501,140238,139084,116130,114403,165213,165214,130737,121629,162183,140484,165217,165218,165219,2,165220,165221,135849,142904,165223,165224,165225,128331,165227,165232,165233,165234,165235,165236,165237,165238,5544,832,142630,115115,80,148432,121,165239,118877,165240,118789,142039,165241,165242,6004,206,125166,165243,165244,121543,119537,113517,165245,148143,121849,145438,148048,139223,119209,134345,132419,146871,143264,122496,460,118536,165246,165247,165248,879,165249,165250,840,128340,164294"		
			defaultValue="164294"  size="100" style="autocomplete" maxlength="150" />
			</p>
			</div>
			
			<div id="display_adverse_event_other">
			<p>
			If Adverse Event term 'Other', then specify:
			<br/>
			<obs id="adverse_event_other" conceptId="164294" maxlength="100" />
			</p>
			</div>
			
			<div id="display_add_adverse">
			<button id="add" class="add" >Add ADVERSE EVENT</button>
			<!--<textarea id="area"></textarea>-->
			<br/>
			<ifMode mode='View' >
			<b>ADVERSE EVENTS DURING HOSPITALISATION:</b>
			<br/>
			</ifMode>
			<obs id="area" conceptId="166124" maxlength="500" style="textarea" rows="15"  cols="60" />
			</div>

			<p>
			Does patient have an ongoing Adverse Event that does not have a final outcome?
			<br/>
			<obs id="ongoing_ae" conceptId="165129" answerConceptIds="1065,1066" answerLabels="Yes,No" defaultValue="1065" required="true"/>
			</p>

			<p>
			Are there any medication changes resulting from this hospital admission?
			<br/>
			<obs id="medication_changes" conceptId="165251" answerConceptIds="1065,1066" answerLabels="Yes,No" defaultValue="1066" required="true"/>
			</p>

			<p>
			Discharge diagnosis
			<br/>
			<obs id="hospital_discharge_diagnosis" conceptId="1642" maxlength="255" style="textarea"/>
			</p>

			<p>
			Hospital course
			<br/>
			<obs id="hospital_course" conceptId="165252" maxlength="1000" style="textarea"/>
			</p>

			<p>
			Did the patient receive TB-related surgery during the hospital admission?
			<br/>
			<obs id="tb_surgery" conceptId="165253" answerConceptIds="1065,1066" answerLabels="Yes,No" defaultValue="1066" required="true"/>
			</p>

			<div id="display_date_tb_surgery">
			<p>
			If Yes, TB-related surgery date:
			<br/>
			<obs id="date_tb_surgery" conceptId="165254"  />
			</p>
			</div>

			<div id="display_tb_surgery_type">
			<p>
			If Yes, type of surgery:
			<br/>
			<obs id="tb_surgery_type" conceptId="165261" answerConceptIds="165255,165256,165257,165258,165259,165260" 
			answerLabels="Pneumonectomy,Lobectomy,Segmental or wedge resection,Decortication,Thoracostomy,Other" defaultValue="165260" />
			</p>
			</div>

			<div id="display_tb_surgery_type_other">
			<p>
			If type of surgery 'Other', then specify:
			<br/>
			<obs id="tb_surgery_type_other" conceptId="165260" maxlength="100" />
			</p>
			</div>

			<div id="display_tb_surgery_site">
			<p>
			If yes, site of TB surgery
			<br/>
			<obs id="tb_surgery_site" conceptId="165274" 
			answerConceptIds="165262,165263,165264,165265,165266,165267,165268,165269,165270,165271,165272,162670,165273" 
			answerLabels="Left lung,Right lung,Liver,Left kidney,Right kidney,Uterus,Pancreas,Small intestine,Large intestine,Brain,Throat,Stomach,Other" 
			defaultValue="165273" />
			</p>
			</div>

			<div id="display_tb_surgery_site_other">
			<p>
			If site of TB 'Other', then specify:
			<br/>
			<obs id="tb_surgery_site_other" conceptId="165273" maxlength="100" />
			</p>
			</div>

			
			<div id="display_surgery_indication">
			<p>
			If Yes, indication for surgery:
			<br/>
			<div id="display_surgery_indication_child">
				<obsgroup  id="tb_surgery_indication" groupingConceptId="165346" >					
					<obs conceptId="165346" id="failure" answerConceptId= "165340" answerLabel="Failure of culture conversion" style="checkbox" value="true" /><br/>						
					<obs conceptId="165346" id="destroyed" answerConceptId= "165341" answerLabel="Destroyed or trapped lung" style="checkbox" /><br/>					
					<obs conceptId="165346" id="complicated" answerConceptId= "165342" answerLabel="Complicated/persistent cavit(ies)" style="checkbox" /><br/>					 
					<obs conceptId="165346" id="massive" answerConceptId= "165343" answerLabel="Massive Hemoptysis" style="checkbox" /><br/>						 
					<obs conceptId="165346" id="empyema" answerConceptId= "141335" answerLabel="Empyema" style="checkbox" /><br/>
					<obs conceptId="165346" id="reoperation" answerConceptId= "165344" answerLabel="Re-operation for complication" style="checkbox" /><br/>						 
					<obs conceptId="165346" id="other_tb_surgery_indication" answerConceptId= "165345" answerLabel="Other" style="checkbox" defaultValue="165345"  /><br/>
				</obsgroup>	
			</div>
			</p>
			</div>
			
			<div id="display_tb_surgery_indication_other">
			<p>
			If indication for surgery 'other', then specify:
			<br/>
			<obs id="tb_surgery_indication_other" conceptId="165345" maxlength="100" />
			</p>
			</div>
			
			<p>
			Upload discharge summary scan if available 
			<br/>
			<br/>
			<font color="red">Error will be generated If the File size is Greater than <b>74 MB</b></font>
			<br/>
			
			<obs id="discharge_summary_scan" conceptId="166103"/>
			</p>
			
		
			<div id="time_taken_div">
			<p> 
			Time taken to fill form
			<br/>
			<obs id="time_taken" conceptId="165044" />
			</p>
			</div>
		</div>
	</section>

	<submit/>
	
	<script type="text/javascript">
		var startDate = new Date();	
	
	    var reason_hospitalization_other = jQuery("#display_reason_hospitalization_other");
		var	adverse_events = jQuery("#display_adverse_events");
		var	add_adverse = jQuery("#display_add_adverse");	
		var	adverse_event_other = jQuery("#display_adverse_event_other");
		var	date_tb_surgery = jQuery("#display_date_tb_surgery");
		var	tb_surgery_type = jQuery("#display_tb_surgery_type");
		var	tb_surgery_type_other = jQuery("#display_tb_surgery_type_other");
		var	tb_surgery_site = jQuery("#display_tb_surgery_site");
		var	tb_surgery_site_other = jQuery("#display_tb_surgery_site_other");
		var	surgery_indication = jQuery("#display_surgery_indication");
		var	tb_surgery_indication_other= jQuery("#display_tb_surgery_indication_other");
		
		var surgery_indication_check = false;
		
   
jQuery( document ).ready(function() {

		var timeTakenDiv = jQuery("#time_taken_div");
		timeTakenDiv.hide();
		
		
		getField("date_hospital_admit.value").prop("disabled", true);
		getField("hospital_admit_facility.value").prop("disabled", true);
		getField("hospital_admit_facility_id.value").prop("disabled", true);
		
		<ifMode mode='VIEW' > 
		jQuery("#adverse_events > span").text('');
		</ifMode> 
		
		getField("adverse_events.value").prop("disabled", false);
		getField("adverse_event_other.value").prop("disabled", false);
		
		
		<ifMode mode='VIEW' include="false"> 
		setValue("adverse_events.value","");//remove value at start
		
		if(! isHospitalAdmissionNotificationFormFilled()){
			alert("Please Fill PMDT-Hospital Admission Notification	Form First");
		}
		else{
			getDataFromHospitalAdmissionNotificationForm();
		}
								 		
		if(getValue('reason_hospitalization.value') == 165669 ){
			reason_hospitalization_other.show();
		}
		else{
			reason_hospitalization_other.hide();					
		}
		
		//1
		if(getValue('new_adverse_event.value') == 1065 ){
			adverse_events.show();
			add_adverse.show();
		}
		else{
			adverse_events.hide();
			adverse_event_other.hide();
			add_adverse.hide();			
		}
		
		if(getValue('new_adverse_event.value') == 1065 &amp;&amp; getValue('adverse_events.value') == "OTHER ADVERSE EVENT" ){
			adverse_event_other.show();
		}
		else{
			adverse_event_other.hide();					
		}
		//1
		
		///////////////////////////////
		if(getValue('tb_surgery.value') == 1065 ){
			date_tb_surgery.show();
			tb_surgery_type.show();
			tb_surgery_type_other.show();
			tb_surgery_site.show();
			tb_surgery_site_other.show();
			surgery_indication.show();
			
		}
		else{
			date_tb_surgery.hide();
			tb_surgery_type.hide();
			tb_surgery_type_other.hide();
			tb_surgery_site.hide();
			tb_surgery_site_other.hide();
			surgery_indication.hide();
			tb_surgery_indication_other.hide();			
		}
		
		if( getValue('tb_surgery.value') == 1065 &amp;&amp; getValue('tb_surgery_type.value') == 165260 ){
			tb_surgery_type_other.show();
		}
		else{
			tb_surgery_type_other.hide();
		}
		
		if( getValue('tb_surgery.value') == 1065 &amp;&amp;  getValue('tb_surgery_site.value') == 165273 ){
			tb_surgery_site_other.show();
		}
		else{
			tb_surgery_site_other.hide();	
		}
		
		if( getValue('tb_surgery.value') == 1065 &amp;&amp; getField('other_tb_surgery_indication.value').prop('checked') ){
					tb_surgery_indication_other.show();
				}
		else{
			tb_surgery_indication_other.hide();
			setValue('tb_surgery_indication_other.value', "");			
		}
		
		</ifMode>
		
		});

function uncheckAllCheckBoxes(divName) {
	var divCompleteName = "#" + divName;
	$j(divCompleteName).find('input[type=checkbox]:checked').removeAttr('checked'); // Uncheck all the checkboxes
}

jQuery(":checkbox").click(function(){
	var $this = jQuery(this);
	var checkBoxId = jQuery(this).closest('span').attr('id')
								
	if($this.is(":checked") &amp;&amp; checkBoxId == "other_tb_surgery_indication") {
		tb_surgery_indication_other.show();
	}
	else if(checkBoxId == "other_tb_surgery_indication"){
			tb_surgery_indication_other.hide();
			setValue('tb_surgery_indication_other.value', "");
	}
});

jQuery(function() {
			getField('reason_hospitalization.value').change(function() {
			
				if(getValue('reason_hospitalization.value') == 165669 ){
					reason_hospitalization_other.show();
				}
				else{
					setValue('reason_hospitalization_other.value', ""); 
					reason_hospitalization_other.hide();					
				}
								
			});	
			//2
			getField('new_adverse_event.value').change(function() {
			
				if(getValue('new_adverse_event.value') == 1065 ){
					adverse_events.show();
					add_adverse.show();
				}
				else{
					setValue('adverse_events.value', ""); 
					setValue('adverse_event_other.value', ""); 
					adverse_events.hide();
					adverse_event_other.hide();	
					add_adverse.hide();			
					setValue('area.value', "");	
				}
				getField('adverse_events.value').change();
			});	
			
			getField('adverse_events.value').change(function() {
						
				if(getValue('adverse_events.value') == "OTHER ADVERSE EVENT" ){
					adverse_event_other.show();
				}
				else{
					setValue('adverse_event_other.value', ""); 
					adverse_event_other.hide();					
				}
			});
			//2
			
			///////////////////////////////
			getField('tb_surgery.value').change(function() {
				
				if(getValue('tb_surgery.value') == 1065 ){
					date_tb_surgery.show();
					tb_surgery_type.show();
					tb_surgery_type_other.show();
					tb_surgery_site.show();
					tb_surgery_site_other.show();
					surgery_indication.show();
				
				}
				else{
					setValue('date_tb_surgery.value', ""); 
					date_tb_surgery.hide();
					
					setValue('tb_surgery_type.value', ""); 
					tb_surgery_type.hide();
					
					setValue('tb_surgery_type_other.value', ""); 
					tb_surgery_type_other.hide();
					
					setValue('tb_surgery_site.value', ""); 
					tb_surgery_site.hide();
					
					setValue('tb_surgery_site_other.value', ""); 
					tb_surgery_site_other.hide();
					
					uncheckAllCheckBoxes("display_surgery_indication_child");
					surgery_indication.hide();
					
					setValue('tb_surgery_indication_other.value', ""); 
					tb_surgery_indication_other.hide();			
				}
				
				getField('tb_surgery_type.value').change();
				getField('tb_surgery_site.value').change();
				
				if( getField('other_tb_surgery_indication.value').prop('checked') ){
					tb_surgery_indication_other.show();
				}
				else{
					tb_surgery_indication_other.hide();
					setValue('tb_surgery_indication_other.value', "");			
				}
			});
			
			getField('tb_surgery_type.value').change(function() {
					if(getValue('tb_surgery_type.value') == 165260 ){
						tb_surgery_type_other.show();
					}
					else{
						setValue('tb_surgery_type_other.value', "");	
						tb_surgery_type_other.hide();
					}
			});
			
			getField('tb_surgery_site.value').change(function() {
							
					if(getValue('tb_surgery_site.value') == 165273 ){
						tb_surgery_site_other.show();
					}
					else{
						setValue('tb_surgery_site_other.value', "");
						tb_surgery_site_other.hide();	
					}
			});

});
		
beforeSubmit.push(function() {

	setValue('reason_hospitalization_other.error','');
	setValue('date_tb_surgery.error','');
	setValue('tb_surgery_type.error','');
	setValue('tb_surgery_type_other.error','');
	setValue('tb_surgery_site.error','');
	setValue('tb_surgery_site_other.error','');
	setValue('failure.error','');
	setValue('tb_surgery_indication_other.error','');
	setValue('hospital_admit_facility.error','');
	setValue('date_hospital_discharge.error','');
	setValue('date_hospital_admit.error','');
	setValue('area.error','');
	
	

	var valid=true;
	
	//date check
	///////////////////////////////////////////////////////
	if( getValue("date_hospital_admit.value")!='' &amp;&amp; getValue("date_hospital_discharge.value")!='' ) {
	
		if( compareDates(getValue("date_hospital_admit.value"),getValue("date_hospital_discharge.value")) ){
			valid = false;
			getField("date_hospital_discharge.error").html('Hospital Discharge Date can not be before Hospital Admission Date:. Please select correct Date.').show();
		}
		else {
			getField("date_hospital_discharge.error").html('').hide();
		}
	}
	else {
			getField("date_hospital_discharge.error").html('').hide();
	}
	//////////////////////////////////////////////////////////////
	
	if(getValue('reason_hospitalization.value') == 165669 &amp;&amp; (getValue('reason_hospitalization_other.value') =='' ) ){	
		getField('reason_hospitalization_other.error').html('Please input a value.').show();
		valid=false;		
	}
	else{
		getField('reason_hospitalization_other.error').html('').hide();
	}

	if(getValue('tb_surgery.value') == 1065 &amp;&amp; (getValue('date_tb_surgery.value') =='' ) ){	
		getField('date_tb_surgery.error').html('Please select a Date.').show();
		valid=false;		
	}
	//date check
	///////////////////////////////////////////////////////
	else if( getValue('tb_surgery.value') == 1065 &amp;&amp; getValue("date_hospital_admit.value")!='' &amp;&amp; getValue("date_hospital_discharge.value")!='' ) {
	
		if( compareDates(getValue("date_hospital_admit.value"),getValue("date_tb_surgery.value")) || 
			compareDates(getValue("date_tb_surgery.value"),getValue("date_hospital_discharge.value")) ){
			valid = false;
			getField("date_tb_surgery.error").html('TB-related Surgery date must be Between Hospital Admission Date and Hospital Discharge Date . Please select correct Date.').show();
		}
		else {
			getField("date_tb_surgery.error").html('').hide();
		}
	}
	//////////////////////////////////////////////////////////////
	///
	else{
		getField('date_tb_surgery.error').html('').hide();
	}	
	
	if(getValue('tb_surgery.value') == 1065 &amp;&amp; (getValue('tb_surgery_type.value') =='' ) ){	
		getField('tb_surgery_type.error').html('Please select a value.').show();
		valid=false;		
	}
	else{
		getField('tb_surgery_type.error').html('').hide();
	}	

	if( getValue('tb_surgery.value')== 1065 &amp;&amp; getValue('tb_surgery_type.value') == 165260 &amp;&amp; (getValue('tb_surgery_type_other.value') =='' ) ){	
		getField('tb_surgery_type_other.error').html('Please input a value.').show();
		valid=false;		
	}
	else{
		getField('tb_surgery_type_other.error').html('').hide();
	}

	if(getValue('tb_surgery.value') == 1065 &amp;&amp; (getValue('tb_surgery_site.value') =='' ) ){	
		getField('tb_surgery_site.error').html('Please select a value.').show();
		valid=false;		
	}
	else{
		getField('tb_surgery_site.error').html('').hide();
	}
	
	if( getValue('tb_surgery.value')== 1065 &amp;&amp; getValue('tb_surgery_site.value') == 165273 &amp;&amp; (getValue('tb_surgery_site_other.value') =='' ) ){	
		getField('tb_surgery_site_other.error').html('Please input a value.').show();
		valid=false;		
	}
	else{
		getField('tb_surgery_site_other.error').html('').hide();
	}	
	
	////////////////////adverse text check
	if( getValue('new_adverse_event.value')== 1065 &amp;&amp; getValue('area.value') =='' ) {	
		getField('area.error').html('Please Add Adverse Event.').show();
		valid=false;		
	}
	else{
		getField('area.error').html('').hide();
	}	
	
	////////////////////
	
/////////////////////////////checkbox valid checks for fields
	///
	if (jQuery("#display_surgery_indication_child input[type=checkbox]:checked").length > 0)
	{
		surgery_indication_check = true;
	}
	else
	{
		surgery_indication_check = false;
	}

	if(getValue('tb_surgery.value')== 1065 &amp;&amp; 	surgery_indication_check == false) {
		   getField('failure.error').html('Please select a value.').show();
		   valid=false;   
	}
	else {
		   getField('failure.error').html('').hide();
	}
	//
	if(getValue('tb_surgery.value')== 1065 &amp;&amp; getField("other_tb_surgery_indication.value").prop('checked')== true &amp;&amp; getValue('tb_surgery_indication_other.value')=='') {	
		   getField('tb_surgery_indication_other.error').html('Please input a value.').show();
		   valid=false;	   
	}
	else {
		   getField('tb_surgery_indication_other.error').html('').hide();
	}
///////////////////

	if(! isHospitalAdmissionNotificationFormFilled()){
		alert("Please Fill PMDT-Hospital Admission Notification Form First");
		getField('hospital_admit_facility.error').html('Please Fill PMDT-Hospital Admission Notification Form First').show();
		valid=false;		
	}
	else{
		getField('hospital_admit_facility.error').html('').hide();
	}
	
	if(valid==true){

		var timeTakenDiv = $j("#time_taken_div");
		
		var endDate = new Date();
		var timeDiff = Math.abs(endDate.getTime() - startDate.getTime());
		var diffSec = timeDiff/1000;
		
		timeTakenDiv.show();
		setValue("time_taken.value",diffSec);
		timeTakenDiv.hide();
		
		getField("date_hospital_admit.value").prop("disabled", false);
		getField("hospital_admit_facility.value").prop("disabled", false);
		getField("hospital_admit_facility_id.value").prop("disabled", false);
		
		//remove default value
		if( getValue('tb_surgery.value')!= 1065 ){
			setValue('tb_surgery_type.value',"");
			setValue('tb_surgery_site.value',"");
			getField("other_tb_surgery_indication.value").removeAttr('checked');
		}
		
		setValue("adverse_events.value","");
		setValue("adverse_event_other.value","");
		getField("adverse_events.value").prop("disabled", true);
		getField("adverse_event_other.value").prop("disabled", true);
	
		return true;
}
	return false;
});

function isHospitalAdmissionNotificationFormFilled(){		
		var isFilled=true;
		var latestEncounter = "<lookup complexExpression="#foreach($encounter in $fn.allEncounters('757dcfc3-63f1-4d2b-894b-b182d01b7b02'))  $fn.getObs($encounter, '1589').getValueAsString($!{locale}) #end"/>";		
		var hospitalAdmitFacilityResult = latestEncounter.replace(/\s\s+/g, '@');
        var hospitalAdmitFacilityResultArray = hospitalAdmitFacilityResult.split('@');
		var hospitalAdmitFacility = hospitalAdmitFacilityResultArray[hospitalAdmitFacilityResultArray.length-1];
		
		if( hospitalAdmitFacility==null || hospitalAdmitFacility=='' ){
			isFilled=false;
		}
		return isFilled;
}

function getDataFromHospitalAdmissionNotificationForm(){		
		var latestEncounter = "<lookup complexExpression="#foreach($encounter in $fn.allEncounters('757dcfc3-63f1-4d2b-894b-b182d01b7b02'))  $fn.getObs($encounter, '1589').getValueAsString($!{locale}) #end"/>";		
		var hospitalAdmitFacilityResult = latestEncounter.replace(/\s\s+/g, '@');
        var hospitalAdmitFacilityResultArray = hospitalAdmitFacilityResult.split('@');
		var hospitalAdmitFacility = hospitalAdmitFacilityResultArray[hospitalAdmitFacilityResultArray.length-1];
		
		var latestEncounter = "<lookup complexExpression="#foreach($encounter in $fn.allEncounters('757dcfc3-63f1-4d2b-894b-b182d01b7b02'))  $fn.getObs($encounter, '165195').getValueAsString($!{locale}) #end"/>";		
		var hospitalAdmitFacilityIdResult = latestEncounter.replace(/\s\s+/g, '@');
        var hospitalAdmitFacilityIdResultArray = hospitalAdmitFacilityIdResult.split('@');
		var hospitalAdmitFacilityId = hospitalAdmitFacilityIdResultArray[hospitalAdmitFacilityIdResultArray.length-1];
		
		var latestEncounter = "<lookup complexExpression="#foreach($encounter in $fn.allEncounters('757dcfc3-63f1-4d2b-894b-b182d01b7b02'))  $fn.getObs($encounter, '1640').getValueAsString($!{locale}) #end"/>";		
		var dateHospitalAdmitResult = latestEncounter.replace(/\s\s+/g, '@');
        var dateHospitalAdmitResultArray = dateHospitalAdmitResult.split('@');
		var dateHospitalAdmit = dateHospitalAdmitResultArray[dateHospitalAdmitResultArray.length-1];
		
		if( hospitalAdmitFacilityId==null || hospitalAdmitFacilityId=='' || hospitalAdmitFacilityId=="$fn.getObs($encounter, '165195').getValueAsString($!{locale}) "){
			hospitalAdmitFacilityId="";
		}
		
		setValue('date_hospital_admit.value',dateHospitalAdmit);
		setValue('hospital_admit_facility.value',hospitalAdmitFacility);
		setValue('hospital_admit_facility_id.value',hospitalAdmitFacilityId);	
		
		
		
}

function compareDates(startDate,endDate){
	
    startDate = new Date(startDate);
    endDate = new Date(endDate);
	
	startDate.setHours(0,0,0,0);
	endDate.setHours(0,0,0,0);
	
	var timeDiff = endDate.getTime() - startDate.getTime();
	var diffDays = Math.floor(timeDiff / (1000 * 3600 * 24));
  
	//true if diff is negative 
	if(diffDays &lt; 0){
		return true;
	}
	else{
		return false;
	}
}

	<ifMode mode='View' include="false">		
      jQuery('button.add').live("click", function(){
			
			console.log(document.getElementById("w22_hid").value);
			var adverseValueCheck =document.getElementById("w22_hid").value;
			
			//when adverse is invalid
			if( adverseValueCheck==null || adverseValueCheck=="" || adverseValueCheck=="ERROR"  ){
				//do not add adverse as concept and text is invalid
				alert("Please Select Correct Adverse Event");
			}
			else{
			
				var adverseValue =  getValue("adverse_events.value");
				
				//capture other text value alert when empty
				if(adverseValueCheck==164294){
					if(getValue("adverse_event_other.value")=="")
					{
						alert("Please Input a value in Adverse Event Other Text Field");
					}
					else{
						adverseValue=adverseValue+"("+getValue("adverse_event_other.value")+")";
						var allAdverseText=getValue("area.value");
						allAdverseText+=   "\n"+adverseValue+",";
						
						//check if already AE added
						var oldAdverse=getValue("area.value");
						
						if( oldAdverse.includes("OTHER ADVERSE EVENT")){
							alert("This Adverse Event is Already Added.");
						}
						else{
							setValue("area.value",allAdverseText);
						}
						
					}
					
				}
				//if other not selected
				else{
						var allAdverseText=getValue("area.value");
						allAdverseText+=   "\n"+adverseValue+",";
						
						//check if already AE added
						var enteredAdverse=getValue("adverse_events.value")+",";
						var oldAdverse=getValue("area.value");
						if( oldAdverse.includes(enteredAdverse)){
							alert("This Adverse Event is Already Added.");
						}
						else{
							setValue("area.value",allAdverseText);
						}
				}
				 
			}
			
			return false;
	  });
	  
	  
	</ifMode>

		
</script>
</htmlform>