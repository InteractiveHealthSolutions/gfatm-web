<htmlform>
	<!-- Developed by Wasim -->
	<!-- Autogenerated example form  (template from 01-Nov-2010 -->
	<macros>
		paperFormId = (Fill this in)
		headerColor =#009d8e
		fontOnHeaderColor = white
	</macros>

	<style>
		.section {
			border: 1px solid $headerColor;
			padding: 2px;
			text-align: left;
			margin-bottom: 1em;
		}
		.sectionHeader {
			background-color: $headerColor;
			color: $fontOnHeaderColor;
			display: block;
			padding: 2px;
			font-weight: bold;
		}
		table.baseline-aligned td {
			vertical-align: baseline;
		}
	</style>

	<span style="float:right">Paper Form ID: $paperFormId</span>
	<h2>PMDT-Referral Form (v0.0.1-alpha)</h2>

	<section headerLabel="1. Encounter Details">
		<table class="baseline-aligned">
			<tr>
				<td>Date:</td>
				<td><encounterDate default="today"/></td>
			</tr>
			<tr>
				<td>Location:</td>
				<td><encounterLocation default="1"/></td>
			</tr>
			<tr>
				<td>Provider:</td>
				<td><encounterProvider default="currentUser" type="autocomplete"/></td>
			</tr>
		</table>
	</section>

	<section headerLabel="2. Current Treatment Facility Information">
		<div>
			<p>
                Treatment start date
                <br/>
                    <lookup expression="fn.latestObs(163526).obsDatetime" />
                        </p>
			<p>
                National DR TB Registration number
                <br/>
                    <lookup expression="fn.latestObs(164925).obsDatetime" />
                       </p>
			
			<p id="treatment_facility">
  			    Current Treatment Facility
                            <br/>
				<obs conceptId="162724" id="facility_treatment" style="location" answerLocationTags="PMDT" required="true"/>
			</p>
			<div id="facility_other">
				<p> If treatment facility 'Other', then specify:
				<br/>
				<obs conceptId="164667" id="other_facility" maxlength="100" />
				</p>
			</div>

                         <p> Treatment facility focal person name
				<br/>
				<obs conceptId="165628" id="facility_focal_person_name" maxlength="50" />
		        </p>
		   
		   <p> Treatment facility focal person phone number
				<br/>
				<obs conceptId="165629" id="facility_focal_person_ph_number" maxlength="12" />
		   </p>
		   
		   <p> Treatment facility District Tuberculosis Coordinator name
				<br/>
				<obs conceptId="165630" id="facility_district_coordinator_name" maxlength="50" />
		   </p>
		   
		   <p> Treatment facility District Tuberculosis Coordinator number
				<br/>
				<obs conceptId="165631" id="facility_district_coordinator_number" maxlength="12" />
		   </p>
		   
		    <p> Name of clinician referring the patient
				<br/>
				<obs conceptId="165632" id="ref_clinician_name" maxlength="50" />
		   </p>


		</div>
	</section>
       <section headerLabel="3. Referral and Transfer Information">
            <div>
			<p>
 				Is this patient being referred out or transferred out?
                <br/>
				<obs conceptId="164408" id="referral_transfer" answerConceptIds="1648,160036" answerLabels="Referral (before starting treatment),Transfer (after starting treatment)" defaultValue="1648">
					<controls>
							<when value="1648" thenDisplay="#reason_referral_div"/>
							<when value="160036" thenDisplay="#reason_transfer_div"/>
					</controls>
				</obs>
			</p>
                        <p> Date of referral/transfer
				<br/>
				<obs conceptId="160534" id="date_referral" />
			</p>
                        <p>
				Referral facility
				<br/>
				<obs conceptId="161550" id="referral_site" required="true" style="location" answerLocationTags="PMDT" />				
			</p>
			<div id="location_other">
                               <p>
					If referral facility 'Other', then specify
					<br/>
					<obs conceptId="164667" id="referral_site_transfer_other" maxlength="50" />				
				</p>
			</div>
                        <p> Referral facility focal person name
				<br/>
				<obs conceptId="165633" id="referral_site_person_name" maxlength="50" />
		   </p>
		   <p> Referral facility focal person phone number
				<br/>
				<obs conceptId="165634" id="referral_site_person_number" maxlength="12" />
		   </p>
		   <p> Referral facility District Tuberculosis Coordinator name
				<br/>
				<obs conceptId="165635" id="referral_site_coordinator_name" maxlength="50" />
		   </p>
		   <p> Referral facility District Tuberculosis Coordinator number
				<br/>
				<obs conceptId="165636" id="referral_site_coordinator_number" maxlength="12" />
		   </p>
		    <p> Name of clinician referring the patient
				<br/>
				<obs conceptId="165632" id="ref_clinician_name" maxlength="50" />
		   </p>
		   <div id="reason_referral_div">
			   <p>
					Reason for Referral
					<br/>
					<obs conceptId="1887" id="reason_referral" required="true" answerConceptIds="165035,165180,164295,164459,165186,165187,165188,165189,164653" answerLabels="Treatment initiation,Infection control,Adverse Event,Comorbidity,Severe clinical condition,Surgical operation,Patient behavior,Social reason,Other">
					<controls>
						<when value="164653" thenDisplay="#reason_other"/>
					</controls>
					</obs>
					
				</p>
				<p id="reason_other">
					Reason, if Other
					<br/>
					<obs conceptId="164653" id="reason_referral_other" maxlength="100" />
				</p>
			</div>
                       
                        <div id="reason_transfer_div">
			   <p>
					Reason for Transfer
					<br/>
					<obs conceptId="162720" id="reason_transfer" required="true" answerConceptIds="165637,165638,165639,164653" answerLabels="Patient changing location,Patient willing to go back to his/her permanent residence location,Patient not satisfied with the PMDT,Other">
					<controls>
						<when value="164653" thenDisplay="#reason_transfer_other_div"/>
					</controls>
					</obs>
					
				</p>
				<p id="reason_transfer_other_div">
					If reason for Transfer 'Other', then specify
					<br/>
					<obs conceptId="164653" id="reason_transferr_other" maxlength="250" />
				</p>
			</div>
		
	     </div>
                 
       
       </section>
       <section headerLabel="4. Treatment Regimen Information">
		<p>
 				Concomitant disease?
                <br/>
				<obs conceptId="165642" id="concomitant_disease" answerConceptIds="1065,1066,1067" defaultValue="1065" required="true">
					<controls>
							<when value="1065" thenDisplay="#concomitant_disease_type_div"/>
					</controls>
				</obs>
		</p>
		<div id="concomitant_disease_type_div">
			<p> If yes, then specify
				<br/>
				<obs conceptId="165643" id="concomitant_disease_type" maxlength="50" />
		   </p>
		</div>
		<p> Comments on compliance
				<br/>
				<obs conceptId="165644" id="compliance_comments" maxlength="100" />
		</p>
	</section>

	<submit/>
 
        <script type="text/javascript">
    $j('#facility_other').hide();
		var startDate = new Date();
		jQuery(function() {
			getField('facility_treatment.value').change(function(){
                                  if(getValue('facility_treatment.value')==63){
                                             $j('#facility_other').show();
                                   }else{
                                           $j('#facility_other').hide();
                                   }
			});
			
		});
    $j('#location_other').hide();
		jQuery(function() {
			getField('referral_site.value').change(function(){
                                  if(getValue('referral_site.value')==63){
                                             $j('#location_other').show();
                                   }else{
                                           $j('#location_other').hide();
                                   }
			});
			
		});
	
    beforeSubmit.push(function() {
        var submit=true;
		setValue('other_facility.error', '');
		if(getValue('facility_treatment.value')==63 &amp;&amp; getValue('other_facility.value')==''){
					getField('other_facility.error').html('This field can not be null').show();
					submit=false;
				}
                else{
                    getField('other_facility.error').html('').hide();
                    submit=true;
                 }
         setValue('reason_referral_transferr_other.error', '');
		if(getValue('reason_referral_transfer.value')==164653 &amp;&amp; getValue('reason_referral_transferr_other.value')==''){
                getField('reason_referral_transferr_other.error').html('This field can not be empty').show();
                submit=false;                
        }
        else{
                getField('reason_referral_transferr_other.error').html('').hide();
				submit=true;
        }

	if(submit==false){
	    return false;
        }
        else{
			var endDate = new Date();
			var timeDiff = Math.abs(endDate.getTime() - startDate.getTime());
			var diffSec = timeDiff/1000;
			alert(diffSec + " seconds to fill form");
            return true;
        }
});


    </script>

<!-- END OF FORM

Simple examples to copy-and-paste. Full reference at http://wiki.openmrs.org/x/kg8z

SECTION
	<section headerLabel="\#. Title">
		Content
	</section>

NUMERIC OBSERVATION
	<obs conceptId="id-of-numeric-concept" labelText="Label before"/>

DATE OBSERVATION
	<obs conceptId="id-of-date-concept" labelText="Label before"/>

CODED OBSERVATION
(as a dropdown)
	<obs conceptId="id-of-coded-concept" labelText="Label before"/>
(as radio buttons)
	<obs conceptId="id-of-coded-concept" labelText="Label before" style="radio"/>
(as an autocomplete)
	<obs conceptId="id-of-coded-concept" labelText="Label before" style="autocomplete" answerClasses="Diagnosis"/>
(as a checkbox for a specific answer)
	<obs conceptId="id-of-coded-concept" labelText="Label before" answerConceptId="id-of-answer-concept" answerLabel="label for answer"/>
(as a dropdown with specific choices)
	<obs conceptId="id-of-coded-concept" labelText="Label before" answerConceptIds="concept-id-1,concept-id-2,concept-id-3" answerLabels="Label 1,Label 2, Label 3"/>


FREE TEXT OBSERVATION
(as a normal text field)
	<obs conceptId="id-of-text-concept" labelText="Label before"/>
(as a textarea)
	<obs conceptId="id-of-text-concept" labelText="Label before" rows="4" cols="80"/>
-->
</htmlform>