<htmlform>
	<!-- Developed by Tahira -->
	<!-- Autogenerated example form  (template from 01-Nov-2010 -->
	<macros>
		paperFormId = (Fill this in)
		headerColor =#009d8e
		fontOnHeaderColor = white
	</macros>

	<style>
		.section {
			border: 1px solid $headerColor;
			padding: 2px;
			text-align: left;
			margin-bottom: 1em;
		}
		.sectionHeader {
			background-color: $headerColor;
			color: $fontOnHeaderColor;
			display: block;
			padding: 2px;
			font-weight: bold;
		}
		table.baseline-aligned td {
			vertical-align: baseline;
		}
	</style>

	<span style="float:right">Paper Form ID: $paperFormId</span>
	<h2>PMDT-Baseline Comorbidities(v0.0.1)</h2>

	<section headerLabel="1. Encounter Details">
		<table class="baseline-aligned">
			<tr>
				<td>Date:</td>
				<td><encounterDate default="today"/></td>
			</tr>
			<tr>
				<td>Location:</td>
				<td><encounterLocation default="2"  tags="PMDT" /></td>
			</tr>
			<tr>
				<td>Provider:</td>
				<td><encounterProvider default="currentUser" type="autocomplete"/></td>
			</tr>
		</table>
	</section>

	<section headerLabel="2. Baseline Comorbidities">
		<div>

			<p>
			Date of baseline assessment
			<br/>
			<obs id="date_baseline" conceptId="164648" defaultValue="today" required="true"/>
			</p>

			<p>
			Confirmed HIV Serostatus
			<br/>
			<obs id="hiv_serostatus" conceptId="164820" answerConceptIds="1065,1066,1067" answerLabels="Yes,No,Unknown" defaultValue="1066" required="true"/>
			</p>

            <div id="display_hiv_serostatus">
			<p>
			HIV: if Yes, diagnosis date
			<br/>
			<obs id="date_hiv_diagnosis" conceptId="160554"/>
			</p>

			<p>
			HIV program registration number
			<br/>
			<obs id="hiv_reg_num" conceptId="164822" maxlength="25"/>
			</p>

			<p>
			HIV: if ARV treatment taken, then start date:
			<br/>
			<obs id="date_antiretroviral_start" conceptId="159599"/>
			</p>

			<p>
			HIV: if currently on ARV treatment, then ARV regimen known?
			<br/>
			<obs id="antiretroviral_regimen_known" conceptId="164828" answerConceptIds="1065,1066" answerLabels="Yes,No" />
			</p>
			</div>
			
			<div id="display_arv_regimen">
			<p>
				HIV: if currently on ARV treatment, then ARV drugs used:
				<br/>
				<div id="display_arv_regimen_child">
				<obsgroup id="antiretroviral_regimen" groupingConceptId="162240">
					<obs conceptId="162240" answerConceptId="78643" answerLabel="Lamivudine (3TC)" id="lamivudine"/>
					<br/>
					<obs conceptId="162240" answerConceptId="70056" answerLabel="Abacavir (ABC)"/>
					<br/>
					<obs conceptId="162240" answerConceptId="86663" answerLabel="Zidovudine (AZT)"/>
					<br/>
					<obs conceptId="162240" answerConceptId="74807" answerLabel="Didanosine (ddl)"/>	
					<br/>
					<obs conceptId="162240" answerConceptId="84309" answerLabel="Stavudine (d4T)"/>	
					<br/>
					<obs conceptId="162240" answerConceptId="75628" answerLabel="Emtricitabine (FTC)"/>
					<br/>
					<obs conceptId="162240" answerConceptId="84795" answerLabel="Tenofovir (TDF)"/>
					<br/>
					<obs conceptId="162240" answerConceptId="75523" answerLabel="Efavirenz (EFV)"/>	
					<br/>
					<obs conceptId="162240" answerConceptId="80586" answerLabel="Nevirapine (NVP)"/>	
					<br/>
					<obs conceptId="162240" answerConceptId="159810" answerLabel="Etravirine (ETV)"/>
					<br/>
					<obs conceptId="162240" answerConceptId="71647" answerLabel="Atazanavir (ATV)"/>	
					<br/>
					<obs conceptId="162240" answerConceptId="74258" answerLabel="Darunavir (DRV)"/>	
					<br/>
					<obs conceptId="162240" answerConceptId="76658" answerLabel="Fosamprenavir (FPV)"/>
					<br/>
					<obs conceptId="162240" answerConceptId="794" answerLabel="Lopinavir/Ritonavir (LPV/r)"/>
					<br/>
					<obs conceptId="162240" answerConceptId="83412" answerLabel="Ritonavir (r)"/>	
					<br/>
					<obs conceptId="162240" answerConceptId="83690" answerLabel="Saquinavir (SQV)"/>
					<br/>
					<obs conceptId="162240" answerConceptId="154378" answerLabel="Raltegravir (RAL)"/>							
				</obsgroup>
				</div>
			</p>			
			</div>
			<p>
			Confirmed Hepatitis B
			<br/>
			<obs id="hepatitis_b" conceptId="111759" answerConceptIds="1065,1066,1067" answerLabels="Yes,No,Unknown" defaultValue="1067" required="true"/>
			</p>

			<p>
			Confirmed Hepatitis C
			<br/>
			<obs id="hepatitis_c" conceptId="164841" answerConceptIds="1065,1066,1067" answerLabels="Yes,No,Unknown" defaultValue="1067" required="true"/>
			</p>

			<p>
			Diabetes (type I or II)
			<br/>
			<obs id="diabetes" conceptId="119481" answerConceptIds="1065,1066,1067" answerLabels="Yes,No,Unknown" defaultValue="1067" required="true"/>
			</p>

			<p>
			Chronic renal insufficiency
			<br/>
			<obs id="chronic_renal_insufficiency" conceptId="154968" answerConceptIds="1065,1066,1067" answerLabels="Yes,No,Unknown" defaultValue="1066" required="true"/>
			</p>

			<p>
			Cirrhosis
			<br/>
			<obs id="cirrhosis" conceptId="164836" answerConceptIds="1065,1066,1067" answerLabels="Yes,No,Unknown" defaultValue="1066" required="true"/>
			</p>

			<p>
			Chronic obstructive pulmonary disease
			<br/>
			<obs id="copd" conceptId="1295" answerConceptIds="1065,1066,1067" answerLabels="Yes,No,Unknown" defaultValue="1066" required="true"/>
			</p>

			<p>
			Heart disease or atherosclerotic disease (e.g. heart failure, heart attack, stroke)
			<br/>
			<obs id="heart_disease" conceptId="139071" answerConceptIds="1065,1066,1067" answerLabels="Yes,No,Unknown" defaultValue="1066" required="true"/>
			</p>

			<div id="display_heart_disease">
			<p>
			If yes, type of heart disease
			<br/>
			<obs id="heart_disease_type" conceptId="164839" maxlength="100" />
			</p>
			</div>

			<p>
			Depression
			<br/>
			<obs id="depression" conceptId="119537" answerConceptIds="1065,1066,1067" answerLabels="Yes,No,Unknown" defaultValue="1067" required="true"/>
			</p>

			<p>
			Other pre-existing diseases (if any):
			<br/>
			<obs id="disease_other" conceptId="164832" maxlength="100"/>
			</p>

			<p>
			Concomitant drugs taken in the past
			<br/>
			<obs id="drugs_concomitant" conceptId="164833" maxlength="255" style="textarea"/>
			</p>
			
			<div id="time_taken_div">
			<p> 
			Time taken to fill form
			<br/>
			<obs id="time_taken" conceptId="165044" />
			</p>
			</div>
		
		</div>
	</section>

	<submit/>

    <script type="text/javascript">
	
		var startDate = new Date();

		var hiv_serostatus = jQuery("#display_hiv_serostatus");
		var arv_regimen = jQuery("#display_arv_regimen");
		var heart_disease = jQuery("#display_heart_disease");
				
		var antiretroviral_regimen_check = true;

		jQuery( document ).ready(function() {
		
			var timeTakenDiv = jQuery("#time_taken_div");
			timeTakenDiv.hide();
		
		<ifMode mode='VIEW' include="false"> 
		
				if(getValue('hiv_serostatus.value') == 1065 ){
					setValue('antiretroviral_regimen_known.value',1065);					
					hiv_serostatus.show();						
				}
				else{
					setValue('date_hiv_diagnosis.value','');
					setValue('hiv_reg_num.value','');
				    setValue('date_antiretroviral_start.value','');
				    setValue('antiretroviral_regimen_known.value','');	
				    uncheckAllCheckBoxes("display_arv_regimen_child");					
					hiv_serostatus.hide();
				}				
				
				if(getValue('antiretroviral_regimen_known.value') == 1065 ){
					arv_regimen.show();
				}
				else{
					uncheckAllCheckBoxes("display_arv_regimen_child");
					arv_regimen.hide();					
				}
				
				if(getValue('heart_disease.value') == 1065 ){
					heart_disease.show();
				}
				else{
				    setValue('heart_disease_type.value', "");  
					heart_disease.hide();					
				}


		</ifMode>
		});	
		
		function uncheckAllCheckBoxes(divName) {
			var divCompleteName = "#" + divName;
			$j(divCompleteName).find('input[type=checkbox]:checked').removeAttr('checked'); // Uncheck all the checkboxes
		}
				
		jQuery(function() {
				
			getField('hiv_serostatus.value').change(function() {
				if(getValue('hiv_serostatus.value') == 1065 ){
                    setValue('antiretroviral_regimen_known.value',1065);					
					hiv_serostatus.show();						
				}
				else{
				    setValue('date_hiv_diagnosis.value','');
					setValue('hiv_reg_num.value','');
				    setValue('date_antiretroviral_start.value','');
				    setValue('antiretroviral_regimen_known.value','');					
					hiv_serostatus.hide();
				}
				getField('antiretroviral_regimen_known.value').change();

			});
		
			getField('antiretroviral_regimen_known.value').change(function() {
				if(getValue('antiretroviral_regimen_known.value') == 1065 ){
					arv_regimen.show();
				}
				else{
				    uncheckAllCheckBoxes("display_arv_regimen_child");
					arv_regimen.hide();					
				}
			});	

			getField('heart_disease.value').change(function() {
				if(getValue('heart_disease.value') == 1065 ){
					heart_disease.show();
				}
				else{
					setValue('heart_disease_type.value', "");  
					heart_disease.hide();					
				}
			});				
			
				
		});



		beforeSubmit.push(function() {
		
			setValue('antiretroviral_regimen_known.error','');	
			setValue('lamivudine.error','');	
	
			var valid=true;
			
			//////////////////////////////////////////////////////
			
			jQuery('#display_arv_regimen_child input[type=checkbox]').on('change', function () {
			var len = jQuery('#display_arv_regimen_child input[type=checkbox]:checked').length;
			if (len > 0) {
				antiretroviral_regimen_check = false;
			}
			else {
				antiretroviral_regimen_check = true;
			} 				
			}).trigger('change');
		
			if(getValue('hiv_serostatus.value') == 1065 &amp;&amp; (getValue('antiretroviral_regimen_known.value') =='' ) ){			
				getField('antiretroviral_regimen_known.error').html('Please select a value.').show();
				valid=false;			
			}
			else{
				getField('antiretroviral_regimen_known.error').html('').hide();
				
				if(getValue('antiretroviral_regimen_known.value') == 1065  &amp;&amp; antiretroviral_regimen_check == true) {
					getField('lamivudine.error').html('Please select a value.').show();
					valid=false;
				}
				else {
					getField('lamivudine.error').html('').hide();
				}
			}			
			
			///////////////////////////////////////////////////////
						
			if(getValue('heart_disease.value')== 1065 &amp;&amp; getValue('heart_disease_type.value')=='') {					
				   getField('heart_disease_type.error').html('Please input a value.').show();
				   valid=false;				   
			}
			else {
				   getField('heart_disease_type.error').html('').hide();
			}			
				
			if(valid==true){
			
				var timeTakenDiv = $j("#time_taken_div");
				
				var endDate = new Date();
                var timeDiff = Math.abs(endDate.getTime() - startDate.getTime());
				var diffSec = timeDiff/1000;
				
				timeTakenDiv.show();
				setValue("time_taken.value",diffSec);

				timeTakenDiv.hide();
				
				return true;
			}
			return false;
		});
    </script>

</htmlform>