<htmlform>
	<!-- Autogenerated example form  (template from 01-Nov-2010 -->
	<macros>
		paperFormId = (Fill this in)
		headerColor =#009d8e
		fontOnHeaderColor = white
	</macros>

	<style>
		.section {
			border: 1px solid $headerColor;
			padding: 2px;
			text-align: left;
			margin-bottom: 1em;
		}
		.sectionHeader {
			background-color: $headerColor;
			color: $fontOnHeaderColor;
			display: block;
			padding: 2px;
			font-weight: bold;
		}
		table.baseline-aligned td {
			vertical-align: baseline;
		}
	</style>

	<span style="float:right">Paper Form ID: $paperFormId</span>
	<h2>PMDT-CVAD (v0.0.1)</h2>

	<section headerLabel="1. Encounter Details">
		<table class="baseline-aligned">
			<tr>
				<td>Date:</td>
				<td><encounterDate default="today"/></td>
			</tr>
			<tr>
				<td>Location:</td>
				<td><encounterLocation default="2"  tags="PMDT" /></td>
			</tr>
			<tr>
				<td>Provider:</td>
				<td><encounterProvider default="currentUser" type="autocomplete"/></td>
			</tr>
		</table>
	</section>

	<section headerLabel="2. Central Venous Access Device Insertion Form">
		<div>	

			<p>
			Visit Date
			<br/>
			<obs id="return_visit_date" conceptId="5096" defaultValue="today" required="true"/>
			</p>

			<p>
			Has there been any Central Venous Access Device (CVAD) insertion for this patient?
			<br/>
			<obs id="cvad" conceptId="165106" answerConceptIds="1065,1066,1067" answerLabels="Yes,No,Unknown" defaultValue="1066"/>
			</p>

			<div id="display_date_cvad_insert">
			<p>
			Date of insertion of CVAD
			<br/>
			<obs id="date_cvad_insert" conceptId="165107"  />
			</p>
			</div>

			<div id="display_type_cvad">
			<p>
			Type of CVAD
			<br/>
			<obs id="type_cvad" conceptId="165112" answerConceptIds="165108,165109,165667" 
			answerLabels="Port-a-Cath (PAC),Peripherally inserted central catheter (PICC),Other" defaultValue="165667"/>
			</p>
			</div>

			<div id="display_type_cvad_other">
			<p>
			If type of CVAD 'Other', then specify:
			<br/>
			<obs id="type_cvad_other" conceptId="165667" maxlength="50"/>
			</p>
			</div>
		
			<div id="display_drug_cvad">
			<p>
			Drugs administered by CVAD
			<br/>
			<div id="display_drug_cvad_child">
				<obsgroup  id="drug_cvad" groupingConceptId="165120" >					
					<obs conceptId="165120" id="imipenem_cilastatin" answerConceptId= "165114" answerLabel="Imipenem-cilastatin" style="checkbox"  /><br/>						
					<obs conceptId="165120" id="amoxicillin_clavulanate" answerConceptId= "165115" answerLabel="Imipenem-cilastatin + Amoxicillin-clavulanate" style="checkbox" /><br/>					
					<obs conceptId="165120" id="kanamycin" answerConceptId= "165116" answerLabel="Imipenem-cilastatin + Amoxicillin-clavulanate + Kanamycin" style="checkbox" /><br/>					 
					<obs conceptId="165120" id="capreomycin" answerConceptId= "165117" answerLabel="Imipenem-cilastatin + Amoxicillin-clavulanate + Capreomycin" style="checkbox" /><br/>						 
					<obs conceptId="165120" id="other_drug_cvad" answerConceptId= "165118" answerLabel="Other" style="checkbox" defaultValue="165118" /><br/>						 
				</obsgroup>	
			</div>
			</p>
		    </div>

			<div id="display_drug_cvad_other">
			<p>
			If drug administered by CVAD 'Other', then specify:
			<br/>
			<obs id="drug_cvad_other" conceptId="165118" maxlength="50" />
			</p>
			</div>
		
			<div id="time_taken_div">
			<p> 
			Time taken to fill form
			<br/>
			<obs id="time_taken" conceptId="165044" />
			</p>
			</div>
		</div>
	</section>

	<submit/>
	
	<script type="text/javascript">
		var startDate = new Date();	
	
		var date_cvad_insert = jQuery("#display_date_cvad_insert");
		var type_cvad = jQuery("#display_type_cvad");
		var type_cvad_other = jQuery("#display_type_cvad_other");
		var drug_cvad = jQuery("#display_drug_cvad");
		var drug_cvad_other = jQuery("#display_drug_cvad_other");
		    
		var drug_cvad_check = false;
jQuery( document ).ready(function() {

		var timeTakenDiv = jQuery("#time_taken_div");
		timeTakenDiv.hide();
		
		<ifMode mode='VIEW' include="false"> 
								 		
		if(getValue('cvad.value') == 1065 ){
			date_cvad_insert.show();
			type_cvad.show();
			drug_cvad.show();
		}
		else{
			date_cvad_insert.hide();
			type_cvad.hide();
			type_cvad_other.hide();
			drug_cvad.hide();
			drug_cvad_other.hide();			
		}
		
		if(getValue('type_cvad.value') == 165667 &amp;&amp; getValue('cvad.value') == 1065 ){
			type_cvad_other.show();
		}
		else{
			type_cvad_other.hide();
		}
		
		if(getField('other_drug_cvad.value').prop("checked") &amp;&amp; getValue('cvad.value') == 1065  ){
			drug_cvad_other.show();
		}
		else{
			drug_cvad_other.hide();
		}

		</ifMode>
		
		});

function uncheckAllCheckBoxes(divName) {
	var divCompleteName = "#" + divName;
	$j(divCompleteName).find('input[type=checkbox]:checked').removeAttr('checked'); // Uncheck all the checkboxes
}

jQuery(":checkbox").click(function(){
	var $this = jQuery(this);
	var checkBoxId = jQuery(this).closest('span').attr('id')
								
	if($this.is(":checked") &amp;&amp; checkBoxId == "other_drug_cvad") {
		drug_cvad_other.show();
	}
	else if(checkBoxId == "other_drug_cvad"){
			drug_cvad_other.hide();
			setValue('drug_cvad_other.value', "");
	}
});

jQuery(function() {
			getField('cvad.value').change(function() {
				
				if(getValue('cvad.value') == 1065 ){
					date_cvad_insert.show();
					type_cvad.show();
					drug_cvad.show();
				}
				else{
					setValue("date_cvad_insert.value","");
					date_cvad_insert.hide();
					setValue("type_cvad.value","");
					type_cvad.hide();
					setValue("type_cvad_other.value","");
					type_cvad_other.hide();
					uncheckAllCheckBoxes("display_drug_cvad_child");
					drug_cvad.hide();
					setValue("drug_cvad_other.value","");
					drug_cvad_other.hide();			
				}		

				getField('type_cvad.value').change();	

				if( getField('other_drug_cvad.value').prop('checked') ){
					drug_cvad_other.show();
				}
				else{
					drug_cvad_other.hide();
					setValue('drug_cvad_other.value', "");		
				}				
			});

			getField('type_cvad.value').change(function() {
				
				if(getValue('type_cvad.value') == 165667 ){
					type_cvad_other.show();
				}
				else{
					setValue("type_cvad_other.value","");
					type_cvad_other.hide();
				}								
			});

});
		
beforeSubmit.push(function() {

	setValue('date_cvad_insert.error','');
	setValue('type_cvad.error','');
	setValue('type_cvad_other.error','');
	setValue('imipenem_cilastatin.error','');
	setValue('drug_cvad_other.error','');

	var valid=true;
	
	if( getValue('cvad.value') == 1065 &amp;&amp; (getValue('date_cvad_insert.value') =='' ) ){	
		getField('date_cvad_insert.error').html('Please select a date.').show();
		valid=false;		
	}
	else{
		getField('date_cvad_insert.error').html('').hide();
	}
	
	if( getValue('cvad.value') == 1065 &amp;&amp; (getValue('type_cvad.value') =='' ) ){	
		getField('type_cvad.error').html('Please select a value.').show();
		valid=false;		
	}
	else{
		getField('type_cvad.error').html('').hide();
	}
	
	if( getValue('cvad.value') == 1065 &amp;&amp; (getValue('type_cvad.value') ==165667 ) &amp;&amp; getValue('type_cvad_other.value') =="" ){	
		getField('type_cvad_other.error').html('Please input a value.').show();
		valid=false;		
	}
	else{
		getField('type_cvad_other.error').html('').hide();
	}
	
	/////////////////////////////checkbox valid checks for fields
	///
	if (jQuery("#display_drug_cvad_child input[type=checkbox]:checked").length > 0)
	{
		drug_cvad_check = true;
	}
	else
	{
		drug_cvad_check = false;
	}

	if(getValue('cvad.value')== 1065 &amp;&amp; drug_cvad_check == false) {
		   getField('imipenem_cilastatin.error').html('Please select a value.').show();
		   valid=false;   
	}
	else {
		   getField('imipenem_cilastatin.error').html('').hide();
	}
	//
	if(getValue('cvad.value')== 1065 &amp;&amp; getField("other_drug_cvad.value").prop('checked')== true &amp;&amp; getValue('drug_cvad_other.value')=='') {	
		   getField('drug_cvad_other.error').html('Please input a value.').show();
		   valid=false;	   
	}
	else {
		   getField('drug_cvad_other.error').html('').hide();
	}
///////////////////
	
	
	if(valid==true){

	//remove default value
		if( getValue('cvad.value')!= 1065 ){
			setValue('type_cvad.value',"");
			setValue('drug_cvad_other.value',"");
			getField("other_drug_cvad.value").removeAttr('checked');
		}
		
		var timeTakenDiv = $j("#time_taken_div");
		
		var endDate = new Date();
		var timeDiff = Math.abs(endDate.getTime() - startDate.getTime());
		var diffSec = timeDiff/1000;
		
		timeTakenDiv.show();
		setValue("time_taken.value",diffSec);
		timeTakenDiv.hide();
	
		return true;
}
	return false;
});
		
</script>
</htmlform>