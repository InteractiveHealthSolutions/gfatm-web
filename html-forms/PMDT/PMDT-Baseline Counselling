<htmlform>
	<!-- Autogenerated example form  (template from 01-Nov-2010 -->
	<macros>
		paperFormId = (Fill this in)
		headerColor =#009d8e
		fontOnHeaderColor = white
	</macros>

	<style>
		.section {
			border: 1px solid $headerColor;
			padding: 2px;
			text-align: left;
			margin-bottom: 1em;
		}
		.sectionHeader {
			background-color: $headerColor;
			color: $fontOnHeaderColor;
			display: block;
			padding: 2px;
			font-weight: bold;
		}
		table.baseline-aligned td {
			vertical-align: baseline;
		}
	</style>

	<span style="float:right">Paper Form ID: $paperFormId</span>
	<h2>PMDT-Baseline Counseling (v0.2.0)</h2>

	<section headerLabel="1. Encounter Details">
		<table class="baseline-aligned">
			<tr>
				<td>Date:</td>
				<td><encounterDate default="today"/></td>
			</tr>
			<tr>
				<td>Location:</td>
				<td><encounterLocation default="2"  tags="PMDT" /></td>
			</tr>
			<tr>
				<td>Provider:</td>
				<td><encounterProvider default="currentUser" type="autocomplete"/></td>
			</tr>
		</table>
	</section>

	<section headerLabel="2. Baseline Counseling Form">
		<div>	
		
			<p>
			Date of assessment
			<br/>
			<obs id="date_assessment" conceptId="165469" defaultValue="today" required="true"/>
			</p>

			<p>
			Family structure
			<br/>
			<obs id="family_structure" conceptId="164254" answerConceptIds="164252,164253" answerLabels="Nuclear family,Joint family" defaultValue="164253" required="true"/>
			</p>

			<p>
			Number of earning members in the family:
			<br/>
			<obs id="earning_members" conceptId="164256" maxlength="2"/>
			</p>

			<p>
			Total monthly household income:
			<br/>
			<obs id="monthly_household_income" conceptId="165549" maxlength="7"/>
			</p>

			<p>
			Status of house ownership
			<br/>
			<obs id="residence_type" conceptId="164260" answerConceptIds="164259,164258,165676" answerLabels="Rent,Own,Other" defaultValue="164259"/>
			</p>
			
			<div id="display_residence_type_other">
			<p>
			If other, then specify
			<br/>
			<obs id="residence_type_other" conceptId="165676" maxlength="25" />
			</p>
			</div>

			<p>
			Number of rooms in the house
			<br/>
			<obs id="number_rooms_house" conceptId="1475"/>
			</p>

			<p>
			Academic qualification:
			<br/>
			<obs id="education_level" conceptId="1712" answerConceptIds="160289,1713,1714,160292,160300,164140,159785,164142,160293,164138,160294,164650" answerLabels="Elementary,Primary,Secondary,Intermediate,Undergraduate,Graduate,Doctorate,Polytechnic,Special Education,Religious,No Formal Education,Other" defaultValue="1714" required="true"/>
			</p>

			<div id="display_other_education">
			<p>
			If academic qualification other, then specify:
			<br/>
			<obs id="other_education" conceptId="164650"  />
			</p>
			</div>

			<p>
			Do you have any children?
			<br/>
			<obs id="children" conceptId="165551" answerConceptIds="1065,1066" answerLabels="Yes,No" defaultValue="1065" required="true"/>
			</p>
 
			<div id="display_children_number">
			<p>
			If Yes, then how many children
			<br/>
			<obs id="children_number" conceptId="165552" maxlength="2"  />
			</p>
			</div>
			
			
			<p>
			Counseling provided to:
			<br/>
			<obs id="counselling" conceptId="164262" answerConceptIds="978,1527,160639,970,971,160723,160724,160726,160725,160729,160730,160727,160728,5617,975,974,5620" answerLabels="Self,Parent,Guardian,Mother,Father,Maternal Grandmother,Maternal Grandfather,Paternal Grandmother,Paternal Grandfather,Brother,Sister,Son,Daughter,Spouse,Aunt,Uncle,Other" defaultValue="978" required="true"/>
			</p>

			<div id="display_other_family_member">
			<p>
			If relationship 'other', then specify:
			<br/>
			<obs id="other_family_member" conceptId="5620" maxlength="25" />
			</p>
			</div>
			
		</div>
		</section>
			
		<section headerLabel="3. Disease Information">
		<div>	

			
			<p>
			Disease site
			<br/>
				
			<obsgroup  id="tb_type" groupingConceptId="160040" >
				<obs id="pulmonary" conceptId="160040"  answerConceptId= "42" answerLabel="Pulmonary" style="checkbox"  /><br/>
				<obs id="extra_pulmonary" conceptId="160040" answerConceptId= "5042" answerLabel="Extra Pulmonary" style="checkbox" />
			</obsgroup>
			
			</p>

			<p>
			Disease site: Extrapulmonary exact site:
			<br/>
			<obs id="extra_pulmonary_site" conceptId="164430"   />
			</p>

			<p>
			Drug resistance profile
			<br/>
			<obs id="drug_resistance_profile" conceptId="165029"   />
			</p>

			<p>
			Subclassification for confimed drug resistant cases
			<br/>
			<obs id="drug_resistant_profile_class" conceptId="165025"   />
			</p>

			<p>
			Any medical or psychiatric comorbidities reported?
			<br/>
			<obs id="report_comorbidity" conceptId="165553" answerConceptIds="1065,1066,1067" answerLabels="Yes,No,Unknown" defaultValue="1066" required="true"/>
			</p>
	
			<div id="display_medical_condition">
			<p>
			General medical and psychiatric condition
			<br/>
			<div id="display_medical_condition_child">
			<obsgroup  id="medical_condition" groupingConceptId="164261" >					
				<obs conceptId="164261" id="diabetes" answerConceptId= "119481" answerLabel="Diabetes" defaultValue="119481" style="checkbox"  /><br/>						
				<obs conceptId="164261" id="hypertension" answerConceptId= "117399" answerLabel="Hypertension" style="checkbox"   /><br/>					
				<obs conceptId="164261" id="epilepsy" answerConceptId= "155" answerLabel="Epilepsy" style="checkbox" /><br/>					 
				<obs conceptId="164261" id="mental_retardation" answerConceptId= "115809" answerLabel="Mental Retardation" style="checkbox" /><br/>
				<obs conceptId="164261" id="physically_disable" answerConceptId= "165554" answerLabel="Physically disable" style="checkbox"  /><br/>						
				<obs conceptId="164261" id="hiv" answerConceptId= "884" answerLabel="HIV" style="checkbox"   /><br/>					
				<obs conceptId="164261" id="hcv" answerConceptId= "28" answerLabel="HCV" style="checkbox" /><br/>					 
				<obs conceptId="164261" id="others" answerConceptId= "164235" answerLabel="Others" style="checkbox" /><br/>				
			</obsgroup>	
			</div>
			</p>
			</div>

			<div id="display_other_disease">
			<p>
			If other, then specify
			<br/>
			<obs id="other_disease" conceptId="164235" maxlength="25"  />
			</p>
			</div>

		</div>
		</section>
		
		<section headerLabel="4. Contact Screening Information">
		<div>
			<p>
			Have your household members been asked to get themselves screened for TB?
			<br/>
			<obs id="screen_household_members" conceptId="165555" answerConceptIds="1065,1066,1067" answerLabels="Yes,No,Unknown" defaultValue="1065" required="true"/>
			</p>
		
			<div id="display_screen_household_member_count">
			<p>
			If Yes, then how many
			<br/>
			<obs id="screen_household_member_count" conceptId="165556" maxlength="2"  />
			</p>
			</div>

			<p>
			Family history of TB?
			<br/>
			<obs id="family_history_tb" conceptId="152460" answerConceptIds="1065,1066,1067" answerLabels="Yes,No,Unknown" defaultValue="1065" required="true"/>
			</p>

			<div id="display_number_family_history_tb">
			<p>
			If yes, then how many
			<br/>
			<obs id="number_family_history_tb" conceptId="165557" maxlength="2"  />
			</p>
			</div>

			<p>
			Cigarette smoking?
			<br/>
			<obs id="cig_smoke" conceptId="165563" answerConceptIds="1065,1066,1067" answerLabels="Yes,No,Unknown" defaultValue="1066" required="true"/>
			</p>

			<div id="display_cig_smoke">
			<p>
			If yes, then number of cigarettes
			<br/>
			<obs id="no_of_cigarettes" conceptId="166079" maxlength="3"  />
			</p>

			<p>
			If yes, then per day, per week, or per month?
			<br/>
			<obs id="smoking_frequency" conceptId="166080" answerConceptIds="166081,166082,166083" answerLabels="Per day,Per week,Per month" defaultValue="166081"  />
			</p>

			<p>
			Cigarette smoking currently or in the past?
			<br/>
			<obs id="smoking_status" conceptId="163201" answerConceptIds="159450,166084" answerLabels="Currently,Past" defaultValue="159450"  />
			</p>
			</div>

			<p>
			AKUADS Result
			<br/>
			<obs id="akuads_score" conceptId="164586"   />
			</p>			
		</div>
		</section>
		
		<section headerLabel="5. Psychotic features screening">
		<div>

			<p>
			Do you sometimes hear voices even though no one nearby is talking to you?
			<br/>
			<obs id="hallucination" conceptId="139146" answerConceptIds="1065,1066,1067" answerLabels="Yes,No,Unknown" defaultValue="1065" required="true"/>
			</p>

			<div id="display_hallucination_type">
			<p>
			If present describe the hallucinations:
			<br/>
			<obs id="hallucination_type" conceptId="165567" maxlength="250"  style="textarea"/>
			</p>
			</div>

			<p>
			Do you sometimes feel that some outside forces are controlling you or control your thoughts?
			<br/>
			<obs id="delusion" conceptId="142600" answerConceptIds="1065,1066,1067" answerLabels="Yes,No,Unknown" defaultValue="1065" required="true"/>
			</p>

			<div id="display_delusion_type">
			<p>
			If present, describe the delusion:
			<br/>
			<obs id="delusion_type" conceptId="165568" maxlength="250"  style="textarea"/>
			</p>
			</div>
			
		</div>
		</section>
		
		<section headerLabel="6. Patient awareness about TB">
		<div>

			<p>
			Does the patient know about symptoms of TB?
			<br/>
			<obs id="know_symptom_tb" conceptId="165569" answerConceptIds="1065,1066" answerLabels="Yes,No" defaultValue="1065" required="true"/>
			</p>
		
			<div id="display_knowledge_type_symptom_tb">
			<p>
			Patient knowledge about symptoms of TB:
			<br/>
			<div id="display_knowledge_type_symptom_tb_child">
			<obsgroup  id="knowledge_type_symptom_tb" groupingConceptId="165570" >					
				<obs conceptId="165570" id="cough_three_weeks" answerConceptId= "1487" answerLabel="Cough for more than 3 weeks" defaultValue="1487" style="checkbox"  /><br/>						
				<obs conceptId="165570" id="hemoptysis" answerConceptId= "138905" answerLabel="Hemoptysis" style="checkbox"  /><br/>					
				<obs conceptId="165570" id="fever" answerConceptId= "140238" answerLabel="Fever" style="checkbox" /><br/>					 
				<obs conceptId="165570" id="weight_loss" answerConceptId= "832" answerLabel="Weight loss" style="checkbox" /><br/>
				<obs conceptId="165570" id="night_sweats" answerConceptId= "133027" answerLabel="Night sweats" style="checkbox"  /><br/>									
			</obsgroup>	
			</div>
			</p>
			</div>

			<p>
			Does the patient know about channels of transmission of TB?
			<br/>
			<obs id="know_transmission_tb" conceptId="165571" answerConceptIds="1065,1066" answerLabels="Yes,No" defaultValue="1065" required="true"/>
			</p>
	
			<div id="display_knowledge_type_transmission_tb">
			<p>
			Patient knowledge about transmission of TB:
			<br/>
			<div id="display_knowledge_type_transmission_tb_child">
			<obsgroup  id="knowledge_type_transmission_tb" groupingConceptId="165575" >					
				<obs conceptId="165575" id="through_germs" answerConceptId= "165572" answerLabel="Through germs present in air droplets expelled in the cough" defaultValue="165572" style="checkbox"  /><br/>						
				<obs conceptId="165575" id="utensils_object" answerConceptId= "165573" answerLabel="Utensils objects sharing with an infected person" style="checkbox"  /><br/>					
				<obs conceptId="165575" id="physical_contact" answerConceptId= "162632" answerLabel="Physical contact(Intimacy touching of infected persons)" style="checkbox" /><br/>					 
				<obs conceptId="165575" id="genetics" answerConceptId= "160926" answerLabel="Genetics" style="checkbox" /><br/>
				<obs conceptId="165575" id="breastfeeding" answerConceptId= "165574" answerLabel="Breastfeeding" style="checkbox"  /><br/>						
				<obs conceptId="165575" id="other_food_water" answerConceptId= "5622" answerLabel="Others (food water etc.)" style="checkbox"  /><br/>							
			</obsgroup>	
			</div>
			</p>
			</div>
			
			<div id="display_counseling_provided_for">
			<p>
			The patient has been counseled/provided basic information about:
			<br/>
			<div id="display_counseling_provided_for_child">
			<obsgroup  id="counseling_provided_for" groupingConceptId="165587" >					
				<obs conceptId="165587" id="type_tb" answerConceptId= "165576" answerLabel="Types of TB" defaultValue="165576" style="checkbox"  /><br/>						
				<obs conceptId="165587" id="in" answerConceptId= "165577" answerLabel="Importance of nutrition" style="checkbox"  /><br/>					
				<obs conceptId="165587" id="dt" answerConceptId= "165578" answerLabel="Duration of TB treatment" style="checkbox" /><br/>					 
				<obs conceptId="165587" id="tp" answerConceptId= "165579" answerLabel="Treatment procedure" style="checkbox" /><br/>
				<obs conceptId="165587" id="tpt" answerConceptId= "165580" answerLabel="Preventive treatment (IPT)" style="checkbox"  /><br/>						
				<obs conceptId="165587" id="ae" answerConceptId= "165581" answerLabel="Adverse events and their management" style="checkbox"  /><br/>
				<obs conceptId="165587" id="ic" answerConceptId= "165180" answerLabel="Infection control" style="checkbox"  /><br/>				
				<obs conceptId="165587" id="ttb" answerConceptId= "165582" answerLabel="Transmission of TB"   style="checkbox"  /><br/>						
				<obs conceptId="165587" id="itd" answerConceptId= "165583" answerLabel="Importance of treatment adherence" style="checkbox"  /><br/>					
				<obs conceptId="165587" id="ics" answerConceptId= "165584" answerLabel="Importance of contact screening" style="checkbox" /><br/>					 
				<obs conceptId="165587" id="irm" answerConceptId= "165585" answerLabel="Importance of regular monthly follow up" style="checkbox" /><br/>
				<obs conceptId="165587" id="thn" answerConceptId= "165586" answerLabel="TB helpline number" style="checkbox"  /><br/>						
			</obsgroup>	
			</div>
			</p>
			</div>
			
			<div id="display_patient_behaviour">
			<p>
			Patient behaviour:
			<br/>
			<div id="display_patient_behaviour_child">
			<obsgroup  id="patient_behaviour" groupingConceptId="164291" >					
				<obs conceptId="164291" id="irritable" answerConceptId= "6023" answerLabel="Irritable" defaultValue="6023" style="checkbox"  /><br/>						
				<obs conceptId="164291" id="stubborn" answerConceptId= "164292" answerLabel="Stubborn" style="checkbox"  /><br/>					
				<obs conceptId="164291" id="shy" answerConceptId= "116631" answerLabel="Shy/Introvert" style="checkbox" /><br/>					 
				<obs conceptId="164291" id="aggressive" answerConceptId= "121748" answerLabel="Aggressive" style="checkbox" /><br/>
				<obs conceptId="164291" id="argumentative" answerConceptId= "164284" answerLabel="Argumentative" style="checkbox"  /><br/>						
				<obs conceptId="164291" id="non_compliant" answerConceptId= "164286" answerLabel="Non compliant" style="checkbox"  /><br/>
				<obs conceptId="164291" id="compliant" answerConceptId= "165558" answerLabel="Compliant" style="checkbox"  /><br/>				
				<obs conceptId="164291" id="responsible" answerConceptId= "164287" answerLabel="Responsible"   style="checkbox"  /><br/>						
				<obs conceptId="164291" id="cooperative" answerConceptId= "164288" answerLabel="Co-operative" style="checkbox"  /><br/>					
				<obs conceptId="164291" id="non_cooperative" answerConceptId= "164289" answerLabel="Non-Cooperative" style="checkbox" /><br/>					 
			</obsgroup>	
			</div>
			</p>
			</div>

			<p>
			Counseling required on next follow up visit?
			<br/>
			<obs id="counsel_next_followup" conceptId="165588" answerConceptIds="1065,1066" answerLabels="Yes,No" defaultValue="1065" required="true"/>
			</p>

			<div id="display_person_counsel_next_followup">
			<p>
			If yes, then to whom
			<br/>
			<obs id="person_counsel_next_followup" conceptId="165591"
			answerConceptIds="978,1527,160639,970,971,160723,160724,160726,160725,160729,160730,160727,160728,5617,975,974,166100"
			answerLabels="Self,Parent,Guardian,Mother,Father,Maternal Grandmother,Maternal Grandfather,Paternal Grandmother,Paternal Grandfather,Brother,Sister,Son,Daughter,Spouse,Aunt,Uncle,Other"
			defaultValue="978" />
			</p>
			</div>
			
			<div id="display_counseling_relationship_other">
			<p>
			If relationship 'other', then specify:
			<br/>
			<obs id="counseling_relationship_other" conceptId="166100" maxlength="25"  />
			</p>
			</div>
			

			<p>
			Counselor's comments:
			<br/>
			<obs id="counselor_comments" conceptId="165592" maxlength="1000" style="textarea"/>
			</p>

			
			<div id="time_taken_div">
			<p> 
			Time taken to fill form
			<br/>
			<obs id="time_taken" conceptId="165044" />
			</p>
			</div>
		</div>
	</section>

	<submit/>
	
	<script type="text/javascript">
		var startDate = new Date();	
	
	    var residence_type_other  			=  jQuery("#display_residence_type_other");
	    var other_education  				=  jQuery("#display_other_education");
	    var children_number  				=  jQuery("#display_children_number");
	    var other_family_member  			=  jQuery("#display_other_family_member");
	   //
		var medical_condition  				=  jQuery("#display_medical_condition");
	    var other_disease  					=  jQuery("#display_other_disease");
	   //
		var screen_household_member_count  	=  jQuery("#display_screen_household_member_count");
	    var number_family_history_tb  		=  jQuery("#display_number_family_history_tb");
	    var cig_smoke  						=  jQuery("#display_cig_smoke");
	    var hallucination_type  			=  jQuery("#display_hallucination_type");
	    var delusion_type  					=  jQuery("#display_delusion_type");
	    //
		var knowledge_type_symptom_tb  		=  jQuery("#display_knowledge_type_symptom_tb");
	    var knowledge_type_transmission_tb  =  jQuery("#display_knowledge_type_transmission_tb");
	    //
		var person_counsel_next_followup  	=  jQuery("#display_person_counsel_next_followup");
		var counseling_relationship_other  	=  jQuery("#display_counseling_relationship_other");
		
		
		var medical_condition_check = false;
		var knowledge_type_symptom_tb_check = false;
		var knowledge_type_transmission_tb_check = false;
		var counseling_provided_for_check = false;
		var patient_behaviour_check = false;
	
jQuery( document ).ready(function() {

		var timeTakenDiv = jQuery("#time_taken_div");
		timeTakenDiv.hide();
		
		
		getField("extra_pulmonary_site.value").prop("disabled", true);
		getField("drug_resistance_profile.value").prop("disabled", true);
		getField("drug_resistant_profile_class.value").prop("disabled", true);
		getField("akuads_score.value").prop("disabled", true);
		
		getField("pulmonary.value").prop("disabled", true);
		getField("extra_pulmonary.value").prop("disabled", true);
		
		
		<ifMode mode='VIEW' include="false"> 
		if(! isBaselineMedicalFormFilled()){
			alert("Please Fill PMDT-Baseline Medical History Form First");
		}else{
			getDataFromBaselineMedicalForm();
		}
		if(! isMentalHealthScreeningFormFilled()){
			alert("Please Fill PMDT-Mental Health Screening Form First");
		}
		else{
			getDataFromMentalHealthScreeningForm();
		}
		
			if(getValue('residence_type.value') == 165676 ){
				residence_type_other.show();
			}
			else{
				residence_type_other.hide();				
			}
			
			if(getValue('education_level.value') == 164650 ){
				other_education.show();
			}
			else{
				other_education.hide();				
			}
			
			if(getValue('children.value') == 1065 ){
				children_number.show();
			}
			else{
				children_number.hide();				
			}
			
			
			if(getValue('counselling.value') == 5620 ){
				other_family_member.show();
			}
			else{
				other_family_member.hide();				
			}
			
			
			//
			///medical
			if(getValue('report_comorbidity.value') ==1065 ){
				medical_condition.show();
			}
			else{
				// uncheck all checkbox first
				//uncheckAllCheckBoxes("display_medical_condition_child");//fix for default check values
				medical_condition.hide();
				other_disease.hide();				
			}
			//
			
			if(getValue('screen_household_members.value') == 1065 ){
				screen_household_member_count.show();
			}
			else{
				screen_household_member_count.hide();				
			}	
			
			if(getValue('family_history_tb.value') == 1065 ){
				number_family_history_tb.show();
			}
			else{ 
				number_family_history_tb.hide();				
			}		
			
			if(getValue('cig_smoke.value') == 1065 ){
				cig_smoke.show();
			}
			else{
				cig_smoke.hide();				
			}
			
			if(getValue('hallucination.value') == 1065 ){
				hallucination_type.show();
			}
			else{
				hallucination_type.hide();				
			}							
		
			if(getValue('delusion.value') == 1065 ){
				delusion_type.show();
			}
			else{
				delusion_type.hide();				
			}	

			///
			//know_symptom_tb
			//know_transmission_tb
			//
			if(getValue('know_symptom_tb.value') ==1065 ){
				knowledge_type_symptom_tb.show();
			}
			else{ 
				// uncheck all checkbox first
				uncheckAllCheckBoxes("display_knowledge_type_symptom_tb_child");
				knowledge_type_symptom_tb.hide();			
			}							
			if(getValue('know_transmission_tb.value') ==1065 ){
				knowledge_type_transmission_tb.show();
			}
			else{
				// uncheck all checkbox first
				uncheckAllCheckBoxes("display_knowledge_type_transmission_tb_child");
				knowledge_type_transmission_tb.hide();			
			}
			///
			
			if(getValue('counsel_next_followup.value') == 1065 ){
				person_counsel_next_followup.show();
			}
			else{
				person_counsel_next_followup.hide();				
			}

			if(getValue('counsel_next_followup.value') == 1065 &amp;&amp; getValue('person_counsel_next_followup.value') == 166100 ){
				counseling_relationship_other.show();
			}
			else{
				counseling_relationship_other.hide();				
			}
			
		
		
		</ifMode>
		
		});

function uncheckAllCheckBoxes(divName) {
	var divCompleteName = "#" + divName;

	$j(divCompleteName).find('input[type=checkbox]:checked').removeAttr('checked'); // Uncheck all the checkboxes
}

jQuery(":checkbox").click(function(){
	var $this = jQuery(this);
	var checkBoxId = jQuery(this).closest('span').attr('id')
								
	if($this.is(":checked") &amp;&amp; checkBoxId == "others") {
		other_disease.show();
	}
	else if(checkBoxId == "others"){
			other_disease.hide();
			setValue('other_disease.value', "");
	}
});
		
//change
jQuery(function() {
		getField('residence_type.value').change(function() {
		
			if(getValue('residence_type.value') == 165676 ){
				residence_type_other.show();
			}
			else{
				setValue('residence_type_other.value', "");  
				residence_type_other.hide();				
			}					
		});
		
		getField('education_level.value').change(function() {
		
			if(getValue('education_level.value') == 164650 ){
				other_education.show();
			}
			else{
				setValue('other_education.value', "");  
				other_education.hide();				
			}							
		});	
		
		getField('children.value').change(function() {
		
			if(getValue('children.value') == 1065 ){
				children_number.show();
			}
			else{
				setValue('children_number.value', "");  
				children_number.hide();				
			}							
		});	
		
		
		getField('counselling.value').change(function() {
		
			if(getValue('counselling.value') == 5620 ){
				other_family_member.show();
			}
			else{
				setValue('other_family_member.value', "");  
				other_family_member.hide();				
			}							
		});	
		
		
		//medical getField("others.value").prop('checked')
		getField('report_comorbidity.value').change(function() {
			if(getValue('report_comorbidity.value') ==1065 ){
				medical_condition.show();
			}
			else{
				// uncheck all checkbox first
				uncheckAllCheckBoxes("display_medical_condition_child");
				medical_condition.hide();
				setValue('other_disease.value', "");
				other_disease.hide();				
			}							
		});
		//
		
		
		getField('screen_household_members.value').change(function() {
		
			if(getValue('screen_household_members.value') == 1065 ){
				screen_household_member_count.show();
			}
			else{
				setValue('screen_household_member_count.value', "");  
				screen_household_member_count.hide();				
			}							
		});	
		
		getField('family_history_tb.value').change(function() {
		
			if(getValue('family_history_tb.value') == 1065 ){
				number_family_history_tb.show();
			}
			else{
				setValue('number_family_history_tb.value', "");  
				number_family_history_tb.hide();				
			}							
		});
		
		getField('cig_smoke.value').change(function() {
		
			if(getValue('cig_smoke.value') == 1065 ){
				cig_smoke.show();
			}
			else{
				setValue("no_of_cigarettes.value","");
				setValue("smoking_frequency.value",""); 
				setValue("smoking_status.value",""); 
				cig_smoke.hide();				
			}							
		});
		
		getField('hallucination.value').change(function() {
		
			if(getValue('hallucination.value') == 1065 ){
				hallucination_type.show();
			}
			else{
				setValue("hallucination_type.value","");
				hallucination_type.hide();				
			}							
		});
		
		getField('delusion.value').change(function() {
		
			if(getValue('delusion.value') == 1065 ){
				delusion_type.show();
			}
			else{
				setValue("delusion_type.value","");
				delusion_type.hide();				
			}							
		});	    
		
		///
		//knowledge_type_symptom_tb
	    //knowledge_type_transmission_tb 
		///
		getField('know_symptom_tb.value').change(function() {
			if(getValue('know_symptom_tb.value') ==1065 ){
				knowledge_type_symptom_tb.show();
			}
			else{ 
				// uncheck all checkbox first
				uncheckAllCheckBoxes("display_knowledge_type_symptom_tb_child");
				knowledge_type_symptom_tb.hide();			
			}							
		});
		getField('know_transmission_tb.value').change(function() {
			if(getValue('know_transmission_tb.value') ==1065 ){
				knowledge_type_transmission_tb.show();
			}
			else{
				// uncheck all checkbox first
				uncheckAllCheckBoxes("display_knowledge_type_transmission_tb_child");
				knowledge_type_transmission_tb.hide();			
			}							
		});
		///
		
		getField('counsel_next_followup.value').change(function() {
		
			if(getValue('counsel_next_followup.value') == 1065 ){
				person_counsel_next_followup.show();
			}
			else{
				setValue("person_counsel_next_followup.value","");
				person_counsel_next_followup.hide();
				setValue("counseling_relationship_other.value","");
				counseling_relationship_other.hide();
			}	
			
		});
		
		getField('person_counsel_next_followup.value').change(function() {
		
			if(getValue('person_counsel_next_followup.value') == 166100 ){
				counseling_relationship_other.show();
			}
			else{
				setValue("counseling_relationship_other.value","");
				counseling_relationship_other.hide();				
			}							
		});

	
		
});
		
beforeSubmit.push(function() {
	setValue("pulmonary.error","");
	setValue("extra_pulmonary_site.error","");
	setValue("drug_resistance_profile.error","");
	setValue("drug_resistant_profile_class.error","");
	setValue("akuads_score.error","");
	
	setValue("counseling_relationship_other.error","");
		

			
	var valid=true;
	
	if(! isBaselineMedicalFormFilled()){
		alert("Please Fill PMDT-Baseline Medical History Form First");
		getField('pulmonary.error').html('Please Fill PMDT-Baseline Medical History Form First').show();
		getField('extra_pulmonary_site.error').html('Please Fill PMDT-Baseline Medical History Form First').show();
		getField('drug_resistance_profile.error').html('Please Fill PMDT-Baseline Medical History Form First').show();
		getField('drug_resistant_profile_class.error').html('Please Fill PMDT-Baseline Medical History Form First').show();
		valid=false;
	}
	else{
		getField('pulmonary.error').html('').hide();
		getField('extra_pulmonary_site.error').html('').hide();
		getField('drug_resistance_profile.error').html('').hide();
		getField('drug_resistant_profile_class.error').html('').hide();
	}
	
	if(! isMentalHealthScreeningFormFilled()){
		alert("Please Fill PMDT-Mental Health Screening Form First");
		getField('akuads_score.error').html('Please Fill PMDT-Mental Health Screening Form First').show();
		valid=false;		
	}
	else{
		getField('akuads_score.error').html('').hide();
	}

	
	setValue('earning_members.error','');
	setValue('monthly_household_income.error','');	
	setValue('residence_type_other.error','');	
	setValue('number_rooms_house.error','');	
	setValue('other_education.error','');
	setValue('children_number.error','');
	setValue('other_family_member.error','');
	setValue('screen_household_member_count.error','');
	setValue('number_family_history_tb.error','');
	setValue('no_of_cigarettes.error','');
	setValue('smoking_frequency.error','');
	setValue('smoking_status.error','');
	setValue('hallucination_type.error','');
	setValue('delusion_type.error','');
	setValue('person_counsel_next_followup.error','');
	setValue('diabetes.error','');
	setValue('cough_three_weeks.error','');
	setValue('through_germs.error','');
	setValue('type_tb.error','');
	setValue('irritable.error','');
	
/////////////////////////////////	
	var earning_members=getValue('earning_members.value');
    if(earning_members == ""  || getValue('earning_members.value') == null ){
	// do nothing as this field is not mandatory	
	}
	else{
		if(!(earning_members.match(/^\d+$/))){
			getField('earning_members.error').html('Not an integer').show();
			valid=false;
        }
        else if( earning_members &lt; 1  ){
	        getField('earning_members.error').html('Cannot be less than 1').show();
			valid=false;	
		}
        else if( earning_members &gt; 99 ){
	        getField('earning_members.error').html('Cannot be greater than 99').show();
			valid=false;	
		}
    }
	
	var monthly_household_income=getValue('monthly_household_income.value');
	if(monthly_household_income == ""  || getValue('monthly_household_income.value') == null ){
	// do nothing as this field is not mandatory	
	}
    else if(! jQuery.isNumeric(monthly_household_income)){
		getField('monthly_household_income.error').html('Not a Number').show();
		valid=false;
    }
    else if( monthly_household_income &lt; 5000 ){
		getField('monthly_household_income.error').html('Cannot be less than 5000').show();
		valid=false;	
	}
    else if( monthly_household_income &gt; 1000000 ){
	     getField('monthly_household_income.error').html('Cannot be greater than 1000000').show();
		 valid=false;	
	}
	
	if(getValue('residence_type.value') == 165676 &amp;&amp; (getValue('residence_type_other.value') =='' ) ){	
		getField('residence_type_other.error').html('Please input a value.').show();
		valid=false;		
	}
	else{
		getField('residence_type_other.error').html('').hide();
	}	
	
	
	var number_rooms_house=getValue('number_rooms_house.value');
    if(number_rooms_house == ""  || getValue('number_rooms_house.value') == null ){
	// do nothing as this field is not mandatory	
	}
	else{
		if(!(number_rooms_house.match(/^\d+$/))){
			getField('number_rooms_house.error').html('Not an integer').show();
			valid=false;
        }
        else if( number_rooms_house &lt; 1  ){
	        getField('number_rooms_house.error').html('Cannot be less than 1').show();
			valid=false;	
		}
        else if( number_rooms_house &gt; 99 ){
	        getField('number_rooms_house.error').html('Cannot be greater than 99').show();
			valid=false;	
		}
    }
	
	if(getValue('education_level.value') == 164650 &amp;&amp; (getValue('other_education.value') =='' ) ){	
		getField('other_education.error').html('Please input a value.').show();
		valid=false;		
	}
	else{
		getField('other_education.error').html('').hide();
	}	
	
	var children_number=getValue('children_number.value');
    if( getValue('children.value') == 1065   ){
	
		if(children_number == ""  || getValue('children_number.value') == null)
		{
			getField('children_number.error').html('This field can not be empty').show();
			valid=false;
		}
		else if(!(children_number.match(/^\d+$/))){
			getField('children_number.error').html('Not an integer').show();
			valid=false;
        }
        else if( children_number &lt; 1  ){
	        getField('children_number.error').html('Cannot be less than 1').show();
			valid=false;	
		}
        else if( children_number &gt; 99 ){
	        getField('children_number.error').html('Cannot be greater than 99').show();
			valid=false;	
		}
    }
	
	
	if(getValue('counselling.value') == 5620 &amp;&amp; (getValue('other_family_member.value') =='' ) ){	
		getField('other_family_member.error').html('Please input a value.').show();
		valid=false;		
	}
	else{
		getField('other_family_member.error').html('').hide();
	}
	
	
	//////////////////////////////////////////////////////////
	
	var screen_household_member_count=getValue('screen_household_member_count.value');
    if( getValue('screen_household_members.value') == 1065   ){
	
		if(screen_household_member_count == ""  || getValue('screen_household_member_count.value') == null)
		{
			getField('screen_household_member_count.error').html('This field can not be empty').show();
			valid=false;
		}
		else if(!(screen_household_member_count.match(/^\d+$/))){
			getField('screen_household_member_count.error').html('Not an integer').show();
			valid=false;
        }
        else if( screen_household_member_count &lt; 1  ){
	        getField('screen_household_member_count.error').html('Cannot be less than 1').show();
			valid=false;	
		}
        else if( screen_household_member_count &gt; 99 ){
	        getField('screen_household_member_count.error').html('Cannot be greater than 99').show();
			valid=false;	
		}
    }
	
	var number_family_history_tb=getValue('number_family_history_tb.value');
    if( getValue('family_history_tb.value') == 1065   ){
	
		if(number_family_history_tb == ""  || getValue('number_family_history_tb.value') == null)
		{
			getField('number_family_history_tb.error').html('This field can not be empty').show();
			valid=false;
		}
		else if(!(number_family_history_tb.match(/^\d+$/))){
			getField('number_family_history_tb.error').html('Not an integer').show();
			valid=false;
        }
        else if( number_family_history_tb &lt; 1  ){
	        getField('number_family_history_tb.error').html('Cannot be less than 1').show();
			valid=false;	
		}
        else if( number_family_history_tb &gt; 10 ){
	        getField('number_family_history_tb.error').html('Cannot be greater than 10').show();
			valid=false;	
		}
    }
	
	////////////////////////////////////////////
		
	var no_of_cigarettes=getValue('no_of_cigarettes.value');
    if( getValue('cig_smoke.value') == 1065   ){
	
		if(no_of_cigarettes == ""  || getValue('no_of_cigarettes.value') == null)
		{
			getField('no_of_cigarettes.error').html('This field can not be empty').show();
			valid=false;
		}
		else if(!(no_of_cigarettes.match(/^\d+$/))){
			getField('no_of_cigarettes.error').html('Not an integer').show();
			valid=false;
        }
        else if( no_of_cigarettes &lt; 1  ){
	        getField('no_of_cigarettes.error').html('Cannot be less than 1').show();
			valid=false;	
		}
        else if( no_of_cigarettes &gt; 100 ){
	        getField('no_of_cigarettes.error').html('Cannot be greater than 100').show();
			valid=false;	
		}
		
		////
		if(getValue('smoking_frequency.value') ==''  ){	
			getField('smoking_frequency.error').html('Please select a value.').show();
			valid=false;		
		}
		if(getValue('smoking_status.value') ==''  ){	
			getField('smoking_status.error').html('Please select a value.').show();
			valid=false;		
		}
    }
	
	///////////////////
	
	
	if(getValue('hallucination.value') == 1065  &amp;&amp; (getValue('hallucination_type.value') =='' ) ){	
		getField('hallucination_type.error').html('Please input a value.').show();
		valid=false;		
	}
	else{
		getField('hallucination_type.error').html('').hide();
	}
	
	if(getValue('delusion.value') == 1065  &amp;&amp; (getValue('delusion_type.value') =='' ) ){	
		getField('delusion_type.error').html('Please input a value.').show();
		valid=false;		
	}
	else{
		getField('delusion_type.error').html('').hide();
	}
	
	
	if(getValue('counsel_next_followup.value') == 1065  &amp;&amp; (getValue('person_counsel_next_followup.value') =='' ) ){	
		getField('person_counsel_next_followup.error').html('Please input a value.').show();
		valid=false;		
	}
	else{
		getField('person_counsel_next_followup.error').html('').hide();
	}
	
			
	if( getValue('counsel_next_followup.value') == 1065  &amp;&amp; getValue('person_counsel_next_followup.value') == 166100
		&amp;&amp; ( getValue('counseling_relationship_other.value') =="" ) ) {
		getField('counseling_relationship_other.error').html('Please input a value.').show();
		valid=false;		
	}
	else{
		getField('counseling_relationship_other.error').html('').hide();
	}
	
	
	
	/////////////////////////////checkbox valid checks for fields
	///
	if (jQuery("#display_medical_condition_child input[type=checkbox]:checked").length > 0)
	{
		medical_condition_check = true;
	}
	else
	{
		medical_condition_check = false;
	}

	if(getValue('report_comorbidity.value')== 1065 &amp;&amp; 	medical_condition_check == false) {
		   getField('diabetes.error').html('Please select a value.').show();
		   valid=false;   
	}
	else {
		   getField('diabetes.error').html('').hide();
	}
	//
	if(getValue('report_comorbidity.value')== 1065 &amp;&amp; getField("others.value").prop('checked')== true &amp;&amp; getValue('other_disease.value')=='') {	
		   getField('other_disease.error').html('Please input a value.').show();
		   valid=false;	   
	}
	else {
		   getField('other_disease.error').html('').hide();
	}
	///////////////////
	
	///
	if (jQuery("#display_knowledge_type_symptom_tb_child input[type=checkbox]:checked").length > 0)
	{
		knowledge_type_symptom_tb_check = true;
	}
	else
	{
		knowledge_type_symptom_tb_check = false;
	}
	
	if(getValue('know_symptom_tb.value')== 1065 &amp;&amp; 	knowledge_type_symptom_tb_check == false) {
		   getField('cough_three_weeks.error').html('Please select a value.').show();
		   valid=false;   
	}
	else {
		   getField('cough_three_weeks.error').html('').hide();
	}
	///

	////////////////
	
	if (jQuery("#display_knowledge_type_transmission_tb_child input[type=checkbox]:checked").length > 0)
	{
		knowledge_type_transmission_tb_check = true;
	}
	else
	{
		knowledge_type_transmission_tb_check = false;
	}
	
	if(getValue('know_transmission_tb.value')== 1065 &amp;&amp; 	knowledge_type_transmission_tb_check == false) {
		   getField('through_germs.error').html('Please select a value.').show();
		   valid=false;   
	}
	else {
		   getField('through_germs.error').html('').hide();
	}

	////////////////
	
	if (jQuery("#display_counseling_provided_for_child input[type=checkbox]:checked").length > 0)
	{
		counseling_provided_for_check = true;
	}
	else
	{
		counseling_provided_for_check = false;
	}
	
	if( counseling_provided_for_check == false) {
		   getField('type_tb.error').html('Please select a value.').show();
		   valid=false;   
	}
	else {
		   getField('type_tb.error').html('').hide();
	}

	//////////////
	if (jQuery("#display_patient_behaviour_child input[type=checkbox]:checked").length > 0)
	{
		patient_behaviour_check = true;
	}
	else
	{
		patient_behaviour_check = false;
	}
	
	if( patient_behaviour_check == false) {
		   getField('irritable.error').html('Please select a value.').show();
		   valid=false;   
	}
	else {
		   getField('irritable.error').html('').hide();
	}
	
	///

	///////////////////////////////////////////
	
	if(valid==true){
	//remove default values
	   if( getValue('cig_smoke.value') != 1065   )
	   {
			setValue("smoking_frequency.value","");
			setValue("smoking_status.value","");			
	   }
	   if(getValue('report_comorbidity.value')!= 1065){
			uncheckAllCheckBoxes("display_medical_condition_child");
			setValue('other_disease.value', "");
	   }
	   //////////
		getField("pulmonary.value").prop("disabled", false);
		getField("extra_pulmonary.value").prop("disabled", false);
		getField("extra_pulmonary_site.value").prop("disabled", false);
		getField("drug_resistance_profile.value").prop("disabled", false);
		getField("drug_resistant_profile_class.value").prop("disabled", false);
		getField("akuads_score.value").prop("disabled", false);
		
		var timeTakenDiv = $j("#time_taken_div");
		
		var endDate = new Date();
		var timeDiff = Math.abs(endDate.getTime() - startDate.getTime());
		var diffSec = timeDiff/1000;
		
		timeTakenDiv.show();
		setValue("time_taken.value",diffSec);
		timeTakenDiv.hide();
	
		return true;
}
	return false;
});

function getTbType(){

	var pulmonary=false;
	var extra_pulmonary=false;
	var obsArrayEncounter ="	<lookup complexExpression="#set( $enc = $fn.latestEncounter('0dad2f4f-7466-49ba-9c31-b8878b7016b4') ) #foreach($obs in $fn.allObs($enc, '160040'))  #set( $val = $obs.valueCoded ) $!{val} #end"/>";
	console.log(obsArrayEncounter);
	var obsArray = obsArrayEncounter.split(' ');
	for(i = 1; i &lt; obsArray.length; i++){	
		if(obsArray[i]=="42"){
			pulmonary=true;
		}
		if(obsArray[i]=="5042"){
			extra_pulmonary=true;
		}
	}
	if(pulmonary){
		console.log("pm: select");
		getField("pulmonary.value").prop('checked',true);
	}else{
		getField("pulmonary.value").prop('checked',false);
	}
	if(extra_pulmonary){
		console.log("expm: select");
		getField("extra_pulmonary.value").prop('checked',true);
	}
	else{
		getField("extra_pulmonary.value").prop('checked',false);
	}
	

}
		
function isBaselineMedicalFormFilled(){		
		var isFilled=true;
var latestEncounter = "<lookup complexExpression="#foreach($encounter in $fn.allEncounters('0dad2f4f-7466-49ba-9c31-b8878b7016b4'))  $fn.getObs($encounter, '164648').getValueAsString($!{locale}) #end"/>";		
		var dateResult = latestEncounter.replace(/\s\s+/g, '@');
		var dateResultArray = dateResult.split('@');
		var date = dateResultArray[dateResultArray.length-1];

		if( date==null || date=='' ){
			isFilled=false;
		}
		return isFilled;
}

function isMentalHealthScreeningFormFilled(){		
		var isFilled=true;
		var latestEncounter = "<lookup complexExpression="#foreach($encounter in $fn.allEncounters('81d5ae89-e39b-45e2-a0ca-9fd421c32d2c'))  $fn.getObs($encounter, '165979').getValueAsString($!{locale}) #end"/>";		
		var screeningStatusResult = latestEncounter.replace(/\s\s+/g, '@');
        var screeningStatusResultArray = screeningStatusResult.split('@');
		var screeningStatus = screeningStatusResultArray[screeningStatusResultArray.length-1];
		
		if( screeningStatus==null || screeningStatus=='' ){
			isFilled=false;
		}
		return isFilled;
}

function getDataFromBaselineMedicalForm(){
		
		var latestEncounter = "<lookup complexExpression="#foreach($encounter in $fn.allEncounters('0dad2f4f-7466-49ba-9c31-b8878b7016b4'))  $fn.getObs($encounter, '164430').valueCoded #end"/>";		
		var extraPulmonarySiteResult = latestEncounter.replace(/\s\s+/g, '@');
        var extraPulmonarySiteResultArray = extraPulmonarySiteResult.split('@');
		var extraPulmonarySite = extraPulmonarySiteResultArray[extraPulmonarySiteResultArray.length-1];
		
		var latestEncounter = "<lookup complexExpression="#foreach($encounter in $fn.allEncounters('0dad2f4f-7466-49ba-9c31-b8878b7016b4'))  $fn.getObs($encounter, '165029').valueCoded #end"/>";		
		var drugResistanceProfileResult = latestEncounter.replace(/\s\s+/g, '@');
        var drugResistanceProfileResultArray = drugResistanceProfileResult.split('@');
		var drugResistanceProfile = drugResistanceProfileResultArray[drugResistanceProfileResultArray.length-1];
		
		var latestEncounter = "<lookup complexExpression="#foreach($encounter in $fn.allEncounters('0dad2f4f-7466-49ba-9c31-b8878b7016b4'))  $fn.getObs($encounter, '165025').valueCoded #end"/>";		
		var drugResistanceProfileClassResult = latestEncounter.replace(/\s\s+/g, '@');
        var drugResistanceProfileClassResultArray = drugResistanceProfileClassResult.split('@');
		var drugResistanceProfileClass = drugResistanceProfileClassResultArray[drugResistanceProfileClassResultArray.length-1];	
	
		getTbType();
		setValue('extra_pulmonary_site.value',extraPulmonarySite.trim());
		setValue('drug_resistance_profile.value',drugResistanceProfile.trim());
		setValue('drug_resistant_profile_class.value',drugResistanceProfileClass.trim());
}

function getDataFromMentalHealthScreeningForm(){
		var latestEncounter = "<lookup complexExpression="#foreach($encounter in $fn.allEncounters('81d5ae89-e39b-45e2-a0ca-9fd421c32d2c'))  $fn.getObs($encounter, '164586').getValueAsString($!{locale}) #end"/>";		
		var akuadsScoreResult = latestEncounter.replace(/\s\s+/g, '@');
        var akuadsScoreResultArray = akuadsScoreResult.split('@');
		var akuadsScore = akuadsScoreResultArray[akuadsScoreResultArray.length-1];
		var score = parseInt(akuadsScore.trim());
		if(score==0){
			//in case 0 //then save it
			setValue('akuads_score.value',score);
		}
		else if(isNaN(score) || score=="" || score==null){
		//donot save NAN value
		}
		else{
			setValue('akuads_score.value',score);
		}
}


</script>
</htmlform>