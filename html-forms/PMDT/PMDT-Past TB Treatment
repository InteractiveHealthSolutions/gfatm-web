<htmlform>
	<!-- Autogenerated example form  (template from 01-Nov-2010 -->
	<macros>
		paperFormId = (Fill this in)
		headerColor =#009d8e
		fontOnHeaderColor = white
	</macros>

	<style>
		.section {
			border: 1px solid $headerColor;
			padding: 2px;
			text-align: left;
			margin-bottom: 1em;
		}
		.sectionHeader {
			background-color: $headerColor;
			color: $fontOnHeaderColor;
			display: block;
			padding: 2px;
			font-weight: bold;
		}
		table.baseline-aligned td {
			vertical-align: baseline;
		}
	</style>

	<span style="float:right">Paper Form ID: $paperFormId</span>
	<h2>PMDT-Past TB Treatment (v0.0.1-alpha)</h2>

	<section headerLabel="1. Encounter Details">
		<table class="baseline-aligned">
			<tr>
				<td>Date:</td>
				<td><encounterDate default="today"/></td>
			</tr>
			<tr>
				<td>Location:</td>
				<td><encounterLocation default="2" tags="PMDT"/></td>
			</tr>
			<tr>
				<td>Provider:</td>
				<td><encounterProvider default="currentUser" type="autocomplete"/></td>
			</tr>
		</table>
		<script>
		 var patientId =  '<lookup expression="patient.getPatientIdentifier(3)"/>';
		</script>
	</section>

	<section headerLabel="2. Past TB Treatment Details ">
		<div>
                       
				<p>
				Has the patient ever been treated for TB (more than one month) in the past?
                                <br/>
				<obs conceptId="164779" id="treatment_past" answerConceptIds="1065,1066,1067" answerLabels="Yes, No, Unknown" defaultValue="1065"/>
				</p>
                         
				<div id="div_treatment_details">
				
				
				<button id="0-addEntry" class="addEntry">Add</button>
                                <br/>
                                <br/>
                <repeat>
                    <template>
                     
                           
                                <div id="{n}-toggleContainer" class="{n}-toggleContainer" >
									<div> <b><label>{n}-Past TB Treatment details</label></b> <br/>
                                        <obsgroup groupingConceptId="165704">
										<tr>
                                        <td><obs conceptId="166036" labelText="Start date of past TB treatment" id="{n}-past_treatment_start_date" /></td>
										</tr> 
										
										<br/>
										<br/>
										<tr>
										<td><obs conceptId="166037" labelText="End date of past TB treatment" id="{n}-past_treatment_end_date"/></td>
										</tr>
										
										<br/>
										<br/>
										<tr>
										<td><obs conceptId="164091" labelText="Type of TB" id="{n}-tb_type" answerConceptIds="160248, 160247,1067" answerLabels="Drug susceptible TB,Drug resistant TB,Unknown"/></td>
										</tr>
										
										<br/>
										<br/>
										<tr>
										<td><obs conceptId="166031" labelText="Type of regimen for past TB treatment" answerConceptIds="164230,164231,159976,5622,1067" id="{n}-past_tb_category" answerLabels="CAT 1,CAT 2,CAT 4,Other,Unknown" /></td>
										</tr>
										
										<br/>
										<br/>
										<tr>
										<td><obs conceptId="165665" class="tbDrugs" labelText="Is the drug regimen of past TB treatment known?" id="{n}-past_regimen_treatment_known" answerConceptIds="1065,1066" /></td>
										</tr>
										
										<br/>
										<br/>
										<tr>
										<td><div id="{n}-past_regimen">TB drugs taken
										<obsgroup groupingConceptId="164806" labelText="TB Drugs Taken" id="{n}-tb_drugs_taken">
										<br/>
										<obs conceptId="164806" id="{n}-isoniazid" answerConceptId= "78280" answerLabel="Isoniazid" style="checkbox" />
									<br/>
									<obs conceptId="164806" id="High-Dose-Isoniazid" answerConceptId= "164086" answerLabel="High Dose Isoniazid" style="checkbox" />
									<br/>
									<obs conceptId="164806" id="Rifampicin" answerConceptId= "767" answerLabel="Rifampicin" style="checkbox" />
									<br/>
									<obs conceptId="164806" id="Rifapentine" answerConceptId= "83360" answerLabel="Rifapentine" style="checkbox" />
									<br/>
									<obs conceptId="164806" id="Ethambutol" answerConceptId= "75948" answerLabel="Ethambutol" style="checkbox" />
									<br/>
									<obs conceptId="164806" id="Pyrazinamide" answerConceptId= "82900" answerLabel="Pyrazinamide" style="checkbox" />
									<br/>
									<obs conceptId="164806" id="Pyridoxine" answerConceptId= "82912" answerLabel="Pyridoxine" style="checkbox" />
									<br/>
									<obs conceptId="164806" id="Rifabutin" answerConceptId= "83352" answerLabel="Rifabutin" style="checkbox" />
									<br/>
									<obs conceptId="164806" id="Streptomycin" answerConceptId= "84360" answerLabel="Streptomycin" style="checkbox" />
									<br/>
									<obs conceptId="164806" id="Amikacin" answerConceptId= "71060" answerLabel="Amikacin" style="checkbox" />
									<br/>
									<obs conceptId="164806" id="Kanamycin" answerConceptId= "78385" answerLabel="Kanamycin" style="checkbox" />
									<br/>
									<obs conceptId="164806" id="Capreomycin" answerConceptId= "72794" answerLabel="Capreomycin" style="checkbox" />
									<br/>
									<obs conceptId="164806" id="Ciprofloxacin" answerConceptId= "73449" answerLabel="Ciprofloxacin" style="checkbox" />
									<br/>
									<obs conceptId="164806" id="Levofloxacin" answerConceptId= "78788" answerLabel="Levofloxacin" style="checkbox" />
									<br/>
									<obs conceptId="164806" id="Moxifloxacin" answerConceptId= "80133" answerLabel="Moxifloxacin" style="checkbox" />
									<br/>
									<obs conceptId="164806" id="Nalidixic-acid" answerConceptId= "80363" answerLabel="Nalidixic Acid" style="checkbox" />
									<br/>
									<obs conceptId="164806" id="Norfloxacin" answerConceptId= "80792" answerLabel="Norfloxacin" style="checkbox" />
									<br/>
									<obs conceptId="164806" id="Ofloxacin" answerConceptId= "81022" answerLabel="Ofloxacin" style="checkbox" />
									<br/>
									<obs conceptId="164806" id="Gatifloxacin" answerConceptId= "76835" answerLabel="Gatifloxacin" style="checkbox" />
									<br/>
									<obs conceptId="164806" id="Gemifloxacin" answerConceptId= "76862" answerLabel="Gemifloxacin" style="checkbox" />
									<br/>
									<obs conceptId="164806" id="Prothionamide" answerConceptId= "82772" answerLabel="Prothionamide" style="checkbox" />
									<br/>
									<obs conceptId="164806" id="Ethionamide" answerConceptId= "75976" answerLabel="Ethionamide" style="checkbox" />
									<br/>
									<obs conceptId="164806" id="Cycloserine" answerConceptId= "74123" answerLabel="Cycloserine" style="checkbox" />
									<br/>
									<obs conceptId="164806" id="Terizidone" answerConceptId= "84836" answerLabel="Terizidone" style="checkbox" />
									<br/>
									<obs conceptId="164806" id="PAS" answerConceptId= "81457" answerLabel="P-Aminosalicylic Acid" style="checkbox" />
									<br/>
									<obs conceptId="164806" id="PAS-Monosodium" answerConceptId= "81458" answerLabel="P-Aminosalicylic Acid Monosodium" style="checkbox" />
									<br/>
									<obs conceptId="164806" id="Bedaquiline" answerConceptId= "163143" answerLabel="Bedaquiline" style="checkbox" />
									<br/>
									<obs conceptId="164806" id="Delamanid" answerConceptId= "163144" answerLabel="Delamanid" style="checkbox" />
									<br/>
									<obs conceptId="164806" id="Linezolid" answerConceptId= "78879" answerLabel="Linezolid" style="checkbox" />
									<br/>
									<obs conceptId="164806" id="Clofazimine" answerConceptId= "73581" answerLabel="Clofazimine" style="checkbox" />
									<br/>
									<obs conceptId="164806" id="Imipenem and cilastatin" answerConceptId= "104315" answerLabel="Imipenem and cilastatin" style="checkbox" />
									<br/>
									<obs conceptId="164806" id="Amoxicillin-clavulanate" answerConceptId= "450" answerLabel="Amoxicillin-clavulanate" style="checkbox" />
									<br/>
									<obs conceptId="164806" id="Meropenem" answerConceptId= "79611" answerLabel="Meropenem" style="checkbox" />
									<br/>
									<obs conceptId="164806" id="Sparfloxacin" answerConceptId= "84206" answerLabel="Sparfloxacin" style="checkbox" />
									<br/>
									<obs conceptId="164806" id="Clarithromycin" answerConceptId= "73498" answerLabel="Clarithromycin" style="checkbox" />
									<br/>
									<obs conceptId="164806" id="Thioacetazone" answerConceptId= "160019" answerLabel="Thioacetazone" style="checkbox" />
									<br/>
									<obs conceptId="164806" id="Viomycin" answerConceptId= "160020" answerLabel="Viomycin" style="checkbox" />
									<br/>
										</obsgroup>	</div></td>
										</tr>
										
										<br/>
										<br/>
										<tr>
										<td><obs conceptId="164815" labelText="National registration number of past TB treatment" id="{n}-past_reg_num_treatment"/></td>
										</tr>
										
										<br/>
										<br/>
										<tr>
										<td><obs conceptId="164799" labelText="Outcome of past TB treatment" id="{n}-past_treatment_outcome" answerConceptIds="159791,1267,159874,160031,164791,164792" answerLabels="Cured,Completed,Failed,Lost to follow-up,Not evaluated,Treatment adapted" /></td>
										</tr>
										
										<br/>
										<br/>
										<tr>
										<td>Registration facility of past TB treatment.
										<select id="{n}-facility_list" onchange="facilityListOnChange({n})"><option>Please select location</option></select><obs conceptId="164817" class="" id="{n}-past_reg_treatment_facility"/></td>
										</tr>
										
										<br/>
										<br/>
										<tr>
										<td><div id="{n}-other_facility_referred">
											
												<obs conceptId="165692" labelText="If registration facility other, then specify:" id="{n}-other_past_reg_facility_treatment"/>
											
											</div></td>
										</tr>
										
										</obsgroup>
										
										<button id="{n}-addEntry" class="addEntry">Add</button>
										<button id="{n}-removeEntry" class="removeEntry">Remove</button>
										
                                        
                                    </div>
									
									<label>---------------------------------------------------------------------------------------------------</label>
									
									<br/>
								</div>
                                                                
                            
                    </template>
                    <render n="1" />
                    <render n="2" />
                    <render n="3" />
                    <render n="4" />
                    <render n="5" />
					<render n="6" />
                    <render n="7" />
                    <render n="8" />
					<render n="9" />
					<render n="10" />
                    
                </repeat>
                
				</div>
					
	<ifMode mode="VIEW" include="false">
				<script type="text/javascript">
			
				jQuery(function() { 
				
					if(getValue('2-tb_type.value')=='') {
						jQuery("#2-toggleContainer").toggle(false);
					}
						
					else {
						
						jQuery("#2-toggleContainer").toggle(true);
					}
					
					if(getValue('3-tb_type.value')=='')
						jQuery("#3-toggleContainer").toggle(false);
						
					else
						jQuery("#3-toggleContainer").toggle(true);
						
					if(getValue('4-tb_type.value')=='')
						jQuery("#4-toggleContainer").toggle(false);
						
					else 
						jQuery("#4-toggleContainer").toggle(true);
						
					
					if(getValue('5-tb_type.value')=='')
						jQuery("#5-toggleContainer").toggle(false);
						
					else 
						jQuery("#5-toggleContainer").toggle(true);
						
					if(getValue('6-tb_type.value')=='')
						jQuery("#6-toggleContainer").toggle(false);
						
					else 
						jQuery("#6-toggleContainer").toggle(true);
						
					if(getValue('7-tb_type.value')=='')
						jQuery("#7-toggleContainer").toggle(false);
						
					else 
						jQuery("#7-toggleContainer").toggle(true);
						
					if(getValue('8-tb_type.value')=='')
						jQuery("#8-toggleContainer").toggle(false);
						
					else 
						jQuery("#8-toggleContainer").toggle(true);
						
					if(getValue('9-tb_type.value')=='')
						jQuery("#9-toggleContainer").toggle(false);
						
					else 
						jQuery("#9-toggleContainer").toggle(true);
						
					if(getValue('10-tb_type.value')=='')
						jQuery("#10-toggleContainer").toggle(false);
						
					else 
						jQuery("#10-toggleContainer").toggle(true);
		 
				});
        </script>
    </ifMode>
				
				
		</div>   
	</section>
	<submit/>

    <script type="text/javascript">
			
		if(jQuery){
		
		var locationData = null;
			jQuery(document).ready(function(){
			
			//7
			<ifMode mode='View' include="true">
			//show and hide repeat boxes acc to values 		
			for(var i=1; i &lt; 11; i++ ){
				if(jQuery("#"+i+'-tb_type > span ').hasClass('value'))
				{
					jQuery("#"+i+"-toggleContainer").toggle(true);
				}
				else{
					jQuery("#"+i+"-toggleContainer").toggle(false);
				}
				jQuery("#"+1+"-toggleContainer").toggle(true);// visible only first in view mode
			}			
			</ifMode>
			//7
			
			//10
			<ifMode mode='View' include="false">	
					if(getValue('treatment_past.value')=='1065'){
					
						   jQuery("#div_treatment_details").show();
					}
					else {
					
					for (i = 1; i &lt; 11; i++){
					   setValue(i+"-past_treatment_start_date.value","");
					   setValue(i+"-past_treatment_end_date.value","");
					   setValue(i+"-tb_type.value","");
					   setValue(i+"-past_tb_category.value","");
					   setValue(i+"-past_regimen_treatment_known.value","");
					   //uncheck
					   uncheckAllCheckBoxes(i+"-past_regimen");
					   setValue(i+"-past_reg_num_treatment.value","");
					   setValue(i+"-past_treatment_outcome.value","");
					   jQuery("#"+i+"-facility_list").val("");
					   setValue(i+"-past_reg_treatment_facility.value","");
					   setValue(i+"-other_past_reg_facility_treatment.value","");
					   }
					
						jQuery("#div_treatment_details").hide();
					}
			</ifMode>
			//10
			
			
			//8
			<ifMode mode='View' include="false">
			doRest();
			</ifMode>
			//8
			
            getField('1-past_reg_treatment_facility.value').change();
			
            getField('treatment_past.value').change();
			
			var otherFirstPastRegFacilityDiv = jQuery('#1-other_facility_referred'); 
	  
			//<ifMode mode='VIEW'> 
			//	otherFirstPastRegFacilityDiv.show();
			//</ifMode>
			<ifMode mode='ENTER'> 
				
			</ifMode>
			
		
			//otherFirstPastRegFacilityDiv.hide();
			
			
			
                        
			/* $j('#2-toggleContainer').hide();
			$j('#3-toggleContainer').hide();
			$j('#4-toggleContainer').hide();
			$j('#5-toggleContainer').hide();
			$j('#6-toggleContainer').hide();
			$j('#7-toggleContainer').hide();
			$j('#8-toggleContainer').hide();
			$j('#9-toggleContainer').hide();
			$j('#10-toggleContainer').hide(); */
			
			//2
			<ifMode mode='VIEW' include="false"> 
			for(var i=1; i &lt; 11; i++ ){
				//show/hide fields to acc to values
				pasttbDrugsChange(i+"-");
				facilityTreatmentChange(i);
			}
			</ifMode>
			//2
			
		//11
			<ifMode mode='View' include="false">		
      jQuery('button.addEntry').live("click", function(){
		  
		  var correctedAddButtonId = parseFloat(this.id) + 1;
		 
		  var contentAddId = "#" + correctedAddButtonId + "-toggleContainer";
		  jQuery(contentAddId).toggle(true);
		  
		  var facilityListControl = correctedAddButtonId + "-facility_list";
		  
		 //6
/*		 populate(locationData, facilityListControl);
		 
		  var otherFacilityDiv = "#" + correctedAddButtonId + "-other_facility_referred";
		  
		  var otherPastRegFacilityDiv = jQuery(otherFacilityDiv); 
		  
		  otherPastRegFacilityDiv.hide();
		  
		  */
		  //6 
		  
		  var pastRegimenKnownFieldName = correctedAddButtonId +  "-past_regimen_treatment_known";
		  var pastRegimenKnown = document.getElementById(pastRegimenKnownFieldName);
		  
		  // pastRegimenKnown.onchange = pastRegimenKnownOnChange(correctedAddButtonId);
		  
		  
		  return false;
		  
	  });
	   </ifMode>
			//11
    });
	
	function facilityListOnChange(numberId) {
	//3
	/*var facilityListControl = numberId + "-facility_list";
	var facilities = document.getElementById(facilityListControl);
        
		var locationDescription = facilities.options[facilities.selectedIndex].text;
						var locationName = facilities.options[facilities.selectedIndex].value;
	
		var pastRegTreatmenFacilityValue =  numberId + "-past_reg_treatment_facility.value";
		setValue(pastRegTreatmenFacilityValue,locationName );
		getField(pastRegTreatmenFacilityValue).change();
		
		var treatmentFacility = numberId + "-past_reg_treatment_facility.value";
		var otherFacilityDiv = "#" + numberId + "-other_facility_referred";
		var otherPastRegFacilityDiv = jQuery(otherFacilityDiv); 
				*/	
				//3
				
		setValue(numberId+'-past_reg_treatment_facility.value',jQuery("#"+numberId+"-facility_list").val());  
		facilityTreatmentChange(numberId);		
	}
	
	function facilityTreatmentChange(n){
		if(getValue(n+'-past_reg_treatment_facility.value') == "OTHER" ){
			jQuery("#"+n+"-other_facility_referred").show();
		 }
		else{
			setValue(n+'-other_past_reg_facility_treatment.value', "");  
			jQuery("#"+n+"-other_facility_referred").hide();				
		 }
	}	
		
	
	function uncheckAllCheckBoxes(divName) {
			var divCompleteName = "#" + divName;
		
			$j(divCompleteName).find('input[type=checkbox]:checked').removeAttr('checked'); // Uncheck all the checkboxes
	}
	//4
	/*
	function doRest(){
			jQuery.ajax({
				url: "/openmrs/ws/rest/v1/location?v=custom:(uuid,display,name,description)",
				dataType: 'json'
				}).done(function(data ) {
				
					console.log(data.results[0].name);
					console.log(data.results.length);
					locationData = data;
					populate(data, "1-facility_list");
			});
		}
		
		function populate(data, fieldName) {
		    
			var s= document.getElementById(fieldName);
			
			for (i = 0; i &lt; data.results.length; i++) { 
				s.options[i+1]= new Option(data.results[i].description, data.results[i].name);                      
				var resultObject =  JSON.parse(JSON.stringify(data.results[i].description || null));
			}
		}*/
		function doRest(){
	jQuery.ajax({
		url: "/openmrs/ws/rest/v1/location?v=custom:(uuid,display,name,description)",
		dataType: 'json'
		}).done(function(data ) {
			console.log(data.results[0].name);
			console.log(data.results.length);
			locationData = data;
			populate(data);
	});
}

	function populate(data) {
		var facilityList =[] ;
		for(var i=1; i &lt; 11; i++ ){					
			facilityList[i]= document.getElementById((i)+'-facility_list');
		}
		for (i = 0; i &lt; data.results.length; i++) { 
			for(var j=1; j &lt; 11; j++ ){					
				facilityList[j].options[i+1]= new Option(data.results[i].description, data.results[i].name);
			}	
			var resultObject =  JSON.parse(JSON.stringify(data.results[i].description || null));
		}
	}
		//4
	
	//12
	<ifMode mode='View' include="false">
	$j(document).ready(function(){
      $j('button.removeEntry').live("click", function(){
	  
      var correctedRemoveButtonId = parseFloat(this.id);
      var contentAddId = "#" + parseFloat(this.id) + "-toggleContainer";
      $j(contentAddId).toggle(false);
      $j(contentAddId).val('');
	  
      $j(':input:not(:button)', contentAddId).val([]);

      return false;});
 
    });
	</ifMode>
	//12
	
	jQuery(document).ready(function(){
         
		 /* if(getValue('2-past_treatment_start_date.value')=='')
         jQuery("#2-toggleContainer").toggle(false);
    
     if(getValue('3-past_treatment_start_date.value')=='')
         jQuery("#3-toggleContainer").toggle(false);
     
    if(getValue('4-past_treatment_start_date.value')=='')
         jQuery("#4-toggleContainer").toggle(false);

     if(getValue('5-past_treatment_start_date.value')=='')
         jQuery("#5-toggleContainer").toggle(false);
     
      if(getValue('6-past_treatment_start_date.value')=='')
          jQuery("#6-toggleContainer").toggle(false);
		  
		  if(getValue('7-past_treatment_start_date.value')=='')
          jQuery("#7-toggleContainer").toggle(false);

      if(getValue('8-past_treatment_start_date.value')=='')
         jQuery("#8-toggleContainer").toggle(false);

       if(getValue('9-past_treatment_start_date.value')=='')
          jQuery("#9-toggleContainer").toggle(false);

       if(getValue('10-past_treatment_start_date.value')=='')
        jQuery("#10-toggleContainer").toggle(false); */
		
		});
	
		jQuery(function() { 
		
			var treatmentDetailsDiv = jQuery("#div_treatment_details");
			
			getField('treatment_past.value').change(function() {
					
					if(getValue('treatment_past.value')=='1065'){
					
						   treatmentDetailsDiv.show();
					}
					else {
					//9
					for (i = 1; i &lt; 11; i++){
					   setValue(i+"-past_treatment_start_date.value","");
					   setValue(i+"-past_treatment_end_date.value","");
					   setValue(i+"-tb_type.value","");
					   setValue(i+"-past_tb_category.value","");
					   setValue(i+"-past_regimen_treatment_known.value","");
					   //uncheck
					   uncheckAllCheckBoxes(i+"-past_regimen");
					   setValue(i+"-past_reg_num_treatment.value","");
					   setValue(i+"-past_treatment_outcome.value","");
					   jQuery("#"+i+"-facility_list").val("");
					   setValue(i+"-past_reg_treatment_facility.value","");
					   setValue(i+"-other_past_reg_facility_treatment.value","");
					   }
					//9
						treatmentDetailsDiv.hide();
					}
			});
		
		});
		
		beforeSubmit.push(function() {
			
			var tb_regimen_check = true;
			
			var valid=true;
			
			for (i = 0; i &lt; 10; i++) { 
				var incremented = i + 1;
				var divInAction = "#" + incremented + "-toggleContainer";
				var tbTypeValue = incremented + "-tb_type.value";
				var tbTypeError = incremented + "-tb_type.error";
				
				var pastTreatmentStartDateValue = incremented + "-past_treatment_start_date.value";
				var pastTreatmentEndDateValue 	= incremented + "-past_treatment_end_date.value";
				var pastTreatmentEndDateError = incremented + "-past_treatment_end_date.error";
				
				
				var pastTbCategoryValue = incremented + "-past_tb_category.value";
				var pastTbCategoryError = incremented + "-past_tb_category.error";
				
				var pastRegimenKnownValue = incremented + "-past_regimen_treatment_known.value";
				var pastRegimenKnownError = incremented + "-past_regimen_treatment_known.error";
				
				var pastRegimen = incremented + "-past_regimen";
				
				var tbDrugError = incremented + "-isoniazid.error";
				
				var pastTreatmentOutcomeValue = incremented + "-past_treatment_outcome.value";
				var pastTreatmentOutcomeError = incremented + "-past_treatment_outcome.error";
				
				var pastTreatmentFacilityValue = incremented + "-past_reg_treatment_facility.value";
				var pastTreatmentFacilityOtherValue = incremented + "-other_past_reg_facility_treatment.value";
				var pastTreatmentFacilityOtherError = incremented + "-other_past_reg_facility_treatment.error";
				
				if (jQuery(divInAction).is(":visible")) {
					
					if(getValue(tbTypeValue)=='') {
						valid = false;
						getField(tbTypeError).html('Please select a value.').show();					
					}
					else {
						getField(tbTypeError).html('').hide();
					}
					
					//13
					// =====================================================
					
					if( getValue(pastTreatmentStartDateValue)!='' &amp;&amp; getValue(pastTreatmentEndDateValue)!='' ) {
						
						if( compareDates(getValue(pastTreatmentStartDateValue),getValue(pastTreatmentEndDateValue)) ){
							valid = false;
							getField(pastTreatmentEndDateError).html('Past TB Treatment End Date can not be before Past TB Treatment Start Date. Please select correct Date.').show();
						}
						else {
							getField(pastTreatmentEndDateError).html('').hide();
						}
					}
					else {
							getField(pastTreatmentEndDateError).html('').hide();
					}
					// =====================================================
					//13
					
					// =====================================================
					
					if(getValue(pastTbCategoryValue)=='') {
						valid = false;
						getField(pastTbCategoryError).html('Please select a value.').show();
					}
					else {
						getField(pastTbCategoryError).html('').hide();
					}
					
					// =====================================================
					
					if(getValue(pastRegimenKnownValue)=='') {
						valid = false;
						getField(pastRegimenKnownError).html('Please select a value.').show();
					}
					else {
						getField(pastRegimenKnownError).html('').hide();
					}
					
					// =====================================================
					
					// CHECK THIS
					var pastRegimenCheckboxes = "#" + pastRegimen + " input[type=checkbox]"; 
					var pastRegimenCheckboxesChecked = "#" + pastRegimen + " input[type=checkbox]:checked";
					jQuery(pastRegimenCheckboxes).on('change', function () {
						var len = jQuery(pastRegimenCheckboxesChecked).length;
						if (len > 0) {	
							tb_regimen_check = false;
						}
					}).trigger('change');
					
					
					if(getValue(pastRegimenKnownValue)==1065 &amp;&amp; tb_regimen_check == true) {
						getField(tbDrugError).html('Please select a value.').show();
						valid=false;
					}
					else {
						getField(tbDrugError).html('').hide();
					}
					
					// =====================================================
					
					if(getValue(pastTreatmentOutcomeValue)=='') {
						valid = false;
						getField(pastTreatmentOutcomeError).html('Please select a value.').show();
					}
					else {
						getField(pastTreatmentOutcomeError).html('').hide();
					}
					
					// ====================================================
					if(getValue(pastTreatmentFacilityValue)!='') {
						if(getValue(pastTreatmentFacilityValue)=='OTHER' &amp;&amp; getValue(pastTreatmentFacilityOtherValue)=='') {
							valid = false;
							getField(pastTreatmentFacilityOtherError).html('Please input value.').show();
						}
						else {
							getField(pastTreatmentFacilityOtherError).html('').hide();
						}
					}
					//5
					if(getValue(pastTreatmentFacilityValue)=='Please select location')
					{
						setValue(pastTreatmentFacilityValue,"");
					}
					//5
					
					
					if(getValue(pastRegimenKnownValue)==1066) {
						uncheckAllCheckBoxes(pastRegimen);
					}
				}
				
			}
			
			if(valid==true){
				return true;
			}
			else {
				return false;
			}
			
		});
			
	}
	
//1	
	<ifMode mode='VIEW' include="false">
		//hide and show tbdrugs based on selected value		
		$j(document).ready(function(){
		  $j('.tbDrugs').change(function() {
					pasttbDrugsChange(this.id);
		 });
		});

		function pasttbDrugsChange(idNo){
		var res = idNo.split("-");
		var n=res[0];
		
		if(getValue(n+'-past_regimen_treatment_known.value') == 1065 ){
			jQuery("#"+n+"-past_regimen").show();
		}
		else{		
			uncheckAllCheckBoxes(n+"-past_regimen");
			jQuery("#"+n+"-past_regimen").hide();				
		}
	}
	
	</ifMode>
//1	

//14
function compareDates(startDate,endDate){
	
    startDate = new Date(startDate);
    endDate = new Date(endDate);
	
	startDate.setHours(0,0,0,0);
	endDate.setHours(0,0,0,0);
	
	var timeDiff = endDate.getTime() - startDate.getTime();
	var diffDays = Math.floor(timeDiff / (1000 * 3600 * 24));
  
	//true if diff is negative 
	if(diffDays &lt; 0){
		return true;
	}
	else{
		return false;
	}
}
//14
    </script>

<!-- END OF FORM

Simple examples to copy-and-paste. Full reference at http://wiki.openmrs.org/x/kg8z

SECTION
	<section headerLabel="\#. Title">
		Content
	</section>

NUMERIC OBSERVATION
	<obs conceptId="id-of-numeric-concept" labelText="Label before"/>

DATE OBSERVATION
	<obs conceptId="id-of-date-concept" labelText="Label before"/>

CODED OBSERVATION
(as a dropdown)
	<obs conceptId="id-of-coded-concept" labelText="Label before"/>
(as radio buttons)
	<obs conceptId="id-of-coded-concept" labelText="Label before" style="radio"/>
(as an autocomplete)
	<obs conceptId="id-of-coded-concept" labelText="Label before" style="autocomplete" answerClasses="Diagnosis"/>
(as a checkbox for a specific answer)
	<obs conceptId="id-of-coded-concept" labelText="Label before" answerConceptId="id-of-answer-concept" answerLabel="label for answer"/>
(as a dropdown with specific choices)
	<obs conceptId="id-of-coded-concept" labelText="Label before" answerConceptIds="concept-id-1,concept-id-2,concept-id-3" answerLabels="Label 1,Label 2, Label 3"/>


FREE TEXT OBSERVATION
(as a normal text field)
	<obs conceptId="id-of-text-concept" labelText="Label before"/>
(as a textarea)
	<obs conceptId="id-of-text-concept" labelText="Label before" rows="4" cols="80"/>
-->
</htmlform>