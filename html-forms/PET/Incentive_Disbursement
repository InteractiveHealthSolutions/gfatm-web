<htmlform>
	<!-- Autogenerated example form  (template from 01-Nov-2010 -->
	<macros>
		paperFormId = (Fill this in)
		headerColor =#009d8e
		fontOnHeaderColor = white
	</macros>

	<style>
		.section {
			border: 1px solid $headerColor;
			padding: 2px;
			text-align: left;
			margin-bottom: 1em;
		}
		.sectionHeader {
			background-color: $headerColor;
			color: $fontOnHeaderColor;
			display: block;
			padding: 2px;
			font-weight: bold;
		}
		table.baseline-aligned td {
			vertical-align: baseline;
		}
	</style>

	<span style="float:right">Paper Form ID: $paperFormId</span>
	<h2>PET-Incentive Disbursement</h2>

	<section headerLabel="1. Encounter Details">
		<table class="baseline-aligned">
			<tr>
				<td>Date:</td>
				<td><encounterDate default="today"/></td>
			</tr>
			<tr>
				<td>Location:</td>
				<td><encounterLocation default="2"/></td>
			</tr>
			<tr>
				<td>Provider:</td>
				<td><encounterProvider default="currentUser" type="autocomplete"/></td>
			</tr>
		</table>
	</section>

	<section headerLabel="2. Incentive Disbursement">
		<table class="baseline-aligned">

                        <tr>
				<td>CNIC:</td>
				<td> <obs conceptId="163084" id="cnic" maxlength="15" required="true" /></td>
			</tr>

			<tr>
				<td>Whose CNIC is this?</td>
                                <td><obs conceptId="164107" answerConceptIds="978,970,971,160729,160730,160725,160726,160724,160723,974,975,164110" answerLabels="Self,Mother,Father,Brother,Sister,Paternal Grandfather,Paternal Grandmother,Maternal Grandfather,Maternal Grandmother,Uncle,Aunt,Other" id="cnic_owner" required="true" >
				<controls>
						<when value="164110" thenDisplay="#cnic_owner_other_row"/>
				</controls>
				</obs></td>
			</tr>
			
                       <tr id="cnic_owner_other_row">
				<td>If other, specify:</td>
				<td> <obs conceptId="164110" id="cnic_owner_other" maxlength="20" /></td>
			</tr>

                        <tr id="incentive_occasion_row">
				<td>Incentive occasion:</td>
                                <td><obs conceptId="164361" answerConceptIds="162080,160523" answerLabels="Baseline visit,Follow-up"  defaultValue="162080" id="incentive_occasion"> 
                            
                                </obs></td>
			</tr>

                        <tr id="incentive_for_row_followup">
				<td>Incentive for:</td>
				<td> <obs conceptId="164362" answerConceptIds="162571,161642" id="incentive_for" answerLabels="Contact,Treatment Supporter" defaultValue="162571"/></td>
			</tr>

                <tr id="incentive_for_row_baseline">
				<td>Incentive for:</td>
				<td> <obs conceptId="164362" answerConceptIds="162571" answerLabels="Contact" defaultValue="162571"/></td>
			</tr>

                         <tr id="treatment_supporter_name_row">
				<td>Name of Treatment Supporter:</td>
				<td> <obs conceptId="160638" id="name_treatment_supporter" maxlength="20" required="true" /></td>
			</tr>

                        <tr id="treatment_supporter_number_row">
				<td>Treatment Supporter Phone Number:</td>
				<td> <obs conceptId="160642" id="phone_treatment_supporter" maxlength="11" required="true" /></td>
			</tr>

                        <tr id="treatment_supporter_type_row">
				<td>Treatment Supporter type:</td>
				<td> <obs conceptId="164251" answerConceptIds="1560,1582" answerLabels="Family treatment supporter,Non-family treatment supporter"/></td>
			</tr>

                        <tr id="treatment_supporter_relationship_row">
				<td>Relationship of treatment supporter with the patient</td>
                                <td><obs conceptId="160640" answerConceptIds="970,971,160729,160730,160725,160726,160724,160723,974,975,164110" answerLabels="Mother,Father,Brother,Sister,Paternal Grandfather,Paternal Grandmother,Maternal Grandfather,Maternal Grandmother,Uncle,Aunt,Other" id="relationship_treatment_supporter">

                                <controls>
						<when value="164110" thenDisplay="#relationship_treatment_supporter_other_row"/>
				</controls>
				</obs></td>
			</tr>

                    <tr id="relationship_treatment_supporter_other_row">
				<td>Others:</td>
				<td> <obs conceptId="5620" id="relationship_treatment_supporter_other" maxlength="15" /></td>
			</tr>

                 <tr id="pet_regimen_row">
				<td>PET Regimen:</td>

				<td> <obs conceptId="164243" answerConceptIds="1679,164241,164242" answerLabels="Isoniazid Prophylaxis therapy,Isoniazid + Rifapentine,Levofloxacin + Ethionamide"/></td>
			</tr>
			
		</table>
	</section>

<section headerLabel="3. Incentive Details">
		<table class="baseline-aligned">
			<tr>
				<td>Incentive Date:</td>
				<td><obs conceptId="165735"/></td>
			</tr>

                        <tr>
				<td>Incentive amount (in Rupees):</td>
				<td><obs conceptId="164366"/></td>
			</tr>

                          <tr>
				<td>Follow-up Month:</td>
				<td><obs conceptId="164367"/></td>
			</tr>

                          <tr>
				<td>Incentive disbursal location:</td>
				<td><obs conceptId="161010" answerConceptIds="1537,1536" answerLabels="Facility,Contact's home"/></td>
			</tr>

                           <tr>
				<td>Receiver's Name:</td>
				<td> <obs conceptId="164369"  maxlength="50" /></td>
			</tr>

                        <tr>
				<td>Receiver's relation with Contact?</td>
                                <td><obs conceptId="164370" answerConceptIds="978,970,971,160729,160730,160725,160726,160724,160723,974,975,164110" answerLabels="Self,Mother,Father,Brother,Sister,Paternal Grandfather,Paternal Grandmother,Maternal Grandfather,Maternal Grandmother,Uncle,Aunt,Other" id="receiver_relationship" required="true" >
				<controls>
						<when value="164110" thenDisplay="#receiver_relationship_other_row"/>
				</controls>
				</obs></td>
			</tr>
			
                       <tr id="receiver_relationship_other_row">
				<td>Others:</td>
				<td> <obs conceptId="164371" id="receiver_relationship_other" maxlength="20" /></td>
			</tr>
			
		</table>
	</section>

	<submit/>

<script type="text/javascript">

		jQuery( document ).ready(function() {

                  $j("#incentive_for_row_followup").hide();
                  $j("#treatment_supporter_name_row").hide();
                  $j("#treatment_supporter_number_row").hide();
                  $j("#treatment_supporter_type_row").hide();
                  $j("#treatment_supporter_relationship_row").hide();
                  $j("#relationship_treatment_supporter_other_row").hide();

var regimen = <lookup expression="fn.latestObs('164243').valueCoded"/>;

                 
                  var cnicEncounters = "<lookup complexExpression="#foreach($encounter in $fn.allEncounters('25a042b2-60bc-4940-a909-debd098b7d82'))  $fn.getObs($encounter, '163084').getValueAsString($!{locale}) #end"/>";
		   var cnicResult = cnicEncounters.replace(/\s\s+/g, '@');
                   var cnicResultValueArray = cnicResult.split('@');
		   var cnicValue = cnicResultValueArray[cnicResultValueArray.length-1];
		   
		   var cnicOwnerEncounters = "<lookup complexExpression="#foreach($encounter in $fn.allEncounters('25a042b2-60bc-4940-a909-debd098b7d82'))  $fn.getObs($encounter, '164107').getValueAsString($!{locale}) #end"/>";
		   var cnicOwnerResult = cnicOwnerEncounters.replace(/\s\s+/g, '@');
                   var cnicOwnerResultValueArray = cnicOwnerResult.split('@');
		   var cnicOwnerValue = cnicOwnerResultValueArray[cnicOwnerResultValueArray.length-1];


               if(cnicValue.trim() != '' &amp;&amp; cnicValue.trim() != "$fn.getObs($encounter, '163084').getValueAsString($!{locale})") {
		     setValue("cnic.value", cnicValue.trim());
			}
			
			if(cnicOwnerValue.trim() != '' &amp;&amp; cnicOwnerValue.trim() != "$fn.getObs($encounter, '164107').getValueAsString($!{locale})") {
		   
              if(cnicOwnerValue.trim() == "SELF") {
			  setValue("cnic_owner.value", "Self");
			  }
			  else if(cnicOwnerValue.trim() == "MOTHER") {
			  setValue("cnic_owner.value", "Mother");
			  } 
			  else if(cnicOwnerValue.trim() == "FATHER") {
			  setValue("cnic_owner.value", "Father");
			  }
              else if(cnicOwnerValue.trim() == "MATERNAL GRANDMOTHER") {
			  setValue("cnic_owner.value", "Maternal Grandmother");
			  }	
              else if(cnicOwnerValue.trim() == "MATERNAL GRANDFATHER") {
			  setValue("cnic_owner.value", "Maternal Grandfather");
			  }
              else if(cnicOwnerValue.trim() == "PATERNAL GRANDMOTHER") {
			  setValue("cnic_owner.value", "Paternal Grandmother");
			  }
              else if(cnicOwnerValue.trim() == "PATERNAL GRANDFATHER") {
			  setValue("cnic_owner.value", "Paternal Grandfather");
			  }
              else if(cnicOwnerValue.trim() == "BROTHER") {
			  setValue("cnic_owner.value", "Brother");
			  }
              else if(cnicOwnerValue.trim() == "SISTER") {
			  setValue("cnic_owner.value", "Sister");
			  }
              else if(cnicOwnerValue.trim() == "SON") {
			  setValue("cnic_owner.value", "Son");
			  }	
              else if(cnicOwnerValue.trim() == "DAUGHTER") {
			  setValue("cnic_owner.value", "Daughter");
			  }
              else if(cnicOwnerValue.trim() == "SPOUSE") {
			  setValue("cnic_owner.value", "Spouse");
			  }
              else if(cnicOwnerValue.trim() == "AUNT") {
			  setValue("cnic_owner.value", "Aunt");
			  }
              else if(cnicOwnerValue.trim() == "UNCLE") {
			  setValue("cnic_owner.value", "Uncle");
			  }
              else if(cnicOwnerValue.trim() == "OTHER FAMILY MEMBER") {
			  setValue("cnic_owner.value", "Other");

                          var otherCnicOwnerEncounters = "<lookup complexExpression="#foreach($encounter in $fn.allEncounters('25a042b2-60bc-4940-a909-debd098b7d82'))  $fn.getObs($encounter, '164110').getValueAsString($!{locale}) #end"/>";
		   var otherCnicOwnerResult = otherCnicOwnerEncounters.replace(/\s\s+/g, '@');
                   var otherCnicOwnerResultValueArray = otherCnicOwnerResult .split('@');
		   var otherCnicOwnerValue = otherCnicOwnerResultValueArray [otherCnicOwnerResultValueArray .length-1];

if(otherCnicOwnerValue .trim() != '' &amp;&amp; otherCnicOwnerValue .trim() != "$fn.getObs($encounter, '164110').getValueAsString($!{locale})") {
		     setValue("cnic_owner_other.value", otherCnicOwnerValue .trim());
                     $j("#cnic_owner_other_row").show();

			
}

			  }			  
			  
			}


                 });

jQuery(function() {
		 
		      getField('incentive_occasion.value').change(function() {
				if(getValue('incentive_occasion.value') == 162080) {
				    $j("#incentive_for_row_baseline").show();
                                    $j("#incentive_for_row_followup").hide();
$j("#treatment_supporter_name_row").hide();
$j("#treatment_supporter_number_row").hide();
$j("#treatment_supporter_type_row").hide();
$j("#treatment_supporter_relationship_row").hide();
$j("#relationship_treatment_supporter_other_row").hide();

				}
				else {
				    $j("#incentive_for_row_baseline").hide();
                                    $j("#incentive_for_row_followup").show();

if(getValue('incentive_for.value') == 161642) {
				    
$j("#treatment_supporter_name_row").show();
$j("#treatment_supporter_number_row").show();
$j("#treatment_supporter_type_row").show();
$j("#treatment_supporter_relationship_row").show();
$j("#relationship_treatment_supporter_other_row").show();
				}

				}
               });

                       getField('incentive_for.value').change(function() {
				
if(getValue('incentive_for.value') == 161642) {
				    
$j("#treatment_supporter_name_row").show();
$j("#treatment_supporter_number_row").show();
$j("#treatment_supporter_type_row").show();
$j("#treatment_supporter_relationship_row").show();
$j("#relationship_treatment_supporter_other_row").show();
				}
				else {
				    $j("#treatment_supporter_name_row").hide();
$j("#treatment_supporter_number_row").hide();
$j("#treatment_supporter_type_row").hide();
$j("#treatment_supporter_relationship_row").hide();
$j("#relationship_treatment_supporter_other_row").hide();
				}
               });
			   
			  
		});


                      beforeSubmit.push(function() {
			var valid=true;

                       if(getValue('reason_followup_end.value') == 5622  &amp;&amp; getValue('explanation.value') == ''){
					getField('explanation.error').html('This field can not be null').show();
					valid=false;
			}
			else{
				getField('explanation.error').html('').hide();
			}

                       if(getValue('reason_followup_end.value') == 164376 &amp;&amp; getValue('index_exclusion_reason.value') == 5622 &amp;&amp; getValue('other.value') == ''){
					getField('other.error').html('This field can not be null').show();
					valid=false;
			}
			else{
				getField('other.error').html('').hide();
			}
         


if(valid==false){
				return false;
            }
			else {
			    
				var endDate = new Date();
                var timeDiff = Math.abs(endDate.getTime() - startDate.getTime());
				var diffSec = timeDiff/1000;
				alert(diffSec + " seconds to fill form");
                return true;
            } 
});

</script>

</htmlform>