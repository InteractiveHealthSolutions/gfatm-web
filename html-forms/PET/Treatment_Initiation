<htmlform>
	<!-- Autogenerated example form  (template from 01-Nov-2010 -->
	<macros>
		paperFormId = (Fill this in)
		headerColor =#009d8e
		fontOnHeaderColor = white
	</macros>

	<style>
		.section {
			border: 1px solid $headerColor;
			padding: 2px;
			text-align: left;
			margin-bottom: 1em;
		}
		.sectionHeader {
			background-color: $headerColor;
			color: $fontOnHeaderColor;
			display: block;
			padding: 2px;
			font-weight: bold;
		}
		table.baseline-aligned td {
			vertical-align: baseline;
		}
	</style>
      	<span style="float:right">Paper Form ID: $paperFormId</span>
	<h2>PET-Treatment Initiation (v1.0)</h2>

	<section headerLabel="1. Encounter Details">
		<table class="baseline-aligned">
			<tr>
				<td>Date:</td>
				<td><encounterDate default="today"/></td>
			</tr>
			<tr>
				<td>Location:</td>
				<td><encounterLocation default="1"/></td>
			</tr>
			<tr>
				<td>Provider:</td>
				<td><encounterProvider default="currentUser" type="autocomplete"/></td>
			</tr>

		</table>
	</section>

	<section headerLabel="2. Treatment Initiation Information">
		<div>

<p>
		Weight (in kg)
		<br/>
		<obs conceptId="5089" id="weight" required="true"/>
	</p>

         <p>
		Index Patient ID:
                <b><lookup expression="fn.latestObs(163755).valueText" /></b>
	</p>

        <p>
		Index type of TB according to drug sensitivity:
                <b><lookup expression="fn.latestObs(164091).valueCoded.name" /></b>
	</p>

        <p id="drtb_1">
		Index Type of DR-TB resistance:
                <b><lookup expression="fn.latestObs(164092).valueCoded.name" /></b>
	</p>

       <p id="dstb">
		Index DSTB type:
                <b><lookup expression="fn.latestObs(164238).valueCoded.name" /></b>
	</p>

      <p id="drtb_2">
		Index Culture DST pattern:
	<lookup complexExpression="#set( $enc = $fn.latestEncounter('e22e39fd-7db2-45e7-80f1-60fa0d5a4378') ) #foreach($obs in $fn.allObs($enc, '159956'))  obs.valueCoded.name #end"/>;

                <b><lookup expression="fn.latestObs(159956).valueCoded.name" /></b>
	</p>
		
	<p>
		PET Registration/Treatment initiation Date
		<br/>
		<obs conceptId="163526" id="treatment_start_date" required="true"/>
	</p>
	
	<p>
		PET Regimen
		<br/>
		<obs conceptId="164243" id="pet_regimen" answerConceptIds="1679,164241,164242,166146,166147,166148,166149,166150" required="true"/>
	</p>
	
	
	<p id="isoniazid_div">
		Isoniazid dose <label style="color:red">*</label>
		<br/>
		<obs conceptId="164244" id="isoniazid_dose"  maxlength="4" />
	</p>
	
	<p id="rifapentine_div">
		Rifapentine dose <label style="color:red">*</label>
		<br/>
		<obs conceptId="164245" id="rifapentine_dose"  maxlength="4" />
	</p>
	
	
	<p id="levofloxacin_div">
		Levofloxacin dose <label style="color:red">*</label>
		<br/>
		<obs conceptId="164246" id="levofloxacin_dose"  maxlength="4" />
	</p>
	
	<p id="ethionamide_div">
		Ethionamide dose <label style="color:red">*</label>
		<br/>
		<obs conceptId="164247" id="ethionamide_dose"  maxlength="4" />
	</p>

       <p id="ethambutol_div">
		Ethambutol dose <label style="color:red">*</label>
		<br/>
		<obs conceptId="166151" id="ethambutol_dose"  maxlength="4" />
	</p>

         <p id="moxifloxacilin_div">
		Moxifloxacilin dose  <label style="color:red">*</label>
		<br/>
		<obs conceptId="166152" id="moxifloxacilin_dose"  maxlength="4" />
	</p>
	
	
	<p>
		Is there a need for ancillary drugs?
		<br/>
		<obs conceptId="164248" id="ancillary_need" required="true" defaultValue="1066" >
                 <controls>
                     <when value="1065" thenDisplay="#ancillary_yes"/>
                 </controls>
				</obs>
        </p>
	
	<div id="ancillary_yes" >
	<p >
		Ancillary drugs
		<br/>
		<obsgroup groupingConceptId="164249" id="ancillary_drugs">
			<obs conceptId="164249" answerConceptId="78218"/>
			<br/>
			<obs conceptId="164249" answerConceptId="86345"/>
			<br/>
			<obs conceptId="164249" answerConceptId="104248"/>
			<br/>		
		</obsgroup>
	</p>
	
	<p>
		Duration of ancillary drugs
		<br/>
		<obs conceptId="159368" id="ancillary_drugs_duration"/>
	</p>
	
        </div>
	
	<p>
		Name of Treatment Supporter
		<br/> 
		<obs conceptId="160638" id="treatment_supporter" size="50"/>
	</p>
	
	
	<p>
		Treatment Supporter Phone Number
		<br/>
		<obs conceptId="160642" id="treatment_supporter_contact" size="11"/>
	</p>
	
	<p>
		Treatment Supporter type
		<br/>
		<obs conceptId="164251" id="treatment_supporter_type">
            <controls>
                <when value="1560" thenDisplay="#family_supporter"/>
            </controls>
		</obs>
	</p>
	<div id="family_supporter">
	<p>
		Relationship of treatment supporter with the patient
		<br/>
		<obs conceptId="160640" id="treatment_supporter_relation" answerConceptIds="970,971,160723,160724,160726,160725,160729,160730,160727,160728,5617,975,974,5620"  defaultValue="970">
				<controls>
                     <when value="5620" thenDisplay="#others_supporter"/>
                 </controls>
				</obs>
	</p>
	<p id="others_supporter">
		Other
		<br/>
		<obs conceptId="5620" id="other_treatment_supporter_relation"/>
	</p>
	</div>

<p>
			Clinician's notes	
			<br/>
			<obs conceptId="164237" id="doctor_notes" />
		</p>

<p>
			Return Visit Date
			<br/>
			<obs conceptId="5096" id="return_visit_date"  required="true" allowFutureDates="true"/>
		</p>
                </div>
	</section>

	<submit/>
	<script type="text/javascript">

jQuery(window).bind("load", function() {

var id = "<lookup expression="fn.latestObs(164091).valueCoded.id" />";
if(id == 160248){
$j("#dstb").show();
$j("#drtb_1").hide();
$j("#drtb_2").hide();
}
else{
$j("#dstb").hide();
$j("#drtb_1").show();
$j("#drtb_2").show();
}
       

<ifMode mode="EDIT">

$j("#isoniazid_div").hide();
   $j("#rifapentine_div").hide();
$j("#levofloxacin_div").hide();
$j("#ethionamide_div").hide();
$j("#ethambutol_div").hide();
$j("#moxifloxacilin_div").hide();

 if(getValue('pet_regimen.value') == 1679){
                              $j('#isoniazid_div').show();
                              setValue('rifapentine_dose.value','');
                              setValue('levofloxacin_dose.value','');
                              setValue('ethionamide_dose.value','');
                              setValue('ethambutol_dose.value','');
                              setValue('moxifloxacilin_dose.value','');
                        }else  if(getValue('pet_regimen.value') == 164241){
                              $j('#isoniazid_div').show();
                              $j('#rifapentine_div').show();
                              setValue('levofloxacin_dose.value','');
                              setValue('ethionamide_dose.value','');
                              setValue('ethambutol_dose.value','');
                              setValue('moxifloxacilin_dose.value','');
                        }else  if(getValue('pet_regimen.value') == 164242){
                             $j('#levofloxacin_div').show();
                              $j('#ethionamide_div').show();
                              setValue('isoniazid_dose.value','');
                              setValue('rifapentine_dose.value','');
                              setValue('ethambutol_dose.value','');
                              setValue('moxifloxacilin_dose.value','');
                        }else  if(getValue('pet_regimen.value') == 166146){
                             $j('#levofloxacin_div').show();
                              $j('#ethambutol_div').show();
                              setValue('isoniazid_dose.value','');
                              setValue('rifapentine_dose.value','');
                              setValue('ethionamide_dose.value','');
                              setValue('moxifloxacilin_dose.value','');
                        }else  if(getValue('pet_regimen.value') == 166147){
                             $j('#levofloxacin_div').show();
                              $j('#moxifloxacilin_div').show();
                              setValue('isoniazid_dose.value','');
                              setValue('rifapentine_dose.value','');
                              setValue('ethionamide_dose.value','');
                              setValue('ethambutol_dose.value','');
                        }else  if(getValue('pet_regimen.value') == 166148){
                             $j('#ethionamide_div').show();
                              $j('#ethambutol_div').show();
                              setValue('isoniazid_dose.value','');
                              setValue('rifapentine_dose.value','');
                              setValue('levofloxacin_dose.value','');
                              setValue('moxifloxacilin_dose.value','');
                        }else  if(getValue('pet_regimen.value') == 166149){
                             $j('#ethionamide_div').show();
                              $j('#moxifloxacilin_div').show();
                              setValue('isoniazid_dose.value','');
                              setValue('rifapentine_dose.value','');
                              setValue('levofloxacin_dose.value','');
                              setValue('ethambutol_dose.value','');
                        }else  if(getValue('pet_regimen.value') == 166150){
                             $j('#ethambutol_div').show();
                              $j('#moxifloxacilin_div').show();
                              setValue('isoniazid_dose.value','');
                              setValue('rifapentine_dose.value','');
                              setValue('levofloxacin_dose.value','');
                              setValue('ethionamide_dose.value','');
                        }
</ifMode>

<ifMode mode="ENTER">
   $j("#isoniazid_div").hide();
   $j("#rifapentine_div").hide();
$j("#levofloxacin_div").hide();
$j("#ethionamide_div").hide();
$j("#ethambutol_div").hide();
$j("#moxifloxacilin_div").hide();
</ifMode>

        });

jQuery(function() {	

getField('pet_regimen.value').change(function() {

$j("#isoniazid_div").hide();
$j("#rifapentine_div").hide();
$j("#levofloxacin_div").hide();
$j("#ethionamide_div").hide();
$j("#ethambutol_div").hide();
$j("#moxifloxacilin_div").hide();

                        if(getValue('pet_regimen.value') == 1679){
                              $j('#isoniazid_div').show();
                              setValue('rifapentine_dose.value','');
                              setValue('levofloxacin_dose.value','');
                              setValue('ethionamide_dose.value','');
                              setValue('ethambutol_dose.value','');
                              setValue('moxifloxacilin_dose.value','');
                        }else  if(getValue('pet_regimen.value') == 164241){
                              $j('#isoniazid_div').show();
                              $j('#rifapentine_div').show();
                              setValue('levofloxacin_dose.value','');
                              setValue('ethionamide_dose.value','');
                              setValue('ethambutol_dose.value','');
                              setValue('moxifloxacilin_dose.value','');
                        }else  if(getValue('pet_regimen.value') == 164242){
                             $j('#levofloxacin_div').show();
                              $j('#ethionamide_div').show();
                              setValue('isoniazid_dose.value','');
                              setValue('rifapentine_dose.value','');
                              setValue('ethambutol_dose.value','');
                              setValue('moxifloxacilin_dose.value','');
                        }else  if(getValue('pet_regimen.value') == 166146){
                             $j('#levofloxacin_div').show();
                              $j('#ethambutol_div').show();
                              setValue('isoniazid_dose.value','');
                              setValue('rifapentine_dose.value','');
                              setValue('ethionamide_dose.value','');
                              setValue('moxifloxacilin_dose.value','');
                        }else  if(getValue('pet_regimen.value') == 166147){
                             $j('#levofloxacin_div').show();
                              $j('#moxifloxacilin_div').show();
                              setValue('isoniazid_dose.value','');
                              setValue('rifapentine_dose.value','');
                              setValue('ethionamide_dose.value','');
                              setValue('ethambutol_dose.value','');
                        }else  if(getValue('pet_regimen.value') == 166148){
                             $j('#ethionamide_div').show();
                              $j('#ethambutol_div').show();
                              setValue('isoniazid_dose.value','');
                              setValue('rifapentine_dose.value','');
                              setValue('levofloxacin_dose.value','');
                              setValue('moxifloxacilin_dose.value','');
                        }else  if(getValue('pet_regimen.value') == 166149){
                             $j('#ethionamide_div').show();
                              $j('#moxifloxacilin_div').show();
                              setValue('isoniazid_dose.value','');
                              setValue('rifapentine_dose.value','');
                              setValue('levofloxacin_dose.value','');
                              setValue('ethambutol_dose.value','');
                        }else  if(getValue('pet_regimen.value') == 166150){
                             $j('#ethambutol_div').show();
                              $j('#moxifloxacilin_div').show();
                              setValue('isoniazid_dose.value','');
                              setValue('rifapentine_dose.value','');
                              setValue('levofloxacin_dose.value','');
                              setValue('ethionamide_dose.value','');
                        }

                });
});
	
		var startDate = new Date();
		beforeSubmit.push(function() {
					var error1=true,error2=true,error3=true,error4=true,error5=true,error6=true,error7=true,error8=true;
					setValue('rifapentine_dose.error', '');
					setValue('levofloxacin_dose.error','');
					setValue('ethionamide_dose.error','');
                    setValue('isoniazid_dose.error', '')
					setValue('ancillary_drugs_duration.error', '')
				

                  if(getValue('pet_regimen.value') == 1679){
                   
                   if(getValue('isoniazid_dose.value') ==''){
                        getField('isoniazid_dose.error').html('Required Field').show();
                        error1=false;

                   }
                   else{
                      
                        getField('isoniazid_dose.error').html('').hide();
                        error1=true;

                   }
                 }else  if(getValue('pet_regimen.value') == 164241){
				 
				  if(getValue('isoniazid_dose.value') ==''){
                        getField('isoniazid_dose.error').html('Required Field').show();
                        error1=false;

                   }
                   else{
                        getField('isoniazid_dose.error').html('').hide();
                        error1=true;
                   }
				   
				   if(getValue('rifapentine_dose.value') ==''){
                        getField('rifapentine_dose.error').html('Required Field').show();
                        error2=false;

                   }
                   else{
                        getField('rifapentine_dose.error').html('').hide();
                        error2=true;                     
                   }
                              
                 }else  if(getValue('pet_regimen.value') == 164242){
				 
						if(getValue('levofloxacin_dose.value') ==''){
							getField('levofloxacin_dose.error').html('Required Field').show();
							error3=false;

					   }
					   else{
							getField('levofloxacin_dose.error').html('').hide();
							error3=true;
					   }
					   
					   if(getValue('ethionamide_dose.value') ==''){
							getField('ethionamide_dose.error').html('Required Field').show();
							error4=false;

					   }
					   else{
							getField('ethionamide_dose.error').html('').hide();
							error4=true;                     
                        }
				 }else  if(getValue('pet_regimen.value') == 166146){
                        if(getValue('levofloxacin_dose.value') ==''){
							getField('levofloxacin_dose.error').html('Required Field').show();
							error3=false;

					   }
					   else{
							getField('levofloxacin_dose.error').html('').hide();
							error3=true;
					   }
					   
					   if(getValue('ethambutol_dose.value') ==''){
							getField('ethambutol_dose.error').html('Required Field').show();
							error7=false;

					   }
					   else{
							getField('ethambutol_dose.error').html('').hide();
							error7=true;                     
                        }
                  }else  if(getValue('pet_regimen.value') == 166147){
                       if(getValue('levofloxacin_dose.value') ==''){
							getField('levofloxacin_dose.error').html('Required Field').show();
							error3=false;

					   }
					   else{
							getField('levofloxacin_dose.error').html('').hide();
							error3=true;
					   }
					   
					   if(getValue('moxifloxacilin_dose.value') ==''){
							getField('moxifloxacilin_dose.error').html('Required Field').show();
							error8=false;

					   }
					   else{
							getField('moxifloxacilin_dose.error').html('').hide();
							error8=true;
					   }
					   
                  }else  if(getValue('pet_regimen.value') == 166148){
				  
				      if(getValue('ethionamide_dose.value') ==''){
							getField('ethionamide_dose.error').html('Required Field').show();
							error4=false;

					   }
					   else{
							getField('ethionamide_dose.error').html('').hide();
							error4=true;                     
                        }
                       if(getValue('ethambutol_dose.value') ==''){
							getField('ethambutol_dose.error').html('Required Field').show();
							error7=false;

					   }
					   else{
							getField('ethambutol_dose.error').html('').hide();
							error7=true;                     
                        }
						
                   }else  if(getValue('pet_regimen.value') == 166149){
                        if(getValue('ethionamide_dose.value') ==''){
							getField('ethionamide_dose.error').html('Required Field').show();
							error4=false;

					   }
					   else{
							getField('ethionamide_dose.error').html('').hide();
							error4=true;                     
                        }
						
						if(getValue('moxifloxacilin_dose.value') ==''){
							getField('moxifloxacilin_dose.error').html('Required Field').show();
							error8=false;

					   }
					   else{
							getField('moxifloxacilin_dose.error').html('').hide();
							error8=true;
					   }
                   }else  if(getValue('pet_regimen.value') == 166150){
				   
				    if(getValue('ethambutol_dose.value') ==''){
							getField('ethambutol_dose.error').html('Required Field').show();
							error7=false;

					   }
					   else{
							getField('ethambutol_dose.error').html('').hide();
							error7=true;                     
                        }
				 
				   
                       if(getValue('moxifloxacilin_dose.value') ==''){
							getField('moxifloxacilin_dose.error').html('Required Field').show();
							error8=false;

					   }
					   else{
							getField('moxifloxacilin_dose.error').html('').hide();
							error8=true;
					   }
                    }


                    if(getValue('isoniazid_dose.value') &lt;0 || getValue('isoniazid_dose.value') &gt;1000){
                        getField('isoniazid_dose.error').html('Value out of range. Please enter value between 0 to 1000').show();
                        error1=false;
                    }
                    else{
						getField('isoniazid_dose.error').html('').hide();
                        error1=true;
                    }
					
					if(getValue('rifapentine_dose.value') &lt;0 || getValue('rifapentine_dose.value') &gt;1000){
                        getField('rifapentine_dose.error').html('Value out of range. Please enter value between 0 to 1000').show();
                        error2=false;
                    }
                    else{
						getField('rifapentine_dose.error').html('').hide();
                        error2=true;
                    }
					
					if(getValue('levofloxacin_dose.value') &lt;0 || getValue('levofloxacin_dose.value') &gt;1000){
                        getField('levofloxacin_dose.error').html('Value out of range. Please enter value between 0 to 1000').show();
                        error3=false;
                    }
                    else{
						getField('levofloxacin_dose.error').html('').hide();
                        error3=true;
                    }
					
					if(getValue('ethionamide_dose.value') &lt;0 || getValue('ethionamide_dose.value') &gt;1000){
                        getField('ethionamide_dose.error').html('Value out of range. Please enter value between 0 to 1000').show();
                        error4=false;
                    }
                    else{
						getField('ethionamide_dose.error').html('').hide();
                        error4=true;
                    }
					if(getValue('ancillary_need.value')==1065){
						if(getValue('ancillary_drugs_duration.value') &lt;0 || getValue('ancillary_drugs_duration.value') &gt;25){
							getField('ancillary_drugs_duration.error').html('Value out of range. Please enter value between 0 to 25').show();
							error5=false;
						}
						else if(getValue('ancillary_drugs_duration.value')==''){
							getField('ancillary_drugs_duration.error').html('This field can not be null.').show();
							error5=false;
						}
						else{
							getField('ancillary_drugs_duration.error').html('').hide();
							error5=true;
						}
					}
                  
					
          if(error1 == false || error2==false || error3==false || error4==false || error5==false){
			return false;
		}
		else{
		var endDate = new Date();
		var timeDiff = Math.abs(endDate.getTime() - startDate.getTime());
		var diffSec = timeDiff/1000;
	
		alert(diffSec + " seconds to fill form");
			return true;
		}

		});
    </script>

</htmlform>