<htmlform>
	<!-- Autogenerated example form  (template from 01-Nov-2010 -->
	<macros>
		paperFormId = (Fill this in)
		headerColor =#009d8e
		fontOnHeaderColor = white
	</macros>

	<style>
		.section {
			border: 1px solid $headerColor;
			padding: 2px;
			text-align: left;
			margin-bottom: 1em;
		}
		.sectionHeader {
			background-color: $headerColor;
			color: $fontOnHeaderColor;
			display: block;
			padding: 2px;
			font-weight: bold;
		}
		table.baseline-aligned td {
			vertical-align: baseline;
		}
	</style>

	<span style="float:right">Paper Form ID: $paperFormId</span>
	<h2>PET - End of Followup</h2>

	<section headerLabel="1. Encounter Details">
		<table class="baseline-aligned">
			<tr>
				<td>Date:</td>
				<td><encounterDate default="today"/></td>
			</tr>
			<tr>
				<td>Location:</td>
				<td><encounterLocation/></td>
			</tr>
			<tr>
				<td>Provider:</td>
				<td><encounterProvider default="currentUser" type="autocomplete"/></td>
			</tr>
		</table>
	</section>

	<section headerLabel="2. End of Followup">
		<table class="baseline-aligned">
		
			<tr>
				<td>Reason for end of follow-up:</td>
                                <td><obs conceptId="164377" answerConceptIds="160035,160031,164375,159492,164376,127750,159,5622" answerLabels="Treatment completed,Loss to follow-up,Enrolled in TB program (TB disease),Trasferred out,Index not eligible for study,Refused treatment,Died,Other" id="reason_followup_end" required="true" >
				</obs></td>
			</tr>
			
                       <tr id="explanation_row">
				<td>Explanation:</td>
				<td> <obs conceptId="164378" id="explanation" maxlength="100"/></td>
			</tr>

                        <tr id="index_exclusion_row">
				<td>Reason for Index exclusion:</td>
                                <td><obs conceptId="164379" answerConceptIds="159346,164380,159492,127750,5622" answerLabels="XDR,Pre-XDR,Trasferred out to facility other than PET Sites,Index refused treatment,Others" id="index_exclusion_reason" >
				<controls>
						<when value="5622" thenDisplay="#other_row"/>
				</controls>
				</obs></td>
			</tr>

                        <tr id="other_row">
				<td>Other:</td>
				<td> <obs conceptId="5622" id="other" maxlength="100" /></td>
			</tr>
			
		</table>
	</section>

	<submit/>

<script type="text/javascript">
var startDate = new Date();

 jQuery(window).bind("load", function() {

<ifMode mode="ENTER">

$j("#explanation_row").hide();
$j("#index_exclusion_row").hide();

</ifMode>
       

        });

jQuery(function() {

                getField('reason_followup_end.value').change(function() {
                if(getValue('reason_followup_end.value') == 5622 || getValue('reason_followup_end.value')  == 159492 || getValue('reason_followup_end.value') == 127750){
                         $j("#explanation_row").show();
                           $j("#index_exclusion_row").hide();
                         setValue('index_exclusion_reason.value','');
setValue('other.value','');
                }
				else if(getValue('reason_followup_end.value') == 164376){
							 $j("#explanation_row").hide();
                                                         $j("#index_exclusion_row").show();
                                                        $j("#other_row").hide();
setValue('explanation.value','');
							
				} else{
							 $j("#explanation_row").hide();
                                                         $j("#index_exclusion_row").hide();
$j("#other_row").hide();
setValue('index_exclusion_reason.value','');
setValue('other.value','');		
setValue('explanation.value','');					
				}
                });

});

beforeSubmit.push(function() {
			var valid=true;

            if((getValue('reason_followup_end.value') == 5622 || getValue('reason_followup_end.value')  == 159492 || getValue('reason_followup_end.value') == 127750)  &amp;&amp; getValue('explanation.value') == ''){
					getField('explanation.error').html('This field can not be null').show();
					valid=false;
			}
			else{
				getField('explanation.error').html('').hide();
			}

            if(getValue('reason_followup_end.value') == 164376 &amp;&amp; getValue('index_exclusion_reason.value') == 5622 &amp;&amp; getValue('other.value') == ''){
					getField('other.error').html('This field can not be null').show();
					valid=false;
			}
			else{
				getField('other.error').html('').hide();
			}
         


if(valid==false){
				return false;
            }
			else {
			    
				var endDate = new Date();
                var timeDiff = Math.abs(endDate.getTime() - startDate.getTime());
				var diffSec = timeDiff/1000;
				alert(diffSec + " seconds to fill form");
                return true;
            } 
});

</script>

</htmlform>