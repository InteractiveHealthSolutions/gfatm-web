<htmlform>
	<!-- Autogenerated example form  (template from 01-Nov-2010 -->
	<macros>
		paperFormId = (Fill this in)
		headerColor =#009d8e
		fontOnHeaderColor = white
	</macros>

	<style>
		.section {
			border: 1px solid $headerColor;
			padding: 2px;
			text-align: left;
			margin-bottom: 1em;
		}
		.sectionHeader {
			background-color: $headerColor;
			color: $fontOnHeaderColor;
			display: block;
			padding: 2px;
			font-weight: bold;
		}
		table.baseline-aligned td {
			vertical-align: baseline;
		}
	</style>

	<span style="float:right">Paper Form ID: $paperFormId</span>
	<h2>PET-Missed Visit Follow-up (v1.0.0)</h2>

	<section headerLabel="1. Encounter Details">
		<table class="baseline-aligned">
			<tr>
				<td>Date:</td>
				<td><encounterDate default="today"/></td>
			</tr>
			<tr>
				<td>Location:</td>
				<td><encounterLocation default="2"/></td>
			</tr>
			<tr>
				<td>Provider:</td>
				<td><encounterProvider default="currentUser" type="autocomplete"/></td>
			</tr>
		</table>
	</section>

	<section headerLabel="2. Missed Visit Follow-up">
			<p>
				Date of missed visit
				<br/>
				<obs conceptId="164474" id="missed_visit_date" required="true" />
			</p>
	
			<p>
				Have you been able to contact the patient?
				<br/>
					<obs conceptId="164468" id="patient_contacted" answerConceptIds="1065,1066" required="true">
						<controls>
							<when value="1066" thenDisplay="#reason_patient_not_contacted_div"/>
							<when value="1065" thenDisplay="#reason_why_missed"/>
				        </controls>
                    </obs>
			</p>
			
			<div id="reason_patient_not_contacted_div">
				<p>
					If no, why were you unable to contact the patient?
					<br/>
					<obs conceptId="164469" id="reason_patient_not_contacted" answerConceptIds="164470,164471,164472,166045,164473" answerLabels="Phone switched off,Patient not responding,Invalid/incorrect contact number,Wrong Number,Other">  
					<controls>
						 <when value="164473" thenDisplay="#reason_patient_not_contacted_other_div"/>
				    </controls>
					</obs>
				</p>
			</div>

			<div id="reason_patient_not_contacted_other_div">
				<p>
					If other, please specify
					<br/>
					<obs conceptId="164473" id="reason_patient_not_contacted_other" maxlength="250"/>
				</p>
			</div>
			<!--
			<p id="patient_referred_transferred">
				Has this patient being referred out or transferred out?
				<br/>
				<obs conceptId="164408" id="referral_transfer" answerConceptIds="1648,160036,1175" answerLabels="Referral (before starting treatment),Transfer (after starting treatment),Not applicable">
					<controls>
						//<when value="1175" thenDisplay="#referral_transfer_site_div"/>
					</controls>
				</obs>
			</p>

			<div id="referral_transfer_site_div">
				<p>
					Location of referral / transfer
					<br/>
					<obs conceptId="165752" id="referral_transfer_site"/>
				</p>
			</div>
			-->
			<p id="reason_why_missed">
				Reason why missed visit?
				<br/>
				<obs conceptId="159796" id="reason_missed_visit" answerConceptIds="164454,164410,164451,160034,127750,164453,165753,165754,165755,165756,164458" answerLabels="Patient Relocated,Patient continuing treatment at another location,Patient unable to visit hospital due to personal reasons,Patient died,Patient refused treatment,Patient unwell,Patient has a service complaint,Patient lacks funds to travel to the facility,Unable to locate referral site,Want treatment at parent site,Other" >  
					<controls>
						<when value="164458" thenDisplay="#reason_missed_visit_other_div"/>
					</controls>
				</obs>
			</p>

			<div id="reason_missed_visit_other_div">
				<p>
					If other please specify
					<br/>
					<obs conceptId="164458" id="reason_missed_visit_other" maxlength="250"/>
				</p>
			</div>

			<div id="new_location_div">
				<p>
					New Location
					<br/>
					<obs conceptId="165757" id="new_location" maxlength="20"/>
				</p>
			</div>
			
			
			<div id="facility_treatment_div">
				<p>
					New treatment facility name
					<br/>
					<obs conceptId="162724" id="facility_treatment" maxlength="20"/>
				</p>
			</div>

			<div id="reason_for_changing_facility_div">
				<p>
					Reason for changing to new facility
					<br/>
					<obs conceptId="165760" id="reason_for_changing_facility" answerConceptIds="164402,165758,165753,165759" answerLabels="Relocated,Old facility too far,Service complaint,Other">  
					</obs>
				</p>
			</div>

			<p id="date_next_visit">
				Date of next visit
				<br/>
				<obs conceptId="5096" id="return_visit_date" allowFutureDates="true"/>
			</p>
			
	</section>

	<submit/>

	<script type="text/javascript">

		var startDate = new Date();
		
		<ifMode mode="ENTER">
			//$j('#referral_transfer_site_div').hide();
			$j('#reason_why_missed').hide(); 
			$j('#reason_missed_visit_other_div').hide(); 
			$j('#new_location_div').hide(); 
			$j('#facility_treatment_div').hide(); 
			$j('#reason_for_changing_facility_div').hide(); 
		</ifMode>
		
		jQuery(function() {
			
			getField('patient_contacted.value').change(function() {
				if(getValue('patient_contacted.value') == 1065 || getValue('patient_contacted.value') ==''){
					$j('#reason_patient_not_contacted_other_div').hide(); 
				}
				
				if(getValue('patient_contacted.value') == 1065){
					if(referredTransferred=='PATIENT REFERRED'){
						setValue('referral_transfer.value',1648);
						//$j('#referral_transfer_site_div').show(); 
						
					}else if(referredTransferred=='PATIENT TRANSFERRED OUT'){
						setValue('referral_transfer.value',160036);
						//$j('#referral_transfer_site_div').show(); 
					}else{
						setValue('referral_transfer.value',1175);
						//$j('#referral_transfer_site_div').hide(); 
					}
					//$j('#patient_referred_transferred').show(); 
					$j('#reason_why_missed').show();
					$j('#date_next_visit').show();
					
					
				}else{
					//$j('#patient_referred_transferred').hide(); 
					//$j('#referral_transfer_site_div').hide(); 
					$j('#reason_why_missed').hide(); 
					$j('#reason_missed_visit_other_div').hide(); 
					$j('#new_location_div').hide(); 
					$j('#facility_treatment_div').hide(); 
					$j('#reason_for_changing_facility_div').hide();
					$j('#date_next_visit').hide();
					
				}
				
				
			});
			

			getField('reason_missed_visit.value').change(function() {
				if(getValue('reason_missed_visit.value') == 164454 || getValue('reason_missed_visit.value') == 164410){
					$j('#new_location_div').show();
					$j('#facility_treatment_div').show();
				}
				else{
					$j('#new_location_div').hide();
					$j('#facility_treatment_div').hide();
                }
				
				if(getValue('reason_missed_visit.value') == 164410){
					$j('#reason_for_changing_facility_div').show();
				}
				else{
					$j('#reason_for_changing_facility_div').hide();
				}
				
				
				
            });
		});

		beforeSubmit.push(function() {
			var error = true;
			setValue('reason_patient_not_contacted.error', '');
			setValue('reason_patient_not_contacted_other.error', '');
			//setValue('referral_transfer_site.error', '');
			setValue('reason_missed_visit_other.error', '');
			setValue('new_location.error', '');
			setValue('facility_treatment.error', '');
			setValue('reason_for_changing_facility.error', '');
			setValue('return_visit_date.error', '');

			if(getValue('patient_contacted.value')==1066&amp;&amp; getValue('reason_patient_not_contacted.value')==''){
					getField('reason_patient_not_contacted.error').html('This field can not be null').show();
					error=false;
			}else{
					getField('reason_patient_not_contacted.error').html('').hide();
            }

			if(getValue('patient_contacted.value')==1066&amp;&amp;getValue('reason_patient_not_contacted.value')==164473&amp;&amp;getValue('reason_patient_not_contacted_other.value')==''){
					getField('reason_patient_not_contacted_other.error').html('This field can not be null').show();
					error=false;
			}else{
                    getField('reason_patient_not_contacted_other.error').html('').hide();
            }
			

			if(getValue('reason_missed_visit.value')==164458&amp;&amp; getValue('reason_missed_visit_other.value')==''){
					getField('reason_missed_visit_other.error').html('This field can not be null').show();
					error=false;
			}else{
                    getField('reason_missed_visit_other.error').html('').hide();
            }

			if(getValue('reason_missed_visit.value')==164454 || getValue('reason_missed_visit.value')==164410){
					if(getValue('new_location.value')==''){
						getField('new_location.error').html('This field can not be null').show();
						error=false;
					}
			}else{
					getField('new_location.error').html('').hide();
            }

			if(getValue('reason_missed_visit.value')==164454 || getValue('reason_missed_visit.value')==164410){
					if(getValue('facility_treatment.value')==''){
						getField('facility_treatment.error').html('This field can not be null').show();
						error=false;
					}
			}else{
                    getField('facility_treatment.error').html('').hide();
            }

			if(getValue('reason_missed_visit.value')==164410 &amp;&amp; getValue('reason_for_changing_facility.value')==''){
					getField('reason_for_changing_facility.error').html('This field can not be null').show();
					error=false;
			}else{
					getField('reason_for_changing_facility.error').html('').hide();
            }

			/*if(getValue('patient_contacted.value')==1065&amp;&amp; getValue('return_visit_date.value')==''){
					getField('return_visit_date.error').html('This field can not be null').show();
					error=false;
			}else{
                    getField('return_visit_date.error').html('').hide();
            }*/
			if(error==false){
					return false;
			}
			else{
				var endDate = new Date();
				var timeDiff = Math.abs(endDate.getTime() - startDate.getTime());
				var diffSec = timeDiff/1000;
				alert(diffSec + " seconds to fill form");
				return true;
			}
		});
	</script>

<!-- END OF FORM

Simple examples to copy-and-paste. Full reference at http://wiki.openmrs.org/x/kg8z

SECTION
	<section headerLabel="\#. Title">
		Content
	</section>

NUMERIC OBSERVATION
	<obs conceptId="id-of-numeric-concept" labelText="Label before"/>

DATE OBSERVATION
	<obs conceptId="id-of-date-concept" labelText="Label before"/>

CODED OBSERVATION
(as a dropdown)
	<obs conceptId="id-of-coded-concept" labelText="Label before"/>
(as radio buttons)
	<obs conceptId="id-of-coded-concept" labelText="Label before" style="radio"/>
(as an autocomplete)
	<obs conceptId="id-of-coded-concept" labelText="Label before" style="autocomplete" answerClasses="Diagnosis"/>
(as a checkbox for a specific answer)
	<obs conceptId="id-of-coded-concept" labelText="Label before" answerConceptId="id-of-answer-concept" answerLabel="label for answer"/>
(as a dropdown with specific choices)
	<obs conceptId="id-of-coded-concept" labelText="Label before" answerConceptIds="concept-id-1,concept-id-2,concept-id-3" answerLabels="Label 1,Label 2, Label 3"/>


FREE TEXT OBSERVATION
(as a normal text field)
	<obs conceptId="id-of-text-concept" labelText="Label before"/>
(as a textarea)
	<obs conceptId="id-of-text-concept" labelText="Label before" rows="4" cols="80"/>
-->
</htmlform>