<htmlform>
	<!-- Autogenerated example form  (template from 01-Nov-2010 -->
	<macros>
		paperFormId = (Fill this in)
		headerColor =#009d8e
		fontOnHeaderColor = white
	</macros>

	<style>
		.section {
			border: 1px solid $headerColor;
			padding: 2px;
			text-align: left;
			margin-bottom: 1em;
		}
		.sectionHeader {
			background-color: $headerColor;
			color: $fontOnHeaderColor;
			display: block;
			padding: 2px;
			font-weight: bold;
		}
		table.baseline-aligned td {
			vertical-align: baseline;
		}
	</style>

	<span style="float:right">Paper Form ID: $paperFormId</span>
	<h2>PET-Clinician Follow-up Form(v0.2.0-beta)</h2>

	<section headerLabel="1. Encounter Details">
		<table class="baseline-aligned">
			<tr>
				<td>Date:</td>
				<td><encounterDate default="today"/></td>
			</tr>
			<tr>
				<td>Location:</td>
				<td><encounterLocation default="1"/></td>
			</tr>
			<tr>
				<td>Provider:</td>
				<td><encounterProvider default="currentUser" type="autocomplete"/></td>
			</tr>
                        
		</table>

	</section>

	<section headerLabel="2. TB Symptoms">

		<div>
		<p>
			Cough
			<br/>
			<obs conceptId="143264" id="cough" required="true" answerConceptIds="1065,1066">
	           <controls>
                     <when value="1065" thenDisplay="#cough_yes" />
                 </controls>
				</obs> 
			</p>	
	<div id="cough_yes" >
		<p>
			Duration of cough
			<br/>
			<obs conceptId="5959" id="cough_duration" answerConceptIds="163739,159799,1487,1067,164106" answerLabels="Less than 2 weeks,2 to 3 weeks,More than 3 weeks,Don't Know,Refused" /> <label style="color:red">*</label>

		</p>
		
		<p>
			Blood in cough
			<br/>
			<obs conceptId="138905" id="haemoptysis" /> <label style="color:red">*</label>
		</p>
	</div>
		<p>
			Difficulty in breathing
			<br/>
			<obs conceptId="122496" id="breathing_difficulty" required="true" answerConceptIds="1065,1066" />
		</p>
		
		<p>
			Fever
			<br/>
			<obs conceptId="140238" id="fever" required="true" answerConceptIds="1065,1066" >
                     <controls>
                     <when value="1065" thenDisplay="#fever_yes" />
                 </controls>
                       </obs>
		</p>
		
		
		<p id="fever_yes">
			Duration of fever
			<br/>
			<obs conceptId="164111" id="fever_duration" answerConceptIds="163740,165607,1494,1067,164106" answerLabels="Less than 2 weeks,2 to 3 weeks,More than 3 weeks,Don't Know,Refused"/>
		</p>
			
		<div id="weight_loss_div">
			<p>
				Weight-loss 
				<br/>
				<obs conceptId="832" id="weight_loss" answerConceptIds="1065,1066" /> <label style="color:red">*</label>
			</p>
		</div>
			
		<p>
			Night sweats
			<br/>
			<obs conceptId="133027" id="night_sweats" required="true" answerConceptIds="1065,1066"  />
		</p>
		
		
		<p>
			Lethargy
			<br/>
			<obs conceptId="116334" id="lethargy" required="true" answerConceptIds="1065,1066" />
		</p>
		
		
		<p>
			Swollen Joints
			<br/>
			<obs conceptId="5312" id="joint_swelling" required="true" answerConceptIds="1065,1066"  />
		</p>
		
		<p>
			Back pain
			<br/>
			<obs conceptId="148035" id="back_pain" required="true" answerConceptIds="1065,1066"  />
		</p>

		<p>
			Lumps in neck, armpit or groin
			<br/>
			<obs conceptId="164112" required="true"  id="adenopathy" answerConceptIds="1065,1066"/>
		</p>
		
		<p>
			Vomiting without other GI symptoms
			<br/>
			<obs conceptId="122983" id="vomiting" required="true" answerConceptIds="1065,1066" />
		</p>
		
		
		<p>
			GI symptoms
			<br/>
			<obs conceptId="139577" id="gi_symptoms" required="true"  answerConceptIds="1065,1066" />
		</p>
		
		<p>
			Loss of interest in activity
			<br/>
			<obs conceptId="163474" id="interest_loss" required="true" answerConceptIds="1065,1066"  />
		</p>
           
		</div>
	</section>

        <section headerLabel="3. Possible medication side-effects">
		<div>
		<p>
			Dizzy
			<br/>
			<obs conceptId="141830" id="dizziness" required="true"  answerConceptIds="1065,1066" />
		</p>
		
		
		<p>
			Nausea/Vomiting
			<br/>
			<obs conceptId="133473" id="nausea_vomiting" required="true" answerConceptIds="1065,1066"   />
		</p>
		
		<p>
			Abdominal Pain
			<br/>
			<obs conceptId="151" id="abdominal_pain" required="true" answerConceptIds="1065,1066" />
		</p>
		
		<p>
			Loss of Appetite
			<br/>
			<obs conceptId="135595" id="reduced_appetite" required="true" answerConceptIds="1065,1066"   />
		</p>
		
		<p>
			Jaundice
			<br/>
			<obs conceptId="136443" id="jaundice" required="true"  answerConceptIds="1065,1066" />
		</p>
		
		
		<p>
			Rash
			<br/>
			<obs conceptId="512" id="rash" required="true"  answerConceptIds="1065,1066"  />
		</p>
		
		<p>
			Tendon Pain
			<br/>
			<obs conceptId="133632" id="muscle_pain" required="true" answerConceptIds="1065,1066" />
		</p>
		
		<p>
			Eye Problems
			<br/>
			<obs conceptId="118938" id="vision_problem" required="true"   answerConceptIds="1065,1066" />
		</p>

		<p>
			Other side effects
			<br/>
			<obs conceptId="164300" id="side_effects" maxlength="1000" size="55"/>
		</p>
		
		<p>
			Are complaints consistent with drug-side effects?
			<br/>
			<obs conceptId="164301" id="side_effects_consistent" answerConceptIds="1065,1066" required="true"/>
		</p>
               </div>
	</section>

	<section headerLabel="4. Clinician Review">
		<div>
		<p>
			How many days worth of medication was missed in the past month?
			<br/>
			<obs conceptId="162878" id="missed_dose" required="true" />
		</p>
		
		<p>
			Action plan <label style="color:red">*</label> <label  id="action_plan_error" style="color:red"></label>
			<br/>
			<obsgroup groupingConceptId="164313">
			<obs conceptId="164313" answerConceptId="164314" answerLabel="Continue Medication (Greater than 90% Adherence)" id="cb_countinue_meds_high_adherence"/>
			<br/>
			<obs conceptId="164313" answerConceptId="164315" answerLabel="Continue Medication (Less than 90% Adherence)" id="cb_countinue_meds_low_adherence"/>
			<br/>
			<obs conceptId="164313" answerConceptId="164316" answerLabel="Discontinue Medication"  id="cb_discountinue_meds"/>
			<br/>		
			<obs conceptId="164313" answerConceptId="164317" answerLabel="Begin Clinical/CXR Monitoring Protocol" id="cb_begin_protocols"/>
			<br/>
			<obs conceptId="164313" answerConceptId="164318" answerLabel="New Medication" id="cb_new_medication"/>
			<br/>
			<obs conceptId="164313" answerConceptId="164319" answerLabel="Seek Expert Consultation" id="cb_seek_consultation"/>
			<br/>	
			<obs conceptId="164313" answerConceptId="164320" answerLabel="Change drug dosage" id="cb_change_dosage"/>
			<br/>
			<obs conceptId="164313" answerConceptId="164321" answerLabel="Ancillary drug" id="cb_ancillary_drug"/>
			<br/>
			</obsgroup>
		</p>
		
		<div id="discontinuation_div">
		<p>
			Discontinue Medication - Reason
			<br/>
			<obs conceptId="164322" id="discontinue_reason" maxlength="250" size="55" /> <label style="color:red">*</label>
		</p>
		
		<p>
			Duration of discontinuation (Days)
			<br/>
			<obs conceptId="164323" id="discontinue_duration" maxlength="3"/> <label style="color:red">*</label>
		</p>
		</div>
		
		<div id="medication_div">
		<p>
			New Medication - Reason
			<br/>
			<obs conceptId="164324" id="new_medication" maxlength="250" size="55" /> <label style="color:red">*</label>
		</p>
		
		<p>
			Duration of new medicine (Days) 
			<br/>
			<obs conceptId="164325" id="new_medication_duration"  maxlength="3"/> <label style="color:red">*</label>
		</p>
		</div>
		
		<div id="ancillary_div">
		<p>
			Ancillary Drugs <label style="color:red">*</label> <label  id="ancillary_drug_error" style="color:red"></label>
			<br/>
			<obsgroup groupingConceptId="164249">
			<obs conceptId="164249" answerConceptId="78218" answerLabel="Iron Deficiency protocol"  id="cb_iron_protcol"/>
			<br/>
			<obs conceptId="164249" answerConceptId="86345" answerLabel="Vitamin D deficiency protocol" id="cb_vitamin_d_protocol"/>
			<br/>
			<obs conceptId="164249" answerConceptId="104248" answerLabel="PCM protocol" id="cb_pcm_protocol"/>
			<br/>		
			</obsgroup>
		</p>

		
		<p>
			Duration of ancillary drug (in days) 
			<br/>
			<obs conceptId="159368" id="medication_duration"/> <label style="color:red">*</label>
		</p>
		</div>
		
		<div id="regimen_div">
		<p>
			Regimen
			<br/>
			<obs conceptId="164243" id="pet_regimen" answerConceptIds="1679,164241,164242"> <label style="color:red">*</label>
			
                          <controls>
                                 <when value="1679"  thenDisplay="#opt1a" />
                                 <when value="164241" thenDisplay="#opt1,#opt2" />
                                 <when value="164242" thenDisplay="#opt3" />
                          </controls>
			</obs>

		</p>
		
		<p  id="opt1a">
			Isoniazid dose
			<br/>
			<obs conceptId="164244" id="isoniazid_dose_a" /> <label style="color:red">*</label>
		</p>
		
               <p  id="opt1">
			Isoniazid dose
			<br/>
			<obs conceptId="164244" id="isoniazid_dose" /> <label style="color:red">*</label>
		</p>

		<p id="opt2">
			Rifapentine dose
			<br/>
			<obs conceptId="164245" id="rifapentine_dose"/> <label style="color:red">*</label>
		</p>
      

	<div id="opt3">
		<p>
			Levofloxacin dose
			<br/>
			<obs conceptId="164246" id="levofloxacin_dose" /> <label style="color:red">*</label>
		</p>
		
		<p>
			Ethionamide dose
			<br/>
			<obs conceptId="164247" id="ethionamide_dose" /> <label style="color:red">*</label>
		</p>
        </div>
		</div>
		
		<p>
			New Instructions
			<br/>
			<obs conceptId="163106" id="instructions" maxlength="250" required="true"/>
		</p>
		
		<p>
			Return Visit Date
			<br/>
			<obs conceptId="5096" id="return_visit_date"  required="true" allowFutureDates="true"/>
		</p>
		
               </div>
	</section>

	<submit/>


    <script type="text/javascript">

 jQuery(window).bind("load", function() {
 
 if(getValue('cb_discountinue_meds.value')==164316){
						$j('#discontinuation_div').show();
					}else{
						$j('#discontinuation_div').hide();
					}
 
 if(getValue('cb_new_medication.value')==164318){
						$j('#medication_div').show();
					}else{
						$j('#medication_div').hide();
					}
					
					if(getValue('cb_ancillary_drug.value')==164321){
						$j('#ancillary_div').show();
					}else{
						$j('#ancillary_div').hide();
					}
					
					if(getValue('cb_change_dosage.value')==164320){
						$j('#regimen_div').show();
					}else{
						$j('#regimen_div').hide();
					}
      

        });

		var startDate = new Date();
		var patientage= <lookup expression="patient.age"/>
		if(patientage &gt;5){
             $j('#weight_loss_div').hide();
         }
         else{
			 $j('#weight_loss_div').show();
           }
		   jQuery(function() {
		   
		   
				getField('cb_discountinue_meds.value').change(function() {
					if(getValue('cb_discountinue_meds.value')==164316){
						$j('#discontinuation_div').show();
					}else{
						$j('#discontinuation_div').hide();
						setValue('discontinue_reason.value','');
						setValue('discontinue_duration.value','');
					}

				});
				
				getField('cb_new_medication.value').change(function() {
					if(getValue('cb_new_medication.value')==164318){
						$j('#medication_div').show();
					}else{
						$j('#medication_div').hide();
						setValue('new_medication_duration.value','');
						setValue('new_medication.value','');
					}
				});
				
				getField('cb_ancillary_drug.value').change(function() {
					if(getValue('cb_ancillary_drug.value')==164321){
						$j('#ancillary_div').show();
					}else{
						$j('#ancillary_div').hide();
						setValue('medication_duration.value','');
						setValue('cb_iron_protcol.value','');
						setValue('cb_vitamin_d_protocol.value','');
						setValue('cb_pcm_protocol.value','');
					}
				});
				
				getField('cb_change_dosage.value').change(function() {
					if(getValue('cb_change_dosage.value')==164320){
						$j('#regimen_div').show();
					}else{
						$j('#regimen_div').hide();
						setValue('pet_regimen.value','');
						$j('#opt1').hide();
						$j('#opt2').hide();
						$j('#opt3').hide();
						setValue('levofloxacin_dose.value','');
						setValue('rifapentine_dose.value','');
						setValue('isoniazid_dose.value','');
						setValue('isoniazid_dose_a.value','');
					}
				});
					
        });

		beforeSubmit.push(function() {

			var error1=true,error2=true,error3=true,error4=true,error5=true,error6=true;
			
			if(getValue('cough.value')==1065 &amp;&amp; getValue('cough_duration.value')==''){
                getField('cough_duration.error').html('This field can not be null').show();
                error1=false;
            }
            else{
                getField('cough_duration.error').html('').hide();
                error1=true;
			}
			
			if(getValue('cough.value')==1065 &amp;&amp; getValue('haemoptysis.value')==''){
                getField('haemoptysis.error').html('This field can not be null').show();
                error1=false;
            }
            else{
                getField('haemoptysis.error').html('').hide();
                error1=true;
			}
		
			
			var val = getValue('missed_dose.value') ;
			if((parseFloat(val) == parseInt(val)) &amp;&amp; !isNaN(val)){
			  getField('missed_dose.error').html('').hide();
			  error3=true;
			} else {
			  getField('missed_dose.error').html('Not an Integer').show();
			  error3=false;
			}
			
			var val1 = getValue('cb_countinue_meds_high_adherence.value');
			var val2 = getValue('cb_countinue_meds_low_adherence.value');
			var val3 = getValue('cb_discountinue_meds.value');
			var val4 = getValue('cb_begin_protocols.value');
			var val5 = getValue('cb_new_medication.value');
			var val6 = getValue('cb_seek_consultation.value');
			var val7 = getValue('cb_change_dosage.value');
			var val8 = getValue('cb_ancillary_drug.value');

			if(val1 == null &amp;&amp; val2 == null &amp;&amp; val3 == null &amp;&amp; val4 == null &amp;&amp; val5 == null &amp;&amp; val6 == null &amp;&amp; val7 == null &amp;&amp; val8 == null){
				document.getElementById('action_plan_error').innerHTML = 'Required Field';
				error5=false;
			}else{
				document.getElementById('action_plan_error').innerHTML = '';
				error5=true;
			}
			
			if(getValue('cb_discountinue_meds.value') == 164316){
				if(getValue('discontinue_reason.value') == ''){
					document.getElementById('discontinue_reason').innerHTML = 'Required Field';
					error6=false
				}
				var val = getValue('discontinue_duration.value') ;
				if((parseFloat(val) == parseInt(val)) &amp;&amp; !isNaN(val)){
				  getField('discontinue_duration.error').html('').hide();
				} else {
				  getField('discontinue_duration.error').html('Not an Integer').show();
				  error6=false;
				}
			}
			
			if(getValue('cb_new_medication.value') == 164318){
				
				var val = getValue('new_medication_duration.value') ;
				if((parseFloat(val) == parseInt(val)) &amp;&amp; !isNaN(val)){
				  getField('new_medication_duration.error').html('').hide();
				} else {
				  getField('new_medication_duration.error').html('Not an Integer').show();
				  error6=false;
				}
				if(getValue('new_medication.value') == ''){
					document.getElementById('new_medication').innerHTML = 'Required Field';
					error6=false
				}
			}
			
			
			if(getValue('cb_ancillary_drug.value') == 164321){
				
				var val = getValue('medication_duration.value') ;
				if((parseFloat(val) == parseInt(val)) &amp;&amp; !isNaN(val)){
				  getField('medication_duration.error').html('').hide();
				} else {
				  getField('medication_duration.error').html('Not an Integer').show();
				  error6=false;
				}
				
				var val1 = getValue('cb_iron_protcol.value');
				var val2 = getValue('cb_vitamin_d_protocol.value');
			    var val3 = getValue('cb_pcm_protocol.value');
				
				if(val1 == null &amp;&amp; val2 == null &amp;&amp; val3 == null){
					document.getElementById('ancillary_drug_error').innerHTML = 'Required Field';
					error6=false;
				}else{
					document.getElementById('ancillary_drug_error').innerHTML = '';
				}
				
			}
			
			if(getValue('cb_change_dosage.value') == 164320){
				
				if(getValue('pet_regimen.value') == ''){
					getField('pet_regimen.error').html('Required Field').show();
					error6=false
				} else{
				
					getField('pet_regimen.error').html('').hide();

					if(getValue('pet_regimen.value') == 1679){
					
						if(getValue('isoniazid_dose_a.value') == ''){
							getField('isoniazid_dose_a.error').html('Required Field').show();
							error6=false
						}	else{
							getField('isoniazid_dose_a.error').html('').hide();
						}
					
					}else if(getValue('pet_regimen.value') == 164241){
					
						if(getValue('isoniazid_dose.value') == ''){
							getField('isoniazid_dose.error').html('Required Field').show();
							error6=false
						}	else{
							getField('isoniazid_dose.error').html('').hide();
						}
						
						if(getValue('rifapentine_dose.value') == ''){
							getField('rifapentine_dose.error').html('Required Field').show();
							error6=false
						}	else{
							getField('rifapentine_dose.error').html('').hide();
						}
					
					}else if(getValue('pet_regimen.value') == 164242){
					
						if(getValue('levofloxacin_dose.value') == ''){
							getField('levofloxacin_dose.error').html('Required Field').show();
							error6=false
						}	else{
							getField('levofloxacin_dose.error').html('').hide();
						}
						
						if(getValue('eth.value') == ''){
							getField('ethionamide_dose.error').html('Required Field').show();
							error6=false
						}	else{
							getField('ethionamide_dose.error').html('').hide();
						}
					
					}
						
				}
			}
		
			

		if(error1 == false || error3==false || error4==false || error5==false || error6==false){
			return false;
		}
		else{
            var endDate = new Date();
            var timeDiff = Math.abs(endDate.getTime() - startDate.getTime());
			var diffSec = timeDiff/1000;
			alert(diffSec + " seconds to fill form");
			return true;
		}
	});
                    
</script>

</htmlform>